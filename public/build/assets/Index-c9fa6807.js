import{j as e,r as a,i as De,W as Ve,y as z}from"./app-ef847769.js";import{T as n,B as He,I as v,P as Le,a as le}from"./PanelLayout-f3b1b528.js";import{u as Be,M as Ge}from"./index.esm-f651ad8d.js";import{M as Oe}from"./index.esm-4bae7fd4.js";import{I as Y}from"./InputError-101e4114.js";import{C as ce}from"./Chip-7ba2869a.js";import{T as P}from"./TableRow-e01d0199.js";import{V as _e}from"./Visibility-4a9b5128.js";import{c as L}from"./createSvgIcon-1d15f18d.js";import{C as de}from"./CompareArrows-0a996902.js";import{R as ue,L as Ke}from"./Refresh-8686b393.js";import{G as h}from"./Grid-8b166bc4.js";import{F as R,I as E,S as M,T as D}from"./TextField-239b9d80.js";import{M as l}from"./MenuItem-7e314da3.js";import{S as me}from"./Search-3df2f34f.js";import{B as d}from"./Button-5cd339f2.js";import{C as V,a as H}from"./CardContent-4bc855c4.js";import{D as J,a as Q,b as he}from"./DialogContent-21eccb4c.js";import{D as X}from"./DialogTitle-8810badb.js";import{A as xe}from"./Autocomplete-e3bbac74.js";import{C as We}from"./Close-a9dab803.js";import{C as $e}from"./Check-a16d6a02.js";import{f as N}from"./helpers.segment-8c19304b.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./index-63345e99.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./DatePicker-17c52b79.js";import"./Popper-fafd03d0.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./Switch-00012cca.js";const Ue=L(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"}),"Assessment"),Ye=L(e.jsx("path",{fillRule:"evenodd",d:"M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM10 17H5v-2h5v2zm0-4H5v-2h5v2zm0-4H5V7h5v2zm4.82 6L12 12.16l1.41-1.41 1.41 1.42L17.99 9l1.42 1.42L14.82 15z"}),"FactCheck"),Je=L(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"History"),Qe=L(e.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"}),"ShoppingCart");function Et({auth:u,errors:T,produits:g,typeProduits:B,categories:G,error:pe,success:je,departements:f,statsGlobales:p}){var ie,ae,ne,oe;const[x,C]=a.useState([]),[Z,I]=a.useState(!1),[ve,F]=a.useState(!1),[ge,y]=a.useState(!1),[fe,S]=a.useState(0),[O,_]=a.useState([]),[K,A]=a.useState(""),[W,Ce]=a.useState([]),[j,ye]=a.useState({pageIndex:g.current_page-1,pageSize:g.per_page}),[s,$]=a.useState({categorie:"",typeProduit:"",departement:"",status:"",searchTerm:""});a.useEffect(()=>{S(g.total),C(g.data),y(!1)},[g]),a.useEffect(()=>{y(!0),F(!0);const t={start:j.pageIndex*j.pageSize,size:j.pageSize,filters:O??[],globalFilter:K??"",sorting:W??[]};s.departement&&(t.departement_id=s.departement);try{const r=u.user.id;De.post(route("admin.stock.inventaire.paginationFiltre",{userId:r}),t).then(o=>{var c;if(o.data&&Array.isArray(o.data.data)){if(C(o.data.data),S(o.data.rowCount||o.data.data.length),o.data.departement_id){const m=((c=f.find(q=>q.id==o.data.departement_id))==null?void 0:c.nom)||"Sélectionné";console.log(`Affichage des stocks pour le département: ${m}`)}I(!1)}else C([]),S(0),console.warn("Réponse inattendue du serveur:",o),I(!1);F(!1),y(!1)}).catch(o=>{console.error("Erreur lors de la récupération des données:",o),C([]),S(0),F(!1),y(!1),I(!0)})}catch(r){console.error("Erreur lors de l'exécution de la requête:",r),C([]),S(0),F(!1),y(!1),I(!0)}},[O,K,j.pageIndex,j.pageSize,W,s.departement]);const{data:i,setData:k,post:Xe,put:Se,reset:ee}=Ve({id:"",nom:"",typeProduit:null,categorie:null});a.useState(!1);const[ke,be]=a.useState(!1),[ze,te]=a.useState(!1),[Pe,Ne]=a.useState(!1),Te=()=>{z.get(route("admin.inventaire.create",u.user.id),{onSuccess:()=>ee()})},U=()=>{be(!1)},Ie=()=>{te(!1)},se=()=>{Ne(!1)},Fe=t=>{t.target.type==="checkbox"?k(t.target.name,t.target.checked):k(t.target.name,t.target.value)},Ae=t=>{k({id:t.id,nom:t.nom,typeProduit:t.typeProduit,categorie:t.categorie}),te(!0)},we=()=>{Se(route("admin.stock.inventaire.update",[u.user.id,i.id]),{onSuccess:()=>{ee(),U()}})},qe=()=>{z.delete(route("admin.stock.inventaire.destroy",[u.user.id,i.id]))},Re=a.useMemo(()=>[{accessorKey:"nom",header:"Nom"},{accessorKey:"categorie.nom",header:"Catégorie",size:150},{accessorKey:"stockGlobal",header:"Stock",size:100,Cell:({row:t})=>{const r=t.original.stockGlobal||0,o=t.original.stockCritique||0;t.original.seuilMaximal;let c="success.main";return r===0?c="error.main":r<o&&(c="warning.main"),e.jsx(n,{sx:{color:c},children:N(r)})}},{accessorKey:"stockCritique",header:"Stock Critique",size:100,Cell:({row:t})=>e.jsx(n,{children:N(t.original.stockCritique||0)})},{accessorKey:"prixAchat",header:"Prix Achat",size:120,Cell:({row:t})=>e.jsx(n,{children:t.original.prixAchat?N(t.original.prixAchat)+" GNF":"0 GNF"})},{accessorKey:"valeurStock",header:"Valeur Stock",size:120,Cell:({row:t})=>{const r=(t.original.stockGlobal||0)*(t.original.prixAchat||0);return e.jsxs(n,{children:[N(r)," GNF"]})}},{accessorKey:"status",header:"Statut",size:120,Cell:({row:t})=>e.jsx(ce,{label:t.original.status===1?"Actif":"Inactif",color:t.original.status===1?"success":"error",size:"small"})},{accessorKey:"actions",header:"Actions",size:200,Cell:({row:t})=>e.jsxs(He,{sx:{display:"flex",gap:"8px"},children:[e.jsx(P,{title:"Voir détails",children:e.jsx(v,{color:"primary",onClick:()=>Ae(t.original),children:e.jsx(_e,{fontSize:"small"})})}),e.jsx(P,{title:"Historique des mouvements",children:e.jsx(v,{color:"info",children:e.jsx(Je,{fontSize:"small"})})}),e.jsx(P,{title:"Ajuster le stock",children:e.jsx(v,{color:"secondary",onClick:()=>{z.get(route("admin.inventaire.ajustement.create",u.user.id),{produit_id:t.original.id})},children:e.jsx(de,{fontSize:"small"})})}),e.jsx(P,{title:"Commander",children:e.jsx(v,{color:"warning",onClick:Te,children:e.jsx(Qe,{fontSize:"small"})})})]})}],[]);console.log(x);const Ee=Be({columns:Re,data:x,getRowId:t=>t.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualSorting:!0,muiToolbarAlertBannerProps:Z?{color:"error",children:"Erreur lors du chargement des données. Veuillez réessayer ou contacter l'administrateur."}:void 0,onColumnFiltersChange:_,onGlobalFilterChange:A,onPaginationChange:ye,onSortingChange:Ce,rowCount:fe,state:{columnFilters:O,globalFilter:K,isLoading:ve,pagination:j,showAlertBanner:Z,showProgressBars:ge,sorting:W},localization:Oe}),w=a.useMemo(()=>{if(i!=null&&i.stats)return{totalProduits:i.stats.totalProduits,sousstockCritique:i.stats.sousstockCritique,enRupture:i.stats.enRupture,valeurTotale:i.stats.valeurTotale};if(p)return{totalProduits:p.totalProduits,sousstockCritique:p.sousstockCritique,enRupture:p.enRupture,valeurTotale:p.valeurTotale};{const t=x.length,r=x.filter(m=>m.stockGlobal<m.stockCritique).length,o=x.filter(m=>m.stockGlobal===0).length,c=x.reduce((m,q)=>m+(q.stockGlobal||0)*(q.prixAchat||0),0);return{totalProduits:t,sousstockCritique:r,enRupture:o,valeurTotale:c}}},[x,i==null?void 0:i.stats,p]),b=t=>{const{name:r,value:o}=t.target;$(c=>({...c,[r]:o}))},re=()=>{const t=[];s.categorie&&t.push({id:"categorie",value:s.categorie}),s.typeProduit&&t.push({id:"typeProduit",value:s.typeProduit}),s.status&&(s.status==="rupture"?t.push({id:"stockGlobal",value:"0"}):s.status==="sous_stock"?t.push({id:"stock_critique",value:"true"}):t.push({id:"status",value:s.status})),_(t),s.searchTerm?A(s.searchTerm):A("")},Me=()=>{$({categorie:"",typeProduit:"",departement:"",status:"",searchTerm:""}),_([]),A("")};return e.jsx(Le,{auth:u,success:je,error:pe,errors:T,active:"stock",sousActive:"inventaire",breadcrumbs:[{text:"Inventaire",href:route("admin.stock.inventaire.index",[u.user.id]),active:!0}],children:e.jsxs("div",{className:"grid gap-5 bg-gray-200 p-2 rounded border w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:e.jsx("h2",{children:"Gestion des inventaires"})})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(P,{title:"Rafraîchir les données",children:e.jsx(v,{onClick:()=>window.location.reload(),children:e.jsx(ue,{})})})})]}),e.jsxs(le,{elevation:2,className:"p-4",children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Filtres Avancés"}),e.jsxs(h,{container:!0,spacing:2,className:"mb-3",children:[e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(R,{fullWidth:!0,size:"small",children:[e.jsx(E,{children:"Catégorie"}),e.jsxs(M,{name:"categorie",value:s.categorie,onChange:b,label:"Catégorie",children:[e.jsx(l,{value:"",children:"Toutes"}),G&&G.map(t=>e.jsx(l,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(R,{fullWidth:!0,size:"small",children:[e.jsx(E,{children:"Type de Produit"}),e.jsxs(M,{name:"typeProduit",value:s.typeProduit,onChange:b,label:"Type de Produit",children:[e.jsx(l,{value:"",children:"Tous"}),B&&B.map(t=>e.jsx(l,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(R,{fullWidth:!0,size:"small",children:[e.jsx(E,{children:"Département"}),e.jsxs(M,{name:"departement",value:s.departement,onChange:b,label:"Département",children:[e.jsx(l,{value:"",children:"Tous"}),f&&f.map(t=>e.jsx(l,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(R,{fullWidth:!0,size:"small",children:[e.jsx(E,{children:"Statut"}),e.jsxs(M,{name:"status",value:s.status,onChange:b,label:"Statut",children:[e.jsx(l,{value:"",children:"Tous"}),e.jsx(l,{value:"1",children:"Actif"}),e.jsx(l,{value:"0",children:"Inactif"}),e.jsx(l,{value:"rupture",children:"En rupture"}),e.jsx(l,{value:"sous_stock",children:"Stock critique"})]})]})})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(D,{fullWidth:!0,size:"small",label:"Recherche par nom, référence...",name:"searchTerm",value:s.searchTerm,onChange:b,InputProps:{endAdornment:e.jsx(v,{size:"small",children:e.jsx(me,{})})}})}),e.jsxs(h,{item:!0,xs:12,md:6,className:"flex justify-end",children:[e.jsx(d,{variant:"outlined",color:"secondary",onClick:Me,className:"mr-2",startIcon:e.jsx(ue,{}),children:"Réinitialiser"}),e.jsx(d,{variant:"contained",color:"primary",onClick:re,startIcon:e.jsx(me,{}),children:"Appliquer les filtres"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsx(V,{elevation:2,children:e.jsxs(H,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Total Produits"}),e.jsx(n,{variant:"h4",component:"div",children:w.totalProduits}),e.jsx(n,{variant:"body2",color:"textSecondary",children:s.departement?`Produits dans ${((ie=f.find(t=>t.id==s.departement))==null?void 0:ie.nom)||"le département"}`:"Produits en inventaire"})]})})}),e.jsx("div",{children:e.jsx(V,{elevation:2,children:e.jsxs(H,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Stock Critique"}),e.jsx(n,{variant:"h4",component:"div",color:"warning.main",children:w.sousstockCritique}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Produits à réapprovisionner"})]})})}),e.jsx("div",{children:e.jsx(V,{elevation:2,children:e.jsxs(H,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"En Rupture"}),e.jsx(n,{variant:"h4",component:"div",color:"error.main",children:w.enRupture}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Produits en rupture de stock"})]})})}),e.jsx("div",{children:e.jsx(V,{elevation:2,children:e.jsxs(H,{children:[e.jsx(n,{color:"textSecondary",gutterBottom:!0,children:"Valeur Totale"}),e.jsxs(n,{variant:"h4",component:"div",color:"primary.main",children:[N(w.valeurTotale)," GNF"]}),e.jsx(n,{variant:"body2",color:"textSecondary",children:"Valeur de l'inventaire"})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(Ye,{}),onClick:()=>z.get(route("admin.inventaire.physique.index",u.user.id)),children:"Inventaire Physique"}),e.jsx(d,{variant:"contained",color:"secondary",startIcon:e.jsx(de,{}),onClick:()=>z.get(route("admin.inventaire.ajustement.index",u.user.id)),children:"Ajustements d'Inventaire"}),e.jsx(d,{variant:"contained",color:"warning",startIcon:e.jsx(Ue,{}),children:"Rapports d'Inventaire"}),e.jsx(d,{variant:"contained",color:"info",startIcon:e.jsx(Ke,{}),children:"Commandes Fournisseurs"})]}),e.jsxs("div",{children:[e.jsxs(J,{open:ke,onClose:U,children:[e.jsx(X,{className:"bg-blue-600 text-white",children:"Modification du produit"}),e.jsxs(Q,{className:"space-y-5",children:[e.jsxs("div",{className:"mt-5",children:[e.jsx(D,{autoFocus:!0,margin:"dense",id:"nom",name:"nom",label:"Nom",type:"text",fullWidth:!0,variant:"standard",value:i.nom,onChange:Fe}),e.jsx(Y,{message:T.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(xe,{disablePortal:!0,id:"typeProduit",options:B,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,r)=>t.id===r.id,value:i.typeProduit,onChange:(t,r)=>{k("typeProduit",r)},renderInput:t=>e.jsx(D,{...t,label:"Type de produit"})}),e.jsx(Y,{message:T.typeProduit,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(xe,{disablePortal:!0,id:"categorie",options:G,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,r)=>t.id===r.id,value:i.categorie,onChange:(t,r)=>{k("categorie",r)},renderInput:t=>e.jsx(D,{...t,label:"Catégorie"})}),e.jsx(Y,{message:T.categorie,className:"mt-2"})]})]}),e.jsxs(he,{children:[e.jsx(d,{variant:"contained",color:"error",onClick:U,children:"Annuler"}),e.jsx(d,{variant:"contained",color:"success",onClick:we,children:"Enregistrer"})]})]}),e.jsxs(J,{open:ze,onClose:Ie,children:[e.jsx(X,{className:"bg-blue-600 text-white",children:"Détails du produit"}),e.jsx(Q,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:i.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ae=i.typeProduit)==null?void 0:ae.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(ne=i.categorie)==null?void 0:ne.nom})]})]})})]}),e.jsxs(J,{open:Pe,onClose:se,children:[e.jsx(X,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(Q,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[i.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",i.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(he,{children:[e.jsxs(d,{variant:"contained",color:"error",onClick:se,children:[e.jsx(We,{}),"  Non"]}),e.jsxs(d,{variant:"contained",color:"success",onClick:qe,children:[e.jsx($e,{})," Oui"]})]})]})]}),e.jsxs(le,{elevation:2,className:"p-4 overflow-scroll",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(n,{variant:"h6",children:"Liste des Produits en Stock"}),s.departement&&e.jsx(ce,{color:"primary",label:`Stock du département: ${((oe=f.find(t=>t.id==s.departement))==null?void 0:oe.nom)||"Sélectionné"}`,onDelete:()=>{$(t=>({...t,departement:""})),setTimeout(()=>re(),100)}})]}),e.jsx("div",{children:e.jsx(Ge,{table:Ee})})]})]})})}export{Et as default};
