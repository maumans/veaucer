import{j as e,r as C,y as T}from"./app-eb4ac14d.js";import{u as be,I as q,R as fe,i as ye,P as Pe,T as n,B as i,a as X,d as ve}from"./PanelLayout-9db7ade9.js";import{C as Z}from"./Chip-bb44338a.js";import{B}from"./Button-7f8b9a63.js";import{A as Ce}from"./ArrowBack-7bd27efd.js";import{G as V}from"./Grid-7450d8ec.js";import{L as O,F as ee,a as we}from"./LastPage-4e97b798.js";import{P as Ie,S as Se}from"./Stop-896da979.js";import{a as Re,C as Te}from"./CheckCircle-ccf21a3f.js";import{C as Be}from"./CompareArrows-ab49f6a9.js";import{b as c,e as Le,f as _e,g as Ne,c as te,d as ke,T as se}from"./TableRow-9f6508f6.js";import{E as Ae}from"./Edit-9517b33c.js";import{a as ge,_ as g}from"./index-cf4ee6ec.js";import{c as J,g as De,a as Me,s as L,u as qe,D as oe,b as W,d as $e}from"./createSvgIcon-4d9a41bc.js";import{S as Fe,g as ze,T as ne}from"./TextField-22f70a44.js";import{M as Ke}from"./MenuItem-3d0941cb.js";import{D as Ee,a as Ge,b as Ue}from"./DialogContent-a8b90f31.js";import{D as He}from"./DialogTitle-7e680bb7.js";import{C as Qe}from"./Close-7d5020eb.js";import"./Dropdown-8c28aa27.js";import"./transition-a13fe195.js";import"./Popper-1f680820.js";const We=J(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),ae=J(e.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),re=J(e.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight");var ie,le,ce,de,ue,pe,me,he;const Ye=["backIconButtonProps","count","disabled","getItemAriaLabel","nextIconButtonProps","onPageChange","page","rowsPerPage","showFirstButton","showLastButton","slotProps"],Ve=C.forwardRef(function(a,o){var d,y,_,N;const{backIconButtonProps:w,count:P,disabled:p=!1,getItemAriaLabel:l,nextIconButtonProps:k,onPageChange:v,page:r,rowsPerPage:I,showFirstButton:A,showLastButton:D,slotProps:m}=a,f=ge(a,Ye),h=be(),S=u=>{v(u,0)},$=u=>{v(u,r-1)},R=u=>{v(u,r+1)},F=u=>{v(u,Math.max(0,Math.ceil(P/I)-1))};return e.jsxs("div",g({ref:o},f,{children:[A&&e.jsx(q,g({onClick:S,disabled:p||r===0,"aria-label":l("first",r),title:l("first",r)},(d=m==null?void 0:m.firstButton)!=null?d:{},{children:h.direction==="rtl"?ie||(ie=e.jsx(O,{})):le||(le=e.jsx(ee,{}))})),e.jsx(q,g({onClick:$,disabled:p||r===0,color:"inherit","aria-label":l("previous",r),title:l("previous",r)},(y=m==null?void 0:m.previousButton)!=null?y:w,{children:h.direction==="rtl"?ce||(ce=e.jsx(re,{})):de||(de=e.jsx(ae,{}))})),e.jsx(q,g({onClick:R,disabled:p||(P!==-1?r>=Math.ceil(P/I)-1:!1),color:"inherit","aria-label":l("next",r),title:l("next",r)},(_=m==null?void 0:m.nextButton)!=null?_:k,{children:h.direction==="rtl"?ue||(ue=e.jsx(ae,{})):pe||(pe=e.jsx(re,{}))})),D&&e.jsx(q,g({onClick:F,disabled:p||r>=Math.ceil(P/I)-1,"aria-label":l("last",r),title:l("last",r)},(N=m==null?void 0:m.lastButton)!=null?N:{},{children:h.direction==="rtl"?me||(me=e.jsx(ee,{})):he||(he=e.jsx(O,{}))}))]}))}),Je=Ve;function Xe(s){return Me("MuiTablePagination",s)}const Ze=De("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]),E=Ze;var xe;const Oe=["ActionsComponent","backIconButtonProps","className","colSpan","component","count","disabled","getItemAriaLabel","labelDisplayedRows","labelRowsPerPage","nextIconButtonProps","onPageChange","onRowsPerPageChange","page","rowsPerPage","rowsPerPageOptions","SelectProps","showFirstButton","showLastButton","slotProps"],et=L(c,{name:"MuiTablePagination",slot:"Root",overridesResolver:(s,a)=>a.root})(({theme:s})=>({overflow:"auto",color:(s.vars||s).palette.text.primary,fontSize:s.typography.pxToRem(14),"&:last-child":{padding:0}})),tt=L(fe,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(s,a)=>g({[`& .${E.actions}`]:a.actions},a.toolbar)})(({theme:s})=>({minHeight:52,paddingRight:2,[`${s.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[s.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${E.actions}`]:{flexShrink:0,marginLeft:20}})),st=L("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(s,a)=>a.spacer})({flex:"1 1 100%"}),ot=L("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(s,a)=>a.selectLabel})(({theme:s})=>g({},s.typography.body2,{flexShrink:0})),nt=L(Fe,{name:"MuiTablePagination",slot:"Select",overridesResolver:(s,a)=>g({[`& .${E.selectIcon}`]:a.selectIcon,[`& .${E.select}`]:a.select},a.input,a.selectRoot)})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${E.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),at=L(Ke,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(s,a)=>a.menuItem})({}),rt=L("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(s,a)=>a.displayedRows})(({theme:s})=>g({},s.typography.body2,{flexShrink:0}));function it({from:s,to:a,count:o}){return`${s}–${a} of ${o!==-1?o:`more than ${a}`}`}function lt(s){return`Go to ${s} page`}const ct=s=>{const{classes:a}=s;return $e({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},Xe,a)},dt=C.forwardRef(function(a,o){var d;const y=qe({props:a,name:"MuiTablePagination"}),{ActionsComponent:_=Je,backIconButtonProps:N,className:w,colSpan:P,component:p=c,count:l,disabled:k=!1,getItemAriaLabel:v=lt,labelDisplayedRows:r=it,labelRowsPerPage:I="Rows per page:",nextIconButtonProps:A,onPageChange:D,onRowsPerPageChange:m,page:f,rowsPerPage:h,rowsPerPageOptions:S=[10,25,50,100],SelectProps:$={},showFirstButton:R=!1,showLastButton:F=!1,slotProps:u}=y,Y=ge(y,Oe),z=y,x=ct(z),b=(d=u==null?void 0:u.select)!=null?d:$,G=b.native?"option":at;let U;(p===c||p==="td")&&(U=P||1e3);const H=oe(b.id),K=oe(b.labelId),Q=()=>l===-1?(f+1)*h:h===-1?l:Math.min(l,(f+1)*h);return e.jsx(et,g({colSpan:U,ref:o,as:p,ownerState:z,className:W(x.root,w)},Y,{children:e.jsxs(tt,{className:x.toolbar,children:[e.jsx(st,{className:x.spacer}),S.length>1&&e.jsx(ot,{className:x.selectLabel,id:K,children:I}),S.length>1&&e.jsx(nt,g({variant:"standard"},!b.variant&&{input:xe||(xe=e.jsx(ze,{}))},{value:h,onChange:m,id:H,labelId:K},b,{classes:g({},b.classes,{root:W(x.input,x.selectRoot,(b.classes||{}).root),select:W(x.select,(b.classes||{}).select),icon:W(x.selectIcon,(b.classes||{}).icon)}),disabled:k,children:S.map(j=>C.createElement(G,g({},!ye(G)&&{ownerState:z},{className:x.menuItem,key:j.label?j.label:j,value:j.value?j.value:j}),j.label?j.label:j))})),e.jsx(rt,{className:x.displayedRows,children:r({from:l===0?0:f*h+1,to:Q(),count:l===-1?-1:l,page:f})}),e.jsx(_,{className:x.actions,backIconButtonProps:N,count:l,nextIconButtonProps:A,onPageChange:D,page:f,rowsPerPage:h,showFirstButton:R,showLastButton:F,slotProps:u==null?void 0:u.actions,getItemAriaLabel:v,disabled:k})]})}))}),ut=dt;function At({auth:s,errors:a,inventaire:o,stats:d,details:y,error:_,success:N}){var K,Q,j;const[w,P]=C.useState(0),[p,l]=C.useState(10),[k,v]=C.useState(!1),[r,I]=C.useState(null),[A,D]=C.useState(""),[m,f]=C.useState(""),h=(t,M)=>{P(M)},S=t=>{l(parseInt(t.target.value,10)),P(0)},$=t=>{I(t),D(t.quantite_comptee||""),f(t.notes||""),v(!0)},R=()=>{v(!1)},F=()=>{T.post(route("admin.inventaire.physique.compter",[s.user.id,o.id,r.id]),{quantite_comptee:A,notes:m}),R()},u=t=>{T.post(route("admin.inventaire.physique.valider",[s.user.id,o.id,t]))},Y=()=>{T.get(route("admin.inventaire.physique.demarrer",[s.user.id,o.id]))},z=()=>{T.get(route("admin.inventaire.physique.terminer",[s.user.id,o.id]))},x=()=>{T.get(route("admin.inventaire.physique.annuler",[s.user.id,o.id]))},b=()=>{T.get(route("admin.inventaire.physique.generer-ajustements",[s.user.id,o.id]))},G=t=>{switch(t){case"planifié":return"info";case"en_cours":return"warning";case"terminé":return"success";case"annulé":return"error";default:return"default"}},U=t=>t?t>0?"success.main":t<0?"error.main":"inherit":"inherit",H=t=>t?ve(t).format("DD/MM/YYYY"):"-";return e.jsx(Pe,{auth:s,errors:a,error:_,success:N,active:"stock",sousActive:"inventaire",breadcrumbs:[{text:"Inventaires",href:route("admin.stock.inventaire.index",[s.user.id]),active:!1},{text:"Inventaires Physiques",href:route("admin.inventaire.physique.index",[s.user.id]),active:!1},{text:`Inventaire #${o.id}`,href:route("admin.inventaire.physique.show",[s.user.id,o.id]),active:!0}],children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(n,{variant:"h4",component:"h1",gutterBottom:!0,children:["Inventaire Physique #",o.id]}),e.jsx(n,{variant:"subtitle1",color:"textSecondary",children:o.description||"Aucune description"})]}),e.jsx(Z,{label:o.status.replace("_"," ").toUpperCase(),color:G(o.status),size:"medium"})]}),e.jsx(i,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(B,{variant:"outlined",startIcon:e.jsx(Ce,{}),onClick:()=>T.get(route("admin.inventaire.physique.index",s.user.id)),children:"Retour à la liste"})}),e.jsx(X,{elevation:2,className:"p-4",children:e.jsxs(V,{container:!0,spacing:3,children:[e.jsxs(V,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Informations générales"}),e.jsxs(i,{className:"space-y-2",children:[e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Département:"}),e.jsx(n,{variant:"body1",children:((K=o.departement)==null?void 0:K.nom)||"Tous les départements"})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Date de début:"}),e.jsx(n,{variant:"body1",children:H(o.date_debut)})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Date de fin prévue:"}),e.jsx(n,{variant:"body1",children:H(o.date_fin)})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Créé par:"}),e.jsx(n,{variant:"body1",children:((Q=o.user)==null?void 0:Q.name)||"Inconnu"})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Notes:"}),e.jsx(n,{variant:"body1",children:o.notes||"Aucune note"})]})]})]}),e.jsxs(V,{item:!0,xs:12,md:6,children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Statistiques"}),e.jsxs(i,{className:"space-y-2",children:[e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Total produits:"}),e.jsx(n,{variant:"body1",children:d.total_produits})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Produits comptés:"}),e.jsx(n,{variant:"body1",children:d.produits_comptes})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Produits à compter:"}),e.jsx(n,{variant:"body1",children:d.produits_a_compter})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Écarts positifs:"}),e.jsx(n,{variant:"body1",color:"success.main",children:d.ecarts_positifs})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Écarts négatifs:"}),e.jsx(n,{variant:"body1",color:"error.main",children:d.ecarts_negatifs})]}),e.jsxs(i,{className:"mt-4",children:[e.jsxs(n,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Progression: ",d.progression,"%"]}),e.jsx(we,{variant:"determinate",value:d.progression,color:d.progression<50?"error":d.progression<100?"warning":"success"})]})]})]})]})}),e.jsxs(i,{className:"flex flex-wrap gap-2",children:[o.status==="planifié"&&e.jsx(B,{variant:"contained",color:"primary",startIcon:e.jsx(Ie,{}),onClick:Y,children:"Démarrer l'inventaire"}),o.status==="en_cours"&&e.jsx(B,{variant:"contained",color:"success",startIcon:e.jsx(Se,{}),onClick:z,children:"Terminer l'inventaire"}),(o.status==="planifié"||o.status==="en_cours")&&e.jsx(B,{variant:"contained",color:"error",startIcon:e.jsx(Re,{}),onClick:x,children:"Annuler l'inventaire"}),o.status==="terminé"&&e.jsx(B,{variant:"contained",color:"secondary",startIcon:e.jsx(Be,{}),onClick:b,children:"Générer les ajustements"})]}),e.jsxs(X,{elevation:2,className:"p-4",children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Liste des produits"}),e.jsx(Le,{children:e.jsxs(_e,{children:[e.jsx(Ne,{children:e.jsxs(te,{children:[e.jsx(c,{children:"Produit"}),e.jsx(c,{align:"right",children:"Quantité théorique"}),e.jsx(c,{align:"right",children:"Quantité comptée"}),e.jsx(c,{align:"right",children:"Différence"}),e.jsx(c,{children:"Statut"}),e.jsx(c,{children:"Notes"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ke,{children:y.slice(w*p,w*p+p).map(t=>{var M;return e.jsxs(te,{children:[e.jsx(c,{children:((M=t.produit)==null?void 0:M.nom)||"Produit inconnu"}),e.jsx(c,{align:"right",children:t.quantite_theorique}),e.jsx(c,{align:"right",children:t.quantite_comptee!==null?t.quantite_comptee:"-"}),e.jsx(c,{align:"right",children:t.difference!==null?e.jsxs(n,{color:U(t.difference),children:[t.difference>0?"+":"",t.difference]}):"-"}),e.jsx(c,{children:e.jsx(Z,{label:t.status.replace("_"," ").toUpperCase(),color:t.status==="en_attente"?"warning":t.status==="validé"?"success":t.status==="ajusté"?"info":"default",size:"small"})}),e.jsx(c,{children:t.notes||"-"}),e.jsx(c,{children:o.status==="en_cours"&&e.jsxs(i,{className:"flex gap-1",children:[e.jsx(se,{title:"Compter",children:e.jsx(q,{color:"primary",size:"small",onClick:()=>$(t),children:e.jsx(Ae,{fontSize:"small"})})}),t.quantite_comptee!==null&&t.status==="en_attente"&&e.jsx(se,{title:"Valider",children:e.jsx(q,{color:"success",size:"small",onClick:()=>u(t.id),children:e.jsx(Te,{fontSize:"small"})})})]})})]},t.id)})})]})}),e.jsx(ut,{rowsPerPageOptions:[5,10,25,50],component:"div",count:y.length,rowsPerPage:p,page:w,onPageChange:h,onRowsPerPageChange:S,labelRowsPerPage:"Lignes par page",labelDisplayedRows:({from:t,to:M,count:je})=>`${t}-${M} sur ${je}`})]}),e.jsxs(Ee,{open:k,onClose:R,maxWidth:"sm",fullWidth:!0,children:[e.jsx(He,{children:"Compter le produit"}),e.jsx(Ge,{children:e.jsxs(i,{className:"mt-2 space-y-4",children:[e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Produit:"}),e.jsx(n,{variant:"body1",children:((j=r==null?void 0:r.produit)==null?void 0:j.nom)||"Produit inconnu"})]}),e.jsxs(i,{className:"flex justify-between",children:[e.jsx(n,{variant:"body1",color:"textSecondary",children:"Quantité théorique:"}),e.jsx(n,{variant:"body1",children:(r==null?void 0:r.quantite_theorique)||0})]}),e.jsx(ne,{autoFocus:!0,margin:"dense",label:"Quantité comptée",type:"number",fullWidth:!0,value:A,onChange:t=>D(t.target.value),inputProps:{min:0}}),e.jsx(ne,{margin:"dense",label:"Notes",type:"text",fullWidth:!0,multiline:!0,rows:3,value:m,onChange:t=>f(t.target.value)})]})}),e.jsxs(Ue,{children:[e.jsx(B,{onClick:R,color:"inherit",startIcon:e.jsx(Qe,{}),children:"Annuler"}),e.jsx(B,{onClick:F,color:"primary",variant:"contained",startIcon:e.jsx(We,{}),children:"Enregistrer"})]})]})]})})}export{At as default};
