import{W as _,r as g,j as e,y}from"./app-eb4ac14d.js";import{M as P}from"./index-223c7b24.js";import j from"./NumberFormatCustomUtils-fb049ff7.js";import{f as u}from"./formatNumber-4d7c5d62.js";import{d as Q,I as w,P as U}from"./PanelLayout-9db7ade9.js";import{u as z,M as T}from"./index.esm-c4a53501.js";import{I as m}from"./InputError-72dd93fb.js";import{D as F}from"./Delete-98ed2789.js";import{B as h}from"./Button-7f8b9a63.js";import{A as H}from"./ArrowBack-7bd27efd.js";import{m as J}from"./motion-9f56c363.js";import{A as f}from"./Autocomplete-7942bf2c.js";import{T as r}from"./TextField-22f70a44.js";import{D as X}from"./DatePicker-25bc8498.js";import"./createSvgIcon-4d9a41bc.js";import"./index-cf4ee6ec.js";import"./Dropdown-8c28aa27.js";import"./transition-a13fe195.js";import"./Cancel-8205af54.js";import"./Edit-17e2fc58.js";import"./TableRow-9f6508f6.js";import"./Popper-1f680820.js";import"./MenuItem-3d0941cb.js";import"./LastPage-4e97b798.js";import"./SwitchBase-3ba62cb7.js";import"./Checkbox-ae5cc143.js";import"./Chip-bb44338a.js";import"./Stack-ebf23453.js";import"./CircularProgress-c9ab41e4.js";import"./DialogContent-a8b90f31.js";import"./DialogTitle-7e680bb7.js";import"./Switch-31212aee.js";const Me=({auth:p,errors:d,operation:o,produits:v,departements:M,fournisseurs:k,caisses:q,typeOperations:Y,motifs:b})=>{console.log("Operation reçue dans Edit:",o),console.log("Produits:",v),console.log("Motifs:",b);const{data:s,setData:i,put:O,processing:D,reset:Z}=_({id:o.id,date:Q(o.date),typeOperation:o.typeOperation,departementSource:o.departementSource,departementDestination:o.departementDestination,caisseSource:o.caisseSource,caisseDestination:o.caisseDestination,fournisseur:o.fournisseur,produit:null,prixAchat:"",quantiteAchat:"",produits:o.produits||[],totalProduits:o.totalCommande||0,motif:null,montantDepense:"",commentaireDepense:"",depenses:o.depenses||[],totalDepenses:o.totalDepense||0,commentaire:o.commentaire||""}),[N,E]=g.useState(""),[A,x]=g.useState(""),S=t=>{var l;t.preventDefault();const a={id:s.id,date:s.date,typeOperation:s.typeOperation,fournisseur:((l=s.fournisseur)==null?void 0:l.id)||null,departementSource:s.departementSource,departementDestination:s.departementDestination,caisseSource:s.caisseSource,caisseDestination:s.caisseDestination,produits:s.produits,depenses:s.depenses,commentaire:s.commentaire};console.log("Données envoyées au serveur:",a),O(route("admin.stock.mouvement.update",[p.user.id,s.id]),a,{preserveScroll:!0,onSuccess:()=>{E("Mouvement mis à jour avec succès"),setTimeout(()=>{y.visit(route("admin.stock.mouvement.index",p.user.id))},1500)},onError:n=>{x("Erreur lors de la mise à jour: "+(n.error||"Veuillez vérifier les champs")),console.error(n)}})},I=()=>{if(!s.produit||!s.quantiteAchat||!s.prixAchat){x("Veuillez remplir tous les champs du produit");return}const t={id:Date.now(),produit:s.produit,quantiteAchat:parseFloat(s.quantiteAchat),prixAchat:parseFloat(s.prixAchat),total:parseFloat(s.quantiteAchat)*parseFloat(s.prixAchat)},a=[...s.produits,t],l=a.reduce((n,c)=>n+c.total,0);i({...s,produits:a,totalProduits:l,produit:null,prixAchat:"",quantiteAchat:""}),x("")},V=t=>{const a=s.produits.filter(n=>n.id!==t),l=a.reduce((n,c)=>n+c.total,0);i({...s,produits:a,totalProduits:l})},G=()=>{if(!s.motif||!s.montantDepense){x("Veuillez remplir tous les champs de la dépense");return}const t={id:Date.now(),motif:s.motif,montant:parseFloat(s.montantDepense),commentaire:s.commentaireDepense||""},a=[...s.depenses,t],l=a.reduce((n,c)=>n+c.montant,0);i({...s,depenses:a,totalDepenses:l,motif:null,montantDepense:"",commentaireDepense:""}),x("")},R=t=>{const a=s.depenses.filter(n=>n.id!==t),l=a.reduce((n,c)=>n+c.montant,0);i({...s,depenses:a,totalDepenses:l})},C=()=>{y.get(route("admin.stock.mouvement.index",p.user.id))},K=g.useMemo(()=>[{accessorKey:"produit.nom",header:"Produit"},{accessorKey:"quantiteAchat",header:"Quantité",Cell:({cell:t})=>u(t.getValue())},{accessorKey:"prixAchat",header:"Prix d'achat",Cell:({cell:t})=>u(t.getValue())+" GNF"},{accessorKey:"total",header:"Total",Cell:({cell:t})=>u(t.getValue())+" GNF"},{id:"actions",header:"Actions",Cell:({row:t})=>e.jsx(w,{color:"error",onClick:()=>V(t.original.id),size:"small",children:e.jsx(F,{})})}],[]),L=g.useMemo(()=>[{accessorKey:"motif.nom",header:"Motif"},{accessorKey:"montant",header:"Montant",Cell:({cell:t})=>u(t.getValue())+" GNF"},{accessorKey:"commentaire",header:"Commentaire"},{id:"actions",header:"Actions",Cell:({row:t})=>e.jsx(w,{color:"error",onClick:()=>R(t.original.id),size:"small",children:e.jsx(F,{})})}],[]),W=z({columns:K,data:s.produits,enableColumnFilters:!1,enableColumnActions:!1,enablePagination:!1,enableBottomToolbar:!1,enableTopToolbar:!0,localization:P}),B=z({columns:L,data:s.depenses,enableColumnFilters:!1,enableColumnActions:!1,enablePagination:!1,enableBottomToolbar:!1,enableTopToolbar:!0,localization:P});return e.jsx(U,{auth:p,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",p.user.id),active:!1},{text:"Modifier",href:route("admin.stock.mouvement.edit",[p.user.id,o.id]),active:!0}],children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"p-5 bg-white rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:e.jsx("h2",{children:"Modifier le mouvement de stock"})}),e.jsx(h,{variant:"outlined",color:"secondary",startIcon:e.jsx(H,{}),onClick:C,children:"Retour"})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-700 rounded",children:N}),A&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:A}),e.jsx(J.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.3},className:"mt-5",children:e.jsx("form",{onSubmit:S,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx(X,{label:"Date",value:s.date,onChange:t=>i("date",t),slotProps:{textField:{fullWidth:!0,size:"small"}}}),e.jsx(m,{message:d.date})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.fournisseur,className:"w-full",onChange:(t,a)=>i("fournisseur",a),disablePortal:!0,options:k,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(r,{fullWidth:!0,...t,label:"Fournisseur",size:"small"}),size:"small"}),e.jsx(m,{message:d.fournisseur})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.departement,className:"w-full",onChange:(t,a)=>i("departement",a),disablePortal:!0,options:M,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(r,{fullWidth:!0,...t,label:"Département",size:"small"}),size:"small"}),e.jsx(m,{message:d.departement})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.caisse,className:"w-full",onChange:(t,a)=>i("caisse",a),disablePortal:!0,options:q,getOptionLabel:t=>t.departement.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(r,{fullWidth:!0,...t,label:"Caisse",size:"small"}),size:"small"}),e.jsx(m,{message:d.caisse})]}),e.jsx("div",{children:e.jsx(r,{value:s.commentaire,className:"w-full",label:"Commentaire",name:"commentaire",multiline:!0,rows:2,onChange:t=>i("commentaire",t.target.value),size:"small"})}),e.jsx("div",{className:"md:col-span-2 border p-3 rounded bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx("div",{className:"md:col-span-3 font-bold text-orange-500 text-xl",children:"Produits"}),e.jsxs("div",{children:[e.jsx(f,{value:s.produit,className:"w-full",onChange:(t,a)=>i("produit",a),disablePortal:!0,options:v,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(r,{fullWidth:!0,...t,label:"Produit",size:"small"}),size:"small"}),e.jsx(m,{message:d.produit})]}),e.jsxs("div",{children:[e.jsx(r,{value:s.quantiteAchat,InputProps:{inputComponent:j},className:"w-full",label:"Quantité",name:"quantiteAchat",onChange:t=>i("quantiteAchat",t.target.value),size:"small"}),e.jsx(m,{message:d.quantiteAchat})]}),e.jsxs("div",{children:[e.jsx(r,{value:s.prixAchat,InputProps:{inputComponent:j,endAdornment:"GNF"},className:"w-full",label:"Prix d'achat",name:"prixAchat",onChange:t=>i("prixAchat",t.target.value),size:"small"}),e.jsx(m,{message:d.prixAchat})]}),e.jsx("div",{className:"md:col-span-3 w-fit",children:e.jsx(h,{onClick:I,variant:"contained",sx:{color:"white"},color:"primary",type:"button",size:"small",children:"Ajouter"})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(T,{table:W})}),s.totalProduits>0&&e.jsx("div",{className:"md:col-span-3 w-fit p-2 rounded bg-black text-white",children:"Total: "+u(s.totalProduits)+" GNF"})]})}),e.jsx("div",{className:"md:col-span-2 border p-3 rounded bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Dépenses supplémentaires"}),e.jsxs("div",{children:[e.jsx(f,{value:s.motif,className:"w-full",onChange:(t,a)=>i("motif",a),disablePortal:!0,options:b,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(r,{fullWidth:!0,...t,label:"Motif",size:"small"}),size:"small"}),e.jsx(m,{message:d.motif})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(r,{value:s.montantDepense,InputProps:{inputComponent:j,endAdornment:"GNF"},className:"w-full",label:"Montant",name:"montantDepense",onChange:t=>i("montantDepense",t.target.value),size:"small"}),e.jsx(m,{message:d.montantDepense})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(r,{value:s.commentaireDepense,className:"w-full",label:"Commentaire",name:"commentaireDepense",onChange:t=>i("commentaireDepense",t.target.value),size:"small"})}),e.jsx("div",{className:"md:col-span-2 w-fit",children:e.jsx(h,{onClick:G,variant:"contained",sx:{color:"white"},color:"primary",type:"button",size:"small",children:"Ajouter"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(T,{table:B})}),s.totalDepenses>0&&e.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total: "+u(s.totalDepenses)+" GNF"})]})}),(s.totalProduits>0||s.totalDepenses>0)&&e.jsx("div",{className:"md:col-span-2 w-fit p-3 rounded bg-black text-white font-bold",children:"Total général: "+u(s.totalProduits+s.totalDepenses)+" GNF"}),e.jsxs("div",{className:"w-full md:col-span-2 flex gap-4 mt-6 py-3 px-4 bg-gray-100 rounded",children:[e.jsx(h,{variant:"contained",color:"primary",type:"submit",disabled:D,children:D?"Enregistrement...":"Enregistrer les modifications"}),e.jsx(h,{variant:"outlined",color:"secondary",onClick:C,children:"Annuler"})]})]})})})]})})})};export{Me as default};
