import{j as e,r as c,W as qe,y as m}from"./app-ef847769.js";import{P as Ae,a as _,T as a,B as A}from"./PanelLayout-f3b1b528.js";/* empty css            */import{u as We,M as Ve}from"./index.esm-f651ad8d.js";import{M as Ge}from"./index.esm-4bae7fd4.js";import{I as y}from"./InputError-101e4114.js";import{B as t}from"./Button-5cd339f2.js";import{V as Ke}from"./Visibility-4a9b5128.js";import{E as Re}from"./Edit-56c024d5.js";import{D as Le}from"./Delete-578fe21d.js";import{C as ce}from"./Check-a16d6a02.js";import{D as I,a as w,b as W}from"./DialogContent-21eccb4c.js";import{D as F}from"./DialogTitle-8810badb.js";import{T as C,F as z,I as D,S as E}from"./TextField-239b9d80.js";import{A as P}from"./Autocomplete-e3bbac74.js";import{C as me}from"./Close-a9dab803.js";import{G as d}from"./Grid-8b166bc4.js";import{W as ue}from"./Warning-612afa65.js";import{c as V}from"./createSvgIcon-1d15f18d.js";import{T as $e}from"./TrendingUp-e6794fd7.js";import{M as u}from"./MenuItem-7e314da3.js";import{C as T}from"./Chip-7ba2869a.js";import{A as Be}from"./AddCircle-aaca1f2f.js";import{f as M}from"./helpers.segment-8c19304b.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./index-63345e99.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./TableRow-e01d0199.js";import"./Popper-fafd03d0.js";import"./DatePicker-17c52b79.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./Switch-00012cca.js";const pe=V(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),Ue=V(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"}),"FileDownload"),He=V(e.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"FileUpload");function Pi({auth:n,errors:g,produits:k,typeProduits:S,categories:N,departements:b,error:xe,success:he,filters:l,stats:r}){var ee,ie,re,oe,le,te,ne,ae,se;const[G,ge]=c.useState({pageIndex:k.current_page-1,pageSize:k.per_page}),[j,K]=c.useState((l==null?void 0:l.categorie_id)||""),[v,R]=c.useState((l==null?void 0:l.type_produit_id)||""),[p,L]=c.useState((l==null?void 0:l.stock_filter)||"all"),[f,$]=c.useState((l==null?void 0:l.departement_id)||""),je=i=>{ge(i),m.get(route("admin.stock.produit.index",{userId:n.user.id}),{page:i.pageIndex+1,per_page:i.pageSize},{preserveState:!0,preserveScroll:!0,only:["produits"]})},ve=i=>{m.get(route("admin.stock.produit.index",{userId:n.user.id}),{search:i,page:1,categorie_id:j,type_produit_id:v,stock_filter:p,departement_id:f},{preserveState:!0,preserveScroll:!0,only:["produits"]})},x=(i,o)=>{switch(i){case"categorie":K(o);break;case"typeProduit":R(o);break;case"stock":L(o);break;case"departement":$(o);break}m.get(route("admin.stock.produit.index",{userId:n.user.id}),{search:(l==null?void 0:l.search)||"",page:1,categorie_id:i==="categorie"?o:j,type_produit_id:i==="typeProduit"?o:v,stock_filter:i==="stock"?o:p,departement_id:i==="departement"?o:f},{preserveState:!0,preserveScroll:!0,only:["produits","stats"]})},fe=i=>{i.length>0&&m.get(route("admin.stock.produit.index",{userId:n.user.id}),{sort_field:i[0].id,sort_direction:i[0].desc?"desc":"asc",page:G.pageIndex+1,categorie_id:j,type_produit_id:v,stock_filter:p,departement_id:f},{preserveState:!0,preserveScroll:!0,only:["produits"]})},be=i=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(i),{data:s,setData:h,post:ye,put:Ce,reset:O}=qe({id:"",nom:"",typeProduit:null,categorie:null}),[ke,q]=c.useState(!1),[Se,B]=c.useState(!1),[Ne,U]=c.useState(!1),[_e,H]=c.useState(!1),Ie=()=>{m.get(route("admin.stock.produit.create",{userId:n.user.id}),{onSuccess:()=>O()})},we=i=>{const o=i.target.files[0];if(o){const de=new FormData;de.append("file",o),m.post(route("admin.stock.produit.import-csv",{userId:n.user.id}),de,{onSuccess:()=>{i.target.value=null}})}},Q=()=>{q(!1)},Y=()=>{B(!1)},Fe=()=>{U(!1)},J=()=>{H(!1)},X=i=>{i.target.type==="checkbox"?h(i.target.name,i.target.checked):h(i.target.name,i.target.value)},ze=()=>{ye(route("admin.stock.produit.store"),{onSuccess:()=>{O(),q(!1)}})},De=i=>{m.get(route("admin.stock.produit.edit",[n.user.id,i.id]),{preserveScroll:!0})},Ee=i=>{h({id:i.id,nom:i.nom||"",typeProduit:i.type_souscripteur||null,categorie:i.categorie_souscripteur||null}),U(!0)},Z=(i,o)=>{h({id:i,message:o}),H(!0)},Pe=()=>{Ce(route("admin.stock.produit.update",s.id),{onSuccess:()=>{O(),B(!1)}})},Te=()=>{q(!1),m.delete(route("admin.stock.produit.destroy",{id:s.id}))},Me=c.useMemo(()=>[{accessorKey:"nom",header:"Nom"},{accessorKey:"mode_achat",header:"Mode de vente",Cell:({row:i})=>i.original.quantiteEnsemble>0?"Ensemble":"Unité"},{accessorKey:"prixAchat",header:"Prix d'achat (GNF)",Cell:({row:i})=>M(i.original.prixAchat??0)},{accessorKey:"quantiteEnsemble",header:"Quantité par ensemble",Cell:({row:i})=>M(i.original.quantiteEnsemble??0)},{accessorKey:"prixVente",header:"Prix de vente unité (GNF)",Cell:({row:i})=>M(i.original.prixVente??0)},{accessorKey:"prixEnsemble",header:"Prix de vente ensemble (GNF)",Cell:({row:i})=>i.original.quantiteEnsemble>0?M(i.original.prixEnsemble??0):"-"},{accessorKey:"categorie",header:"Categorie",Cell:({row:i})=>{var o;return(o=i.original.categorie)==null?void 0:o.libelle}},{accessorKey:"status",header:"Status",Cell:({row:i})=>i.original.status?e.jsx("div",{className:"p-2 font-bold bg-green-500 text-white w-fit h-fit rounded",children:"Actif"}):e.jsx("div",{className:"p-2 font-bold bg-red-500 text-white w-fit h-fit rounded",children:"Inactif"})},{accessorKey:"action",header:"Action",Cell:({row:i})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:()=>Ee(i.original),variant:"contained",size:"small",color:"info",children:e.jsx(Ke,{})}),e.jsx(t,{onClick:()=>De(i.original),variant:"contained",size:"small",color:"secondary",children:e.jsx(Re,{})}),i.original.status?e.jsx(t,{onClick:()=>Z(i.original.id,"delete"),variant:"contained",size:"small",color:"error",children:e.jsx(Le,{})}):e.jsx(t,{onClick:()=>Z(i.original.id,"check"),variant:"contained",size:"small",color:"success",children:e.jsx(ce,{})})]},i.original.id)}],[]),Oe=We({columns:Me,data:k.data,getRowId:i=>i.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,onGlobalFilterChange:ve,onPaginationChange:je,onSortingChange:fe,rowCount:k.total,state:{pagination:G},localization:Ge});return e.jsx(Ae,{auth:n,success:he,error:xe,errors:g,active:"stock",sousActive:"produit",breadcrumbs:[{text:"Stock",href:route("admin.dashboard",{id:n.user.id}),active:!1},{text:"Produits",href:route("admin.stock.produit.index",{userId:n.user.id}),active:!0}],children:e.jsxs("div",{className:"grid gap-5 bg-gray-200 p-2 rounded border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"flex items-center flex-wrap gap-2 bg-black p-2 rounded",children:e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Liste des produits"})}),e.jsxs(I,{open:ke,onClose:Q,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Ajout du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(C,{value:s.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(y,{message:g.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(P,{className:"w-full",onChange:(i,o)=>h("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(y,{message:g["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(P,{className:"w-full",onChange:(i,o)=>h("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(y,{message:g["data.categorie"]})]})]})}),e.jsxs(W,{children:[e.jsx(t,{variant:"contained",color:"error",onClick:Q,children:"Annuler"}),e.jsx(t,{variant:"contained",color:"success",onClick:ze,children:"Enregistrer"})]})]}),e.jsxs(I,{open:Se,onClose:Y,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Modification du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(C,{value:s.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(y,{message:g.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(P,{value:s.typeProduit,className:"w-full",onChange:(i,o)=>h("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(y,{message:g["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(P,{value:s.categorie,className:"w-full",onChange:(i,o)=>h("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(y,{message:g["data.categorie"]})]})]})}),e.jsxs(W,{children:[e.jsx(t,{variant:"contained",color:"error",onClick:Y,children:"Annuler"}),e.jsx(t,{variant:"contained",color:"success",onClick:Pe,children:"Enregistrer"})]})]}),e.jsxs(I,{open:Ne,onClose:Fe,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Details du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:s.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ee=s.typeProduit)==null?void 0:ee.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(ie=s.categorie)==null?void 0:ie.nom})]})]})})]}),e.jsxs(I,{open:_e,onClose:J,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[s.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",s.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(W,{children:[e.jsxs(t,{variant:"contained",color:"error",onClick:J,children:[e.jsx(me,{}),"  Non"]}),e.jsxs(t,{variant:"contained",color:"success",onClick:Te,children:[e.jsx(ce,{})," Oui"]})]})]})]}),e.jsx("div",{children:e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(a,{variant:"h6",color:"primary",children:"Total Produits"}),e.jsx(a,{variant:"h5",children:r!=null&&r.departement?r.departement.total_produits:(r==null?void 0:r.total_produits)||0})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#fff9c4"},children:[e.jsxs(a,{variant:"h6",color:"warning.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{fontSize:"small",sx:{mr:1}})," Stock Critique"]}),e.jsx(a,{variant:"h5",color:"warning.main",children:r!=null&&r.departement?r.departement.stockCritique:(r==null?void 0:r.stockCritique)||0}),e.jsx(a,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((re=r.departement)==null?void 0:re.stockCritique)||0)/(((oe=r.departement)==null?void 0:oe.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stockCritique)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#ffebee"},children:[e.jsxs(a,{variant:"h6",color:"error",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",sx:{mr:1}})," Stock Épuisé"]}),e.jsx(a,{variant:"h5",color:"error",children:r!=null&&r.departement?r.departement.stock_epuise:(r==null?void 0:r.stock_epuise)||0}),e.jsx(a,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((le=r.departement)==null?void 0:le.stock_epuise)||0)/(((te=r.departement)==null?void 0:te.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stock_epuise)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#e8f5e9"},children:[e.jsxs(a,{variant:"h6",color:"success.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx($e,{fontSize:"small",sx:{mr:1}})," Valeur Stock"]}),e.jsx(a,{variant:"h5",color:"success.main",children:be(r!=null&&r.departement?r.departement.valeur_totale_stock:(r==null?void 0:r.valeur_totale_stock)||0)})]})})]})}),e.jsxs("div",{className:"grid gap-2 bg-white p-2",children:[e.jsxs(d,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(a,{variant:"subtitle1",sx:{mb:1,fontWeight:"bold"},children:"Filtres"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Département"}),e.jsxs(E,{value:f,onChange:i=>x("departement",i.target.value),label:"Département",children:[e.jsx(u,{value:"",children:"Tous les départements"}),b==null?void 0:b.map(i=>e.jsx(u,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Catégorie"}),e.jsxs(E,{value:j,onChange:i=>x("categorie",i.target.value),label:"Catégorie",children:[e.jsx(u,{value:"",children:"Toutes les catégories"}),N.map(i=>e.jsx(u,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Type de produit"}),e.jsxs(E,{value:v,onChange:i=>x("typeProduit",i.target.value),label:"Type de produit",children:[e.jsx(u,{value:"",children:"Tous les types"}),S.map(i=>e.jsx(u,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"État du stock"}),e.jsxs(E,{value:p,onChange:i=>x("stock",i.target.value),label:"État du stock",children:[e.jsx(u,{value:"all",children:"Tous les produits"}),e.jsx(u,{value:"low",children:e.jsxs(A,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ue,{fontSize:"small",color:"warning",sx:{mr:1}}),"Stock critique"]})}),e.jsx(u,{value:"out",children:e.jsxs(A,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",color:"error",sx:{mr:1}}),"Stock épuisé"]})})]})]})})]}),(f||j||v||p!=="all")&&e.jsxs(A,{sx:{mb:2,display:"flex",flexWrap:"wrap",gap:1},children:[e.jsx(a,{variant:"body2",sx:{mr:1,display:"flex",alignItems:"center"},children:"Filtres actifs:"}),f&&e.jsx(T,{label:`Département: ${((ne=b==null?void 0:b.find(i=>i.id===parseInt(f)))==null?void 0:ne.nom)||""}`,onDelete:()=>x("departement",""),color:"primary",variant:"outlined",size:"small"}),j&&e.jsx(T,{label:`Catégorie: ${((ae=N.find(i=>i.id===parseInt(j)))==null?void 0:ae.nom)||""}`,onDelete:()=>x("categorie",""),color:"primary",variant:"outlined",size:"small"}),v&&e.jsx(T,{label:`Type: ${((se=S.find(i=>i.id===parseInt(v)))==null?void 0:se.nom)||""}`,onDelete:()=>x("typeProduit",""),color:"primary",variant:"outlined",size:"small"}),p!=="all"&&e.jsx(T,{label:p==="low"?"Stock critique":"Stock épuisé",onDelete:()=>x("stock","all"),color:p==="low"?"warning":"error",variant:"outlined",size:"small"}),e.jsx(t,{variant:"text",size:"small",startIcon:e.jsx(me,{fontSize:"small"}),onClick:()=>{$(""),K(""),R(""),L("all"),m.get(route("admin.stock.produit.index",{userId:n.user.id}),{page:1})},children:"Réinitialiser tous les filtres"})]}),e.jsxs("div",{className:"flex gap-2 justify-end mb-2",children:[e.jsxs(t,{color:"success",variant:"outlined",onClick:()=>window.location.href=route("admin.stock.produit.export-csv",{userId:n.user.id}),children:[e.jsx(Ue,{className:"mr-1"})," Exporter CSV"]}),e.jsxs("label",{htmlFor:"upload-csv",children:[e.jsx("input",{style:{display:"none"},id:"upload-csv",name:"upload-csv",type:"file",accept:".csv",onChange:we}),e.jsxs(t,{color:"info",variant:"outlined",component:"span",children:[e.jsx(He,{className:"mr-1"})," Importer CSV"]})]}),e.jsxs(t,{color:"warning",variant:"contained",onClick:Ie,children:[e.jsx(Be,{className:"mr-1"})," Ajout produit"]})]}),e.jsx(Ve,{table:Oe})]})]})})}export{Pi as default};
