import{r as i,W as ze,j as e,y as Re}from"./app-eb4ac14d.js";import{u as Fe,M as Ae}from"./index.esm-c4a53501.js";import{M as Ie}from"./index.esm-4bae7fd4.js";import{I as g}from"./InputError-72dd93fb.js";import{P as De,S as $}from"./PanelLayout-9db7ade9.js";import{B as r}from"./Button-7f8b9a63.js";import{P as ee}from"./PictureAsPdf-a2d36ec4.js";import{A as Be}from"./AddCircle-9c227046.js";import{D as N,a as w,b as T}from"./DialogContent-a8b90f31.js";import{D as b}from"./DialogTitle-7e680bb7.js";import{T as x,M as Te}from"./TextField-22f70a44.js";import{C as L}from"./Checkbox-ae5cc143.js";import{C as Le}from"./Close-7d5020eb.js";import{C as se}from"./Check-b85e105e.js";import{V as Oe}from"./Visibility-c9cb56b1.js";import{E as We}from"./Edit-9517b33c.js";import{D as Ke}from"./Delete-98ed2789.js";import{M as O}from"./MenuItem-3d0941cb.js";import"./createSvgIcon-4d9a41bc.js";import"./index-cf4ee6ec.js";import"./Cancel-8205af54.js";import"./Edit-17e2fc58.js";import"./TableRow-9f6508f6.js";import"./Popper-1f680820.js";import"./DatePicker-25bc8498.js";import"./Chip-bb44338a.js";import"./LastPage-4e97b798.js";import"./SwitchBase-3ba62cb7.js";import"./Stack-ebf23453.js";import"./CircularProgress-c9ab41e4.js";import"./Switch-31212aee.js";import"./Autocomplete-7942bf2c.js";import"./Dropdown-8c28aa27.js";import"./transition-a13fe195.js";function ws({auth:t,users:j,roles:v,error:S,errors:d,success:y,total:le,actif:ae,inactif:ie}){var X,Y,Z;const[oe,W]=i.useState([]),[K,U]=i.useState(!1),[re,c]=i.useState(!1),[ne,n]=i.useState(!1),[te,V]=i.useState(0),[_,G]=i.useState(null),de=!!_,ce=s=>{G(s.currentTarget)},k=()=>{G(null)},[C,me]=i.useState([]),[E,pe]=i.useState(""),[M,xe]=i.useState([]),[u,ue]=i.useState({pageIndex:j.current_page-1,pageSize:j.per_page}),{data:l,setData:m,post:he,put:ge,reset:P}=ze({id:"",slug:"",nom:"",prenom:"",email:"",password:"",roles:[],filters:C??[]});i.useEffect(()=>{V(j.total),W(j.data),n(!1)},[j]),i.useEffect(()=>{n(!0),c(!0),axios.post(route("user.paginationFiltre"),{start:u.pageIndex*u.pageSize,size:u.pageSize,filters:C??[],globalFilter:E??"",sorting:M??[]}).then(s=>{W(s.data.data),V(s.data.rowCount),c(!1),n(!1)}).catch(s=>{U(!0)}),U(!1),c(!1),n(!1)},[C,E,u.pageIndex,u.pageSize,M]);const[z,R]=i.useState(!1),[je,F]=i.useState(!1),[fe,q]=i.useState(!1),[ve,A]=i.useState(!1),Ce=()=>{P(),R(!0)},I=()=>{R(!1)},H=()=>{F(!1)},Ne=()=>{q(!1)},J=()=>{A(!1)},h=s=>{s.target.type==="checkbox"?m(s.target.name,s.target.checked):m(s.target.name,s.target.value)},we=()=>{n(!0),c(!0),he(route("user.store"),{onSuccess:()=>{P(),R(!1),n(!1),c(!1)}})},be=s=>{m({id:s.id,slug:s.slug,prenom:s.prenom||"",nom:s.nom||"",email:s.email||"",roles:s.roles||[]}),F(!0)},Se=s=>{m({id:s.id,slug:s.slug,prenom:s.prenom||"",nom:s.nom||"",email:s.email||"",roles:s.roles||[]}),q(!0)},Q=(s,a)=>{m({slug:s,message:a}),A(!0)},ye=()=>{ge(route("user.update",l.slug),{onSuccess:()=>{P(),F(!1)}})},ke=()=>{n(!0),c(!0),A(!1),Re.delete(route("user.destroy",{slug:l.slug}),{preserveScroll:!0,onSuccess:()=>{n(!1),c(!1)}})},Ee=[{permission:"show-users",condition:s=>!0,title:"Détails",color:"secondary",icon:e.jsx(Oe,{}),onClick:s=>Se(s.original)},{permission:"edit-users",condition:s=>!0,title:"Modifier",color:"info",icon:e.jsx(We,{}),onClick:s=>be(s.original)},{permission:"delete-users",condition:s=>s.original.status,title:"Suspendre",color:"error",icon:e.jsx(Ke,{}),onClick:s=>Q(s.original.slug,"delete")},{permission:"delete-users",condition:s=>!s.original.status,title:"Activer",color:"success",icon:e.jsx(se,{}),onClick:s=>Q(s.original.slug,"check")}],Me=i.useMemo(()=>[{accessorKey:"prenom",header:"Prénom"},{accessorKey:"nom",header:"Nom"},{accessorKey:"login",header:"Login"},{accessorKey:"email",header:"Email"},{accessorKey:"action",header:"Action",enableColumnFilter:!1,Cell:({row:s})=>e.jsx("div",{className:"flex gap-2",children:Ee.map(a=>{var o;return((o=t==null?void 0:t.permissions)==null?void 0:o.includes(a.permission))&&a.condition(s)&&e.jsx(r,{title:a.title,onClick:()=>a.onClick(s),variant:"outlined",size:"small",color:a.color,children:a.icon},a.permission)})},s.original.id)}],[]),D=s=>{},Pe=Fe({columns:Me,data:oe,getRowId:s=>s.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,muiToolbarAlertBannerProps:K?{color:"error",children:"Erreur de chargement des données"}:void 0,onColumnFiltersChange:me,onGlobalFilterChange:pe,onPaginationChange:ue,onSortingChange:xe,rowCount:te,state:{columnFilters:C,globalFilter:E,isLoading:re,pagination:u,showAlertBanner:K,showProgressBars:ne,sorting:M},localization:Ie,renderTopToolbarCustomActions:({table:s})=>e.jsxs("div",{className:"flex",children:[e.jsx(r,{id:"basic-button","aria-controls":z?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":z?"true":void 0,size:"small",color:"error",onClick:ce,startIcon:e.jsx(ee,{color:"error"}),children:"Export"}),e.jsxs(Te,{id:"basic-menu",anchorEl:_,open:de,onClose:I,MenuListProps:{"aria-labelledby":"basic-button"},children:[e.jsx(O,{onClick:()=>{D(s.getPrePaginationRowModel().rows),k()},disabled:s.getPrePaginationRowModel().rows.length===0,children:"Toutes les lignes"}),e.jsx(O,{onClick:()=>{D(s.getRowModel().rows),k()},disabled:s.getRowModel().rows.length===0,children:"Lignes de la page"}),e.jsx(O,{onClick:()=>{D(s.getSelectedRowModel().rows),k()},disabled:!s.getIsSomeRowsSelected()&&!s.getIsAllRowsSelected(),children:"Lignes selectionnées"})]})]})}),B=s=>{m("roles",[...l.roles.filter(a=>a.id!==s.target.name),{id:s.target.name,status:s.target.checked}])};return e.jsxs(De,{auth:t,success:y,error:S,active:"user",children:[e.jsxs("div",{className:"grid gap-2 w-full mb-20",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"w-full flex lg:hidden primaryBgColor p-1 font-bold text-white rounded",children:"Gestion des users"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 w-full",children:[e.jsxs("div",{className:"primaryBgColor text-white p-2 rounded",children:[e.jsx("div",{className:"text-3xl font-bold",children:le}),e.jsx("div",{children:"Utilisateurs"})]}),e.jsxs("div",{className:"secondaryBgColor text-white p-2 rounded",children:[e.jsx("div",{className:"text-3xl font-bold",children:ae}),e.jsx("div",{children:"Actifs"})]}),e.jsxs("div",{className:"bg-red-500 text-white p-2 rounded",children:[e.jsx("div",{className:"text-3xl font-bold",children:ie}),e.jsx("div",{children:"Inactifs"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"contained",color:"error",size:"small",children:e.jsx(ee,{size:5,className:"text-white"})}),(X=t==null?void 0:t.permissions)==null?void 0:X.map(s=>s==="create-users"?e.jsxs(r,{onClick:Ce,variant:"contained",color:"secondary",size:"small",children:[e.jsx(Be,{className:"text-white"})," ",e.jsx("div",{className:"text-white",children:"User"})]},s):"")]}),e.jsx("div",{className:"w-full overflow-hidden",children:e.jsx(Ae,{table:Pe})}),e.jsxs(N,{open:z,onClose:I,children:[e.jsx(b,{className:"primaryBgColor text-white",children:"Ajout d'un user"}),e.jsxs(w,{className:"space-y-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(x,{value:l.prenom,autoFocus:!0,id:"prenom",name:"prenom",label:"Prénom",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.prenom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{value:l.nom,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{value:l.email,id:"email",name:"email",label:"Email",type:"email",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{id:"password",type:"password",name:"password",label:"Password",value:l.password,className:"mt-1 block w-full",autoComplete:"current-password",onChange:s=>m("password",s.target.value)}),e.jsx("div",{className:"text-white mt-2 text-sm",children:d.password})]})]}),e.jsxs("div",{className:"bg-white mt-10 w-full",children:[e.jsx("div",{className:"flex p-2 rounded font-bold text-xl",children:"Sélectionnez les roles"}),e.jsx("div",{className:"flex gap-10 flex-wrap p-2 rounded",children:v.map((s,a)=>{var o;return e.jsxs("div",{className:"grip gap-5",children:[e.jsxs("div",{className:"capitalize font-bold primaryColor",children:[e.jsx(L,{onClick:B,name:s.id+""}),s.libelle]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(o=s.permissions)==null?void 0:o.map((p,f)=>e.jsx("span",{className:"rounded border px-1",children:p.libelle},f))})]},a)})})]})]}),e.jsxs(T,{children:[e.jsx(r,{variant:"contained",color:"error",onClick:I,children:"Annuler"}),e.jsx(r,{variant:"contained",color:"success",onClick:we,children:"Enregistrer"})]})]}),e.jsxs(N,{open:je,onClose:H,children:[e.jsx(b,{className:"primaryBgColor text-white",children:"Modification du user"}),e.jsxs(w,{className:"space-y-5",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(x,{value:l.prenom,autoFocus:!0,id:"prenom",name:"prenom",label:"Prénom",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.prenom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{value:l.nom,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{value:l.email,id:"email",name:"email",label:"Email",type:"email",className:"bg-white",fullWidth:!0,onChange:h}),e.jsx(g,{message:d.email,className:"mt-2"})]})]}),e.jsxs("div",{className:"bg-white mt-10 w-full",children:[e.jsx("div",{className:"flex p-2 rounded font-bold text-xl",children:"Sélectionnez les roles"}),e.jsx("div",{className:"flex gap-10 flex-wrap p-2 rounded",children:v==null?void 0:v.map((s,a)=>{var o;return e.jsxs("div",{className:"grip gap-5",children:[e.jsxs("div",{className:"capitalize font-bold primaryColor",children:[e.jsx(L,{defaultChecked:!!l.roles.find(p=>s.id===p.id),onClick:B,name:s.id+""}),s.libelle]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(o=s.permissions)==null?void 0:o.map((p,f)=>e.jsx("span",{className:"rounded border px-1",children:p.libelle},f))})]},a)})})]})]}),e.jsxs(T,{children:[e.jsx(r,{variant:"contained",color:"error",onClick:H,children:"Annuler"}),e.jsx(r,{variant:"contained",color:"success",onClick:ye,children:"Enregistrer"})]})]}),e.jsxs(N,{open:fe,onClose:Ne,children:[e.jsx(b,{className:"primaryBgColor text-white",children:"Details du user"}),e.jsxs(w,{className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 mt-5 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"PRENOM"}),e.jsx("div",{className:"py-2 px-2",children:l.prenom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:l.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"EMAIL"}),e.jsx("div",{className:"py-2 px-2",children:l.email})]})]}),((Y=l.roles)==null?void 0:Y.length)>0&&e.jsxs("div",{className:"bg-white mt-10 w-full",children:[e.jsx("div",{className:"flex p-2 rounded font-bold text-xl",children:"Roles de l'utilisateur"}),e.jsx("div",{className:"flex gap-10 flex-wrap p-2 rounded",children:(Z=l.roles)==null?void 0:Z.map((s,a)=>{var o;return e.jsxs("div",{className:"grip gap-5",children:[e.jsxs("div",{className:"capitalize font-bold primaryColor",children:[e.jsx(L,{disabled:!0,defaultChecked:!0,onClick:B,name:s.id+""}),s.libelle]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(o=s.permissions)==null?void 0:o.map((p,f)=>e.jsx("span",{className:"rounded border px-1",children:p.libelle},f))})]},a)})})]})]})]}),e.jsxs(N,{open:ve,onClose:J,children:[e.jsx(b,{className:"primaryBgColor text-white",children:"Suppression du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[l.message==="delete"&&"Voulez-vous vraiment suspendre ce user",l.message==="check"&&"Voulez-vous vraiment débloquer ce user"]})}),e.jsxs(T,{children:[e.jsxs(r,{variant:"contained",color:"error",onClick:J,children:[e.jsx(Le,{}),"  Non"]}),e.jsxs(r,{variant:"contained",color:"success",onClick:ke,children:[e.jsx(se,{})," Oui"]})]})]})]}),y&&e.jsx($,{success:y}),S&&e.jsx($,{error:S})]})}export{ws as default};
