import{W as J,r as j,j as e,y as w}from"./app-ef847769.js";import{M as z}from"./index-223c7b24.js";import v from"./NumberFormatCustomUtils-99ba5477.js";import{f as u}from"./formatNumber-4d7c5d62.js";import{d as X,I as T,P as Y}from"./PanelLayout-f3b1b528.js";import{u as M,M as F}from"./index.esm-f651ad8d.js";import{I as d}from"./InputError-101e4114.js";import{F as k,S as E,T as m,I as Z}from"./TextField-239b9d80.js";import{M as g}from"./MenuItem-7e314da3.js";import{D as S}from"./Delete-578fe21d.js";import{B as h}from"./Button-5cd339f2.js";import{A as $}from"./ArrowBack-609c6f32.js";import{m as ee}from"./motion-af0b5e75.js";import{A as f}from"./Autocomplete-e3bbac74.js";import{D as te}from"./DatePicker-17c52b79.js";import"./createSvgIcon-1d15f18d.js";import"./index-63345e99.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./TableRow-e01d0199.js";import"./Popper-fafd03d0.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Chip-7ba2869a.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./DialogContent-21eccb4c.js";import"./DialogTitle-8810badb.js";import"./Switch-00012cca.js";const qe=({auth:p,errors:r,operation:o,produits:b,departements:_,fournisseurs:q,caisses:I,typeOperations:se,motifs:D})=>{console.log("Operation reçue dans Edit:",o),console.log("Produits:",b),console.log("Motifs:",D);const{data:s,setData:i,put:O,processing:y,reset:ae}=J({id:o.id,date:X(o.date),typeOperation:o.typeOperation,departementSource:o.departementSource,departementDestination:o.departementDestination,caisseSource:o.caisseSource,caisseDestination:o.caisseDestination,fournisseur:o.fournisseur,produit:null,prixAchat:"",quantiteAchat:"",produits:o.produits||[],totalProduits:o.totalCommande||0,motif:null,montantDepense:"",commentaireDepense:"",depenses:o.depenses||[],totalDepenses:o.totalDepense||0,commentaire:o.commentaire||""}),[N,V]=j.useState(""),[C,x]=j.useState(""),W=t=>{var l;t.preventDefault();const a={id:s.id,date:s.date,typeOperation:s.typeOperation,fournisseur:((l=s.fournisseur)==null?void 0:l.id)||null,departementSource:s.departementSource,departementDestination:s.departementDestination,caisseSource:s.caisseSource,caisseDestination:s.caisseDestination,produits:s.produits,depenses:s.depenses,commentaire:s.commentaire};console.log("Données envoyées au serveur:",a),O(route("admin.stock.mouvement.update",[p.user.id,s.id]),a,{preserveScroll:!0,onSuccess:()=>{V("Mouvement mis à jour avec succès"),setTimeout(()=>{w.visit(route("admin.stock.mouvement.index",p.user.id))},1500)},onError:n=>{x("Erreur lors de la mise à jour: "+(n.error||"Veuillez vérifier les champs")),console.error(n)}})},K=()=>{if(!s.produit||!s.quantiteAchat||!s.prixAchat){x("Veuillez remplir tous les champs du produit");return}const t={id:Date.now(),produit:s.produit,quantiteAchat:parseFloat(s.quantiteAchat),prixAchat:parseFloat(s.prixAchat),type_produit_id:s.type_produit_id||1,total:parseFloat(s.quantiteAchat)*parseFloat(s.prixAchat)},a=[...s.produits,t],l=a.reduce((n,c)=>n+c.total,0);i({...s,produits:a,totalProduits:l,produit:null,prixAchat:"",quantiteAchat:""}),x("")},L=t=>{const a=s.produits.filter(n=>n.id!==t),l=a.reduce((n,c)=>n+c.total,0);i({...s,produits:a,totalProduits:l})},R=()=>{if(!s.motif||!s.montantDepense){x("Veuillez remplir tous les champs de la dépense");return}const t={id:Date.now(),motif:s.motif,montant:parseFloat(s.montantDepense),commentaire:s.commentaireDepense||""},a=[...s.depenses,t],l=a.reduce((n,c)=>n+c.montant,0);i({...s,depenses:a,totalDepenses:l,motif:null,montantDepense:"",commentaireDepense:""}),x("")},G=t=>{const a=s.depenses.filter(n=>n.id!==t),l=a.reduce((n,c)=>n+c.montant,0);i({...s,depenses:a,totalDepenses:l})},A=()=>{w.get(route("admin.stock.mouvement.index",p.user.id))},B=j.useMemo(()=>[{accessorKey:"produit.nom",header:"Produit"},{accessorKey:"type_produit_id",header:"Type d'achat",Cell:({row:t,cell:a})=>{const l=n=>{const c=n.target.value,P=[...s.produits];P[t.index].type_produit_id=c,i({...s,produits:P})};return e.jsx(k,{fullWidth:!0,size:"small",children:e.jsxs(E,{value:a.getValue()||1,onChange:l,size:"small",children:[e.jsx(g,{value:1,children:"Unité"}),e.jsx(g,{value:2,children:"Ensemble"})]})})}},{accessorKey:"quantiteAchat",header:"Quantité",Cell:({cell:t})=>u(t.getValue())},{accessorKey:"prixAchat",header:"Prix d'achat",Cell:({cell:t})=>u(t.getValue())+" GNF"},{accessorKey:"total",header:"Total",Cell:({cell:t})=>u(t.getValue())+" GNF"},{id:"actions",header:"Actions",Cell:({row:t})=>e.jsx(T,{color:"error",onClick:()=>L(t.original.id),size:"small",children:e.jsx(S,{})})}],[]),U=j.useMemo(()=>[{accessorKey:"motif.nom",header:"Motif"},{accessorKey:"montant",header:"Montant",Cell:({cell:t})=>u(t.getValue())+" GNF"},{accessorKey:"commentaire",header:"Commentaire"},{id:"actions",header:"Actions",Cell:({row:t})=>e.jsx(T,{color:"error",onClick:()=>G(t.original.id),size:"small",children:e.jsx(S,{})})}],[]),Q=M({columns:B,data:s.produits,enableColumnFilters:!1,enableColumnActions:!1,enablePagination:!1,enableBottomToolbar:!1,enableTopToolbar:!0,localization:z}),H=M({columns:U,data:s.depenses,enableColumnFilters:!1,enableColumnActions:!1,enablePagination:!1,enableBottomToolbar:!1,enableTopToolbar:!0,localization:z});return e.jsx(Y,{auth:p,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",p.user.id),active:!1},{text:"Modifier",href:route("admin.stock.mouvement.edit",[p.user.id,o.id]),active:!0}],children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"p-5 bg-white rounded",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:e.jsx("h2",{children:"Modifier le mouvement de stock"})}),e.jsx(h,{variant:"outlined",color:"secondary",startIcon:e.jsx($,{}),onClick:A,children:"Retour"})]}),N&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 text-green-700 rounded",children:N}),C&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:C}),e.jsx(ee.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{duration:.3},className:"mt-5",children:e.jsx("form",{onSubmit:W,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx(te,{label:"Date",value:s.date,onChange:t=>i("date",t),slotProps:{textField:{fullWidth:!0,size:"small"}}}),e.jsx(d,{message:r.date})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.fournisseur,className:"w-full",onChange:(t,a)=>i("fournisseur",a),disablePortal:!0,options:q,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(m,{fullWidth:!0,...t,label:"Fournisseur",size:"small"}),size:"small"}),e.jsx(d,{message:r.fournisseur})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.departement,className:"w-full",onChange:(t,a)=>i("departement",a),disablePortal:!0,options:_,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(m,{fullWidth:!0,...t,label:"Département",size:"small"}),size:"small"}),e.jsx(d,{message:r.departement})]}),e.jsxs("div",{children:[e.jsx(f,{value:s.caisse,className:"w-full",onChange:(t,a)=>i("caisse",a),disablePortal:!0,options:I,getOptionLabel:t=>t.departement.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(m,{fullWidth:!0,...t,label:"Caisse",size:"small"}),size:"small"}),e.jsx(d,{message:r.caisse})]}),e.jsx("div",{children:e.jsx(m,{value:s.commentaire,className:"w-full",label:"Commentaire",name:"commentaire",multiline:!0,rows:2,onChange:t=>i("commentaire",t.target.value),size:"small"})}),e.jsx("div",{className:"md:col-span-2 border p-3 rounded bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[e.jsx("div",{className:"md:col-span-3 font-bold text-orange-500 text-xl",children:"Produits"}),e.jsxs("div",{children:[e.jsx(f,{value:s.produit,className:"w-full",onChange:(t,a)=>i("produit",a),disablePortal:!0,options:b,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(m,{fullWidth:!0,...t,label:"Produit",size:"small"}),size:"small"}),e.jsx(d,{message:r.produit})]}),e.jsxs("div",{children:[e.jsx(m,{value:s.quantiteAchat,InputProps:{inputComponent:v,inputProps:{max:1e11,min:0}},className:"w-full",label:"Quantité",name:"quantiteAchat",onChange:t=>i("quantiteAchat",t.target.value),size:"small"}),e.jsx(d,{message:r.quantiteAchat})]}),e.jsxs("div",{children:[e.jsxs(k,{fullWidth:!0,size:"small",children:[e.jsx(Z,{children:"Type d'achat"}),e.jsxs(E,{value:s.type_produit_id||1,label:"Type d'achat",onChange:t=>i("type_produit_id",t.target.value),children:[e.jsx(g,{value:1,children:"Unité"}),e.jsx(g,{value:2,children:"Ensemble"})]})]}),e.jsx(d,{message:r.type_produit_id})]}),e.jsxs("div",{children:[e.jsx(m,{value:s.prixAchat,InputProps:{inputComponent:v,inputProps:{max:1e11,min:0,devise:"gnf"}},className:"w-full",label:"Prix d'achat",name:"prixAchat",onChange:t=>i("prixAchat",t.target.value),size:"small"}),e.jsx(d,{message:r.prixAchat})]}),e.jsx("div",{className:"md:col-span-3 w-fit",children:e.jsx(h,{onClick:K,variant:"contained",sx:{color:"white"},color:"primary",type:"button",size:"small",children:"Ajouter"})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(F,{table:Q})}),s.totalProduits>0&&e.jsx("div",{className:"md:col-span-3 w-fit p-2 rounded bg-black text-white",children:"Total: "+u(s.totalProduits)+" GNF"})]})}),e.jsx("div",{className:"md:col-span-2 border p-3 rounded bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Dépenses supplémentaires"}),e.jsxs("div",{children:[e.jsx(f,{value:s.motif,className:"w-full",onChange:(t,a)=>i("motif",a),disablePortal:!0,options:D,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,a)=>t.id===a.id,renderInput:t=>e.jsx(m,{fullWidth:!0,...t,label:"Motif",size:"small"}),size:"small"}),e.jsx(d,{message:r.motif})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(m,{value:s.montantDepense,InputProps:{inputComponent:v,endAdornment:"GNF",max:1e11,min:0},className:"w-full",label:"Montant",name:"montantDepense",onChange:t=>i("montantDepense",t.target.value),size:"small"}),e.jsx(d,{message:r.montantDepense})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(m,{value:s.commentaireDepense,className:"w-full",label:"Commentaire",name:"commentaireDepense",onChange:t=>i("commentaireDepense",t.target.value),size:"small"})}),e.jsx("div",{className:"md:col-span-2 w-fit",children:e.jsx(h,{onClick:R,variant:"contained",sx:{color:"white"},color:"primary",type:"button",size:"small",children:"Ajouter"})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(F,{table:H})}),s.totalDepenses>0&&e.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total: "+u(s.totalDepenses)+" GNF"})]})}),(s.totalProduits>0||s.totalDepenses>0)&&e.jsx("div",{className:"md:col-span-2 w-fit p-3 rounded bg-black text-white font-bold",children:"Total général: "+u(s.totalProduits+s.totalDepenses)+" GNF"}),e.jsxs("div",{className:"w-full md:col-span-2 flex gap-4 mt-6 py-3 px-4 bg-gray-100 rounded",children:[e.jsx(h,{variant:"contained",color:"primary",type:"submit",disabled:y,children:y?"Enregistrement...":"Enregistrer les modifications"}),e.jsx(h,{variant:"outlined",color:"secondary",onClick:A,children:"Annuler"})]})]})})})]})})})};export{qe as default};
