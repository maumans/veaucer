import{j as e,r as a,y as d,W as Xe}from"./app-4edf48e5.js";import{d as O,P as Ze,L as $e,b as et}from"./PanelLayout-f2722d4d.js";/* empty css            */import{u as tt,M as st}from"./index.esm-9dae7fe5.js";import{M as at}from"./index.esm-4bae7fd4.js";import{I as g}from"./InputError-6da1aa5e.js";import{C as f}from"./Chip-0001e9bb.js";import{B as l}from"./Button-287e2751.js";import{V as I}from"./Visibility-1d75f6de.js";import{E as lt}from"./Edit-d3d63b61.js";import{S as ge}from"./SwapHoriz-ef2588ca.js";import{D as ot}from"./Delete-1f926d7e.js";import{D as b,a as N,b as A}from"./DialogContent-8a1e29b1.js";import{D as y}from"./DialogTitle-9058224f.js";import{T as n}from"./TextField-552e66ea.js";import{A as p}from"./Autocomplete-296c4901.js";import{A as rt}from"./Add-bf114621.js";import{C as ve}from"./Close-18195805.js";import{C as nt}from"./Check-c32f5732.js";import{c as fe}from"./createSvgIcon-5bc31cb8.js";import{D as je}from"./DatePicker-b73dcf77.js";import{F as it}from"./FilterList-a7f18bc5.js";import{A as dt}from"./AddCircle-b634ae43.js";import{f as ct}from"./helpers.segment-8c19304b.js";import"./Dropdown-4c3aabf3.js";import"./transition-92123e1c.js";import"./index-17fa150b.js";import"./Cancel-a6a6eef9.js";import"./Edit-fc260d54.js";import"./TableRow-96be2280.js";import"./Popper-aabbbbc2.js";import"./MenuItem-b79354fa.js";import"./LastPage-76c05c1b.js";import"./SwitchBase-2ee5bbf3.js";import"./Checkbox-521167ff.js";import"./Stack-01e86631.js";import"./CircularProgress-210c747e.js";import"./Switch-3b9ccd2c.js";const mt=fe(e.jsx("path",{d:"M19 13H5v-2h14v2z"}),"Remove"),ut=fe(e.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");function pt(o,m){const c=a.useRef(!0);a.useEffect(()=>{if(c.current)c.current=!1;else return o()},m)}function ss({auth:o,errors:m,operations:c,departements:be,fournisseurs:Ne,typeOperations:ye,typeProduits:L,categorieProduits:P,error:Ce,success:Se}){var te,se,ae,le,oe;const[V,xt]=a.useState(!1),[Ee,ht]=a.useState(!1),[we,gt]=a.useState(!1),[ke,vt]=a.useState(0),[C,v]=a.useState([]),[S,ze]=a.useState(""),[E,Te]=a.useState([]),[x,_]=a.useState({pageIndex:c.current_page-1,pageSize:c.per_page});pt(()=>{const t={};C.forEach(s=>{s.id==="date_range"&&typeof s.value=="object"?t.date_range=s.value:t[s.id]=s.value}),console.log("Filtres envoyés au backend:",t),d.get(route("admin.stock.mouvement.index",[o.user.id]),{start:x.pageIndex*x.pageSize,size:x.pageSize,filters:t,globalFilter:S??"",sorting:E??[]},{preserveScroll:!0,preserveState:!0})},[x.pageIndex,x.pageSize,S,C,E]);const{data:r,setData:h,post:Fe,put:De,reset:R}=Xe({id:"",nom:"",typeProduit:null,categorieProduit:null}),[Me,W]=a.useState(!1),[Oe,Y]=a.useState(!1),[Ie,Ae]=a.useState(!1),[Le,Pe]=a.useState(!1),j=t=>{d.get(route("admin.stock.mouvement.create",o.user.id),{mouvement:t},{onSuccess:()=>R()})},q=()=>{W(!1)},H=()=>{Y(!1)},Ve=()=>{Ae(!1)},K=()=>{Pe(!1)},B=t=>{t.target.type==="checkbox"?h(t.target.name,t.target.checked):h(t.target.name,t.target.value)},_e=t=>{t.preventDefault(),Fe(route("admin.stock.mouvement.store"),{...r,preserveScroll:!0})},Re=t=>{d.get(route("admin.stock.mouvement.edit",[o.user.id,t.id]),{preserveScroll:!0,onError:s=>{console.error("Erreur lors de la redirection vers la page d'édition:",s),alert("Erreur lors de la redirection vers la page d'édition. Veuillez réessayer.")}})},We=t=>{d.get(route("admin.stock.mouvement.show",[o.user.id,t]),{preserveState:!0,onSuccess:()=>{},onError:s=>{console.error("Erreur lors de l'affichage des détails:",s),alert("Erreur lors de l'affichage des détails: "+(s.error||"Veuillez réessayer."))}})},Ye=t=>{confirm("Êtes-vous sûr de vouloir supprimer ce mouvement ? Cette action est irréversible.")&&d.delete(route("admin.stock.mouvement.destroy",[o.user.id,t]),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{alert("Mouvement supprimé avec succès"),d.reload({only:["operations"]})},onError:s=>{console.error("Erreur lors de la suppression:",s),alert("Erreur lors de la suppression: "+(s.error||"Veuillez réessayer."))}})},qe=t=>{confirm("Êtes-vous sûr de vouloir annuler ce mouvement ? Cette action créera une opération inverse.")&&d.get(route("admin.stock.mouvement.cancel",[o.user.id,t]),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{alert("Mouvement annulé avec succès. Une opération inverse a été créée."),d.reload({only:["operations"]})},onError:s=>{console.error("Erreur lors de l'annulation:",s),alert("Erreur lors de l'annulation: "+(s.error||"Veuillez réessayer."))}})},He=()=>{De(route("admin.stock.mouvement.update",r.id),{onSuccess:()=>{R(),Y(!1)}})},Ke=()=>{W(!1),d.delete(route("admin.stock.mouvement.destroy",{id:r.id}))},Be=a.useMemo(()=>[{accessorKey:"date",header:"Date",Cell:({row:t})=>O(t.original.date).format("DD/MM/YYYY")},{accessorKey:"type_operation",header:"Type",Cell:({row:t})=>{var s,i,re,ne,ie,de,ce,me,ue,pe,xe,he;return((re=(i=(s=t.original)==null?void 0:s.type_operation)==null?void 0:i.nom)==null?void 0:re.toLowerCase())==="entrée"?e.jsx(f,{label:"Entrée",color:"success"}):((de=(ie=(ne=t.original)==null?void 0:ne.type_operation)==null?void 0:ie.nom)==null?void 0:de.toLowerCase())==="sortie"?e.jsx(f,{label:"Sortie",color:"error"}):((ue=(me=(ce=t.original)==null?void 0:ce.type_operation)==null?void 0:me.nom)==null?void 0:ue.toLowerCase())==="transfert"?e.jsx(f,{label:"Transfert",color:"warning"}):e.jsx(f,{label:(he=(xe=(pe=t.original)==null?void 0:pe.type_operation)==null?void 0:xe.nom)==null?void 0:he.toLowerCase(),color:"default"})}},{accessorKey:"departement_destination_id",header:"Departement destination",Cell:({row:t})=>{var s;return(s=t.original.departement_destination)==null?void 0:s.nom}},{accessorKey:"montant",header:"Total",Cell:({row:t})=>t.original.montant?ct(t.original.montant)+" GNF":""},{accessorKey:"fournisseur.nom",header:"Fournisseur",Cell:({row:t})=>{var s;return(s=t.original.fournisseur)==null?void 0:s.nom}},{accessorKey:"etat",header:"Etat",Cell:({row:t})=>t.original.etat==="COMMANDE"?e.jsx("div",{className:"p-2 font-bold bg-green-500 text-white w-fit h-fit rounded",children:t.original.etat}):t.original.etat==="ANNULE"?e.jsx("div",{className:"p-2 font-bold bg-red-500 text-white w-fit h-fit rounded",children:t.original.etat}):e.jsx("div",{className:"p-2 font-bold bg-blue-500 text-white w-fit h-fit rounded",children:t.original.etat})},{accessorKey:"action",header:"Action",Cell:({row:t})=>e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(l,{variant:"contained",color:"primary",size:"small",onClick:()=>We(t.original.id),title:"Voir les détails",children:e.jsx(I,{fontSize:"small"})}),t.original.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"contained",color:"success",size:"small",onClick:()=>Re(t.original),title:"Modifier",children:e.jsx(lt,{fontSize:"small"})}),e.jsx(l,{variant:"contained",color:"warning",size:"small",onClick:()=>qe(t.original.id),title:"Annuler le mouvement",children:e.jsx(ge,{fontSize:"small"})}),e.jsx(l,{variant:"contained",color:"error",size:"small",onClick:()=>Ye(t.original.id),title:"Supprimer",children:e.jsx(ot,{fontSize:"small"})})]}),!t.original.status&&e.jsx("span",{className:"px-2 py-1 bg-gray-200 text-gray-600 rounded text-xs",children:"Mouvement inactif"})]})}],[]),[U,G]=a.useState(!1),[u,w]=a.useState([null,null]),[k,J]=a.useState(null),[z,Q]=a.useState(null),[T,X]=a.useState(null),[F,Z]=a.useState(""),[D,$]=a.useState(""),[M,ee]=a.useState(null),Ue=[{id:"VALIDE",nom:"Validé"},{id:"EN_ATTENTE",nom:"En attente"},{id:"ANNULE",nom:"Annulé"}],Ge=()=>{v([]);let t=[];k&&t.push({id:"type_operation",value:k.id}),z&&t.push({id:"departement",value:z.id}),T&&t.push({id:"fournisseur",value:T.id}),u[0]&&u[1]&&t.push({id:"date_range",value:{start:O(u[0]).format("YYYY-MM-DD"),end:O(u[1]).format("YYYY-MM-DD")}}),F&&t.push({id:"min_montant",value:F}),D&&t.push({id:"max_montant",value:D}),M&&t.push({id:"etat",value:M.id}),console.log("Nouveaux filtres appliqués:",t),setTimeout(()=>{v(t)},0)},Je=()=>{w([null,null]),J(null),Q(null),X(null),Z(""),$(""),ee(null),console.log("Réinitialisation des filtres"),v([]),_(t=>({...t,pageIndex:0}))},Qe=tt({columns:Be,data:c.data,getRowId:t=>t.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualSorting:!0,muiToolbarAlertBannerProps:V?{color:"error",children:"Error loading data"}:void 0,onColumnFiltersChange:v,onGlobalFilterChange:ze,onPaginationChange:_,onSortingChange:Te,rowCount:ke,state:{columnFilters:C,globalFilter:S,isLoading:Ee,pagination:x,showAlertBanner:V,showProgressBars:we,sorting:E},localization:at});return e.jsx(Ze,{auth:o,success:Se,error:Ce,errors:m,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",[o.user.id]),active:!1}],children:e.jsxs("div",{className:"grid gap-5 bg-gray-200 p-2 rounded border",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(l,{color:"info",variant:"contained",onClick:()=>d.get(route("admin.stock.mouvement.dashboard",o.user.id)),children:[e.jsx(I,{className:"mr-1"})," Tableau de bord"]}),e.jsxs(b,{open:Me,onClose:q,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Ajout du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(n,{value:r.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:B}),e.jsx(g,{message:m.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{className:"w-full",onChange:(t,s)=>h("typeProduit",s),disablePortal:!0,options:L,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{fullWidth:!0,...t,placeholder:"Type de produit",label:t.nom})}),e.jsx(g,{message:m["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{className:"w-full",onChange:(t,s)=>h("categorieProduit",s),disablePortal:!0,options:P,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{fullWidth:!0,...t,placeholder:"Catégorie de produit",label:t.nom})}),e.jsx(g,{message:m["data.categorieProduit"]})]})]})}),e.jsxs(A,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:q,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:_e,children:"Enregistrer"})]})]}),e.jsxs(b,{open:Oe,onClose:H,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Modification du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(n,{value:r.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:B}),e.jsx(g,{message:m.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{value:r.typeProduit,className:"w-full",onChange:(t,s)=>h("typeProduit",s),disablePortal:!0,options:L,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{fullWidth:!0,...t,placeholder:"Type de produit",label:t.nom})}),e.jsx(g,{message:m["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{value:r.categorieProduit,className:"w-full",onChange:(t,s)=>h("categorieProduit",s),disablePortal:!0,options:P,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{fullWidth:!0,...t,placeholder:"Catégorie de produit",label:t.nom})}),e.jsx(g,{message:m["data.categorieProduit"]})]})]})}),e.jsxs(A,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:H,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:He,children:"Enregistrer"})]})]}),e.jsxs(b,{open:Ie,onClose:Ve,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Details du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold",children:"Liste des mouvements de stock"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"outlined",color:"info",startIcon:e.jsx(I,{}),onClick:()=>d.get(route("admin.stock.mouvement.dashboard",o.user.id)),children:"Tableau de bord"}),e.jsx(l,{variant:"contained",color:"primary",startIcon:e.jsx(rt,{}),onClick:()=>j(),children:"Nouveau mouvement"})]})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:r.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(te=r.typeProduit)==null?void 0:te.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(se=r.categorieProduit)==null?void 0:se.nom})]})]})})]}),e.jsxs(b,{open:Le,onClose:K,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[r.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",r.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(A,{children:[e.jsxs(l,{variant:"contained",color:"error",onClick:K,children:[e.jsx(ve,{}),"  Non"]}),e.jsxs(l,{variant:"contained",color:"success",onClick:Ke,children:[e.jsx(nt,{})," Oui"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-blue-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Total des mouvements"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:c.total||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Tous types confondus"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Entrées de stock"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((ae=c.data)==null?void 0:ae.filter(t=>{var s,i;return(i=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:i.toLowerCase().includes("entrée")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Approvisionnements et ajustements positifs"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-red-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Sorties de stock"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((le=c.data)==null?void 0:le.filter(t=>{var s,i;return(i=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:i.toLowerCase().includes("sortie")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Ventes et ajustements négatifs"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-orange-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Ajustements d'inventaire"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((oe=c.data)==null?void 0:oe.filter(t=>{var s,i;return(i=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:i.toLowerCase().includes("ajustement")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Suite aux inventaires physiques"})]})]}),e.jsxs("div",{className:"overflow-auto space-y-2 bg-white p-2 rounded",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx(l,{color:"primary",onClick:()=>G(!U),variant:"outlined",startIcon:e.jsx(ut,{}),children:"Filtres avancés"})}),U&&e.jsxs("div",{className:"bg-white p-4 mb-4 rounded shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Filtres avancés"}),e.jsx(l,{variant:"outlined",color:"error",size:"small",onClick:()=>G(!1),children:e.jsx(ve,{fontSize:"small"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(p,{value:k,onChange:(t,s)=>J(s),options:ye||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{...t,label:"Type d'opération",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:z,onChange:(t,s)=>Q(s),options:be||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{...t,label:"Département",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:T,onChange:(t,s)=>X(s),options:Ne||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{...t,label:"Fournisseur",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:M,onChange:(t,s)=>ee(s),options:Ue,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(n,{...t,label:"État",fullWidth:!0,size:"small"})})}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:e.jsx($e,{dateAdapter:et,adapterLocale:"fr",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(je,{label:"Date de début",value:u[0],onChange:t=>w([t,u[1]]),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(je,{label:"Date de fin",value:u[1],onChange:t=>w([u[0],t]),slotProps:{textField:{size:"small",fullWidth:!0}}})]})})}),e.jsx("div",{children:e.jsx(n,{label:"Montant minimum",value:F,onChange:t=>Z(t.target.value),type:"number",fullWidth:!0,size:"small"})}),e.jsx("div",{children:e.jsx(n,{label:"Montant maximum",value:D,onChange:t=>$(t.target.value),type:"number",fullWidth:!0,size:"small"})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outlined",color:"error",onClick:Je,children:"Réinitialiser"}),e.jsx(l,{variant:"contained",color:"primary",onClick:Ge,startIcon:e.jsx(it,{}),children:"Appliquer les filtres"})]})]}),e.jsxs("div",{className:"flex gap-5 flex-wrap justify-end",children:[e.jsxs(l,{color:"success",variant:"contained",onClick:()=>j("Entrée"),children:[e.jsx(dt,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Entrée"})]}),e.jsxs(l,{color:"warning",variant:"contained",onClick:()=>j("Transfert"),children:[e.jsx(ge,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Transfert"})]}),e.jsxs(l,{color:"error",variant:"contained",onClick:()=>j("Sortie"),children:[e.jsx(mt,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Sortie"})]})]}),e.jsx(st,{table:Qe})]})]})})}export{ss as default};
