import{j as e,r as f,y as ae}from"./app-4edf48e5.js";import{T as s,d as w,P as we,A as De,a as He,L as re,b as te,B as ze}from"./PanelLayout-f2722d4d.js";import{f as Pe}from"./helpers.segment-8c19304b.js";import{C as Ae,a as Le,L as Te,P as Re,b as Ee,B as Fe,A as Ye,p as Ie,c as Be,d as Ve,i as We,I as $e,T as Me,e as Ue,f as Ge,g as Qe,D as ke}from"./index-42b2b994.js";import{W as Je}from"./Warning-4e203777.js";import{c as L,g as Ke,a as Oe,s as T,u as Xe,b as Ze,d as qe}from"./createSvgIcon-5bc31cb8.js";import{L as Se,R as ea}from"./Refresh-9527fd57.js";import{T as aa}from"./TrendingUp-7f02a804.js";import{F as se}from"./FilterList-a7f18bc5.js";import{D as le}from"./DatePicker-b73dcf77.js";import{F as ra,I as ta,S as sa}from"./TextField-552e66ea.js";import{M as de}from"./MenuItem-b79354fa.js";import{C as A}from"./Chip-0001e9bb.js";import{B as oe}from"./Button-287e2751.js";import{C as H}from"./CircularProgress-210c747e.js";import{G as g}from"./Grid-7a3a83b6.js";import{C as j,a as u}from"./CardContent-f1bdd9bb.js";import{_ as z,a as la}from"./index-17fa150b.js";import"./Dropdown-4c3aabf3.js";import"./transition-92123e1c.js";import"./Popper-aabbbbc2.js";import"./DialogContent-8a1e29b1.js";const da=L(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h10v-2H4v-6h18V6c0-1.11-.89-2-2-2zm0 4H4V6h16v2zm4 9v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"}),"AddCard"),oa=L(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"}),"Assignment"),na=L(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12zm8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8z"}),"Block"),ia=L(e.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"}),"CalendarToday");function ca(i){return Oe("MuiCardHeader",i)}const xa=Ke("MuiCardHeader",["root","avatar","action","content","title","subheader"]),ne=xa,ma=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],pa=i=>{const{classes:d}=i;return qe({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},ca,d)},ba=T("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(i,d)=>z({[`& .${ne.title}`]:d.title,[`& .${ne.subheader}`]:d.subheader},d.root)})({display:"flex",alignItems:"center",padding:16}),ha=T("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(i,d)=>d.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),ga=T("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(i,d)=>d.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ja=T("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(i,d)=>d.content})({flex:"1 1 auto"}),ua=f.forwardRef(function(d,c){const o=Xe({props:d,name:"MuiCardHeader"}),{action:r,avatar:l,className:t,component:x="div",disableTypography:n=!1,subheader:P,subheaderTypographyProps:C,title:N,titleTypographyProps:v}=o,D=la(o,ma),b=z({},o,{component:x,disableTypography:n}),p=pa(b);let h=N;h!=null&&h.type!==s&&!n&&(h=e.jsx(s,z({variant:l?"body2":"h5",className:p.title,component:"span",display:"block"},v,{children:h})));let m=P;return m!=null&&m.type!==s&&!n&&(m=e.jsx(s,z({variant:l?"body2":"body1",className:p.subheader,color:"text.secondary",component:"span",display:"block"},C,{children:m}))),e.jsxs(ba,z({className:Ze(p.root,t),as:x,ref:c,ownerState:b},D,{children:[l&&e.jsx(ha,{className:p.avatar,ownerState:b,children:l}),e.jsxs(ja,{className:p.content,ownerState:b,children:[h,m]}),r&&e.jsx(ga,{className:p.action,ownerState:b,children:r})]}))}),y=ua,ie={red:"bg-red-500 text-white",blue:"bg-blue-500 text-white",green:"bg-green-500 text-white",yellow:"bg-yellow-400 text-black",gray:"bg-gray-500 text-white",orange:"bg-orange-500 text-white",indigo:"bg-indigo-500 text-white",purple:"bg-purple-500 text-white",teal:"bg-teal-500 text-white",amber:"bg-amber-500 text-white"},ce={red:"text-red-500",blue:"text-blue-500",green:"text-green-500",yellow:"text-yellow-400",gray:"text-gray-500",orange:"text-orange-500",indigo:"text-indigo-500",purple:"text-purple-500",teal:"text-teal-500",amber:"text-amber-500"};function ya({id:i,title:d,icon:c,color:o="gray",montant:r,devise:l}){const t=ie[o]||ie.gray,x=ce[o]||ce.gray;return e.jsxs("div",{className:`rounded p-5 sm:grid flex justify-between flex-wrap gap-2 ${t}`,children:[e.jsxs("div",{className:"flex gap-5",children:[e.jsx("div",{className:`rounded-full w-fit h-fit bg-white p-1 ${x}`,children:c}),e.jsx("div",{children:d.toUpperCase()})]}),e.jsxs("div",{className:"flex gap-1 border-2 p-2 rounded w-fit",children:[e.jsx("div",{className:"lg:text-3xl text-xl font-bold",children:Pe(r)}),l&&e.jsx("div",{className:"self-end",children:l})]})]},i)}Ae.register(Le,Te,Re,Ee,Fe,Ye,Ie,Be,Ve,We);function Ma({auth:i,errors:d,produitsStats:c,mouvementsStats:o,inventairesStats:r,graphiquesMouvements:l,graphiquesStock:t,departements:x,filtres:n}){var Y,I,B,V,W,$,M,U,G,Q,k,J,K,O,X,Z,q,S;const[P,C]=f.useState(null),[N,v]=f.useState(!0),[D,b]=f.useState(n!=null&&n.date_debut?w(n.date_debut):w().subtract(1,"month")),[p,h]=f.useState(n!=null&&n.date_fin?w(n.date_fin):w()),[m,F]=f.useState((n==null?void 0:n.departement_id)||""),[R,_]=f.useState(!1),xe=()=>{_(!0),C(null),ae.get(route("admin.dashboard",i.user.id),{date_debut:D.format("YYYY-MM-DD"),date_fin:p.format("YYYY-MM-DD"),departement_id:m||""},{preserveState:!0,onSuccess:()=>{_(!1),v(!0)},onError:a=>{_(!1),v(!1),C("Erreur lors du chargement des données. Veuillez réessayer ou contacter l'administrateur."),console.error("Erreur de chargement du dashboard:",a)}})},me=()=>{b(w().subtract(1,"month")),h(w()),F(""),_(!0),C(null),ae.get(route("admin.dashboard",i.user.id),{},{preserveState:!0,onSuccess:()=>{_(!1),v(!0)},onError:a=>{_(!1),v(!1),C("Erreur lors du chargement des données. Veuillez réessayer ou contacter l'administrateur."),console.error("Erreur de chargement du dashboard:",a)}})},pe={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Mouvements de stock par jour"}}},be={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Top 5 fournisseurs par nombre de mouvements"}}},he={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},title:{display:!0,text:"Répartition du stock par catégorie"}}},ge={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},title:{display:!0,text:"Répartition du stock par département"}}},je={labels:((Y=l==null?void 0:l.par_jour)==null?void 0:Y.map(a=>a.date))||[],datasets:[{label:"Entrées",data:((I=l==null?void 0:l.par_jour)==null?void 0:I.map(a=>a.entrees))||[],borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",tension:.3},{label:"Sorties",data:((B=l==null?void 0:l.par_jour)==null?void 0:B.map(a=>a.sorties))||[],borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)",tension:.3}]},ue={labels:((V=l==null?void 0:l.par_fournisseur)==null?void 0:V.map(a=>a.nom))||[],datasets:[{label:"Nombre de mouvements",data:((W=l==null?void 0:l.par_fournisseur)==null?void 0:W.map(a=>a.total))||[],backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)"],borderWidth:1}]},ye={labels:(($=t==null?void 0:t.par_categorie)==null?void 0:$.map(a=>a.nom))||[],datasets:[{label:"Quantité en stock",data:((M=t==null?void 0:t.par_categorie)==null?void 0:M.map(a=>a.total_stock))||[],backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)","rgba(201, 203, 207, 0.7)","rgba(255, 99, 71, 0.7)","rgba(50, 205, 50, 0.7)","rgba(138, 43, 226, 0.7)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(201, 203, 207, 1)","rgba(255, 99, 71, 1)","rgba(50, 205, 50, 1)","rgba(138, 43, 226, 1)"],borderWidth:1}]},fe={labels:((U=t==null?void 0:t.par_departement)==null?void 0:U.map(a=>a.nom))||[],datasets:[{label:"Quantité en stock",data:((G=t==null?void 0:t.par_departement)==null?void 0:G.map(a=>a.total_stock))||[],backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"],borderColor:["rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},Ce=[{id:1,icon:e.jsx($e,{}),title:"Produits en stock",montant:(c==null?void 0:c.total)||0,color:"blue"},{id:2,icon:e.jsx(Je,{}),title:"Stock critique",montant:(c==null?void 0:c.stockCritique)||0,color:"orange"},{id:3,icon:e.jsx(na,{}),title:"Stock épuisé",montant:(c==null?void 0:c.stock_epuise)||0,color:"red"},{id:4,icon:e.jsx(Se,{}),title:"Mouvements",montant:(o==null?void 0:o.total)||0,color:"green"},{id:5,icon:e.jsx(aa,{}),title:"Entrées (valeur)",montant:(o==null?void 0:o.valeur_entrees)||0,color:"indigo",devise:"GNF"},{id:6,icon:e.jsx(Me,{}),title:"Sorties (valeur)",montant:(o==null?void 0:o.valeur_sorties)||0,color:"purple",devise:"GNF"},{id:7,icon:e.jsx(oa,{}),title:"Inventaires",montant:(r==null?void 0:r.total_inventaires)||0,color:"teal"},{id:8,icon:e.jsx(da,{}),title:"Ajustements",montant:(r==null?void 0:r.total_ajustements)||0,color:"amber"}];return e.jsxs(we,{auth:i,errors:d,active:"adminDashboard",children:[P&&e.jsx(De,{severity:"error",className:"mb-4",children:P}),e.jsxs(He,{elevation:2,className:"p-4 grid gap-2 mb-6 space-y-4",children:[e.jsxs(s,{variant:"h6",className:"mb-4",children:[e.jsx(se,{className:"mr-2"})," Filtres"]}),e.jsxs("div",{className:" grid md:grid-cols-3 gap-2",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx(re,{dateAdapter:te,adapterLocale:"fr",children:e.jsx(le,{label:"Date de début",value:D,onChange:a=>b(a),slotProps:{textField:{fullWidth:!0,size:"small"}}})})}),e.jsx("div",{children:e.jsx(re,{dateAdapter:te,adapterLocale:"fr",children:e.jsx(le,{label:"Date de fin",value:p,onChange:a=>h(a),slotProps:{textField:{fullWidth:!0,size:"small"}}})})}),e.jsx("div",{children:e.jsxs(ra,{fullWidth:!0,size:"small",children:[e.jsx(ta,{children:"Département"}),e.jsxs(sa,{value:m,onChange:a=>F(a.target.value),label:"Département",children:[e.jsx(de,{value:"",children:"Tous les départements"}),x==null?void 0:x.map(a=>e.jsx(de,{value:a.id,children:a.nom},a.id))]})]})})]}),e.jsxs(ze,{className:"flex items-center",children:[e.jsx(ia,{fontSize:"small",className:"mr-2 text-gray-500"}),e.jsxs(s,{variant:"body2",className:"text-gray-600",children:["Période : ",e.jsx(A,{size:"small",label:`${D.format("DD/MM/YYYY")} - ${p.format("DD/MM/YYYY")}`}),m&&(x==null?void 0:x.find(a=>a.id===m))&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"|"}),e.jsx("span",{children:"Département : "}),e.jsx(A,{size:"small",label:x.find(a=>a.id===m).nom})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex justify-end space-x-2 w-fit",children:[e.jsx(oe,{variant:"contained",color:"primary",onClick:xe,disabled:R,fullWidth:!0,children:R?e.jsx(H,{size:20}):e.jsxs(e.Fragment,{children:[e.jsx(se,{})," Appliquer"]})}),e.jsxs(oe,{fullWidth:!0,variant:"outlined",color:"secondary",onClick:me,disabled:R,children:[e.jsx(ea,{}),"Réinitialiser"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:N?Ce.map(({icon:a,title:E,montant:Ne,color:ve,id:ee,devise:_e})=>e.jsx(ya,{id:ee,icon:a,color:ve,montant:Ne,title:E,devise:_e},ee)):e.jsxs("div",{className:"col-span-4 text-center py-8",children:[e.jsx(H,{}),e.jsx(s,{variant:"body1",className:"mt-2",children:"Chargement des statistiques..."})]})}),N?e.jsxs(g,{container:!0,spacing:4,className:"mb-6",children:[e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Évolution des mouvements"}),e.jsx(u,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(Ue,{options:pe,data:je})})})]})}),e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Top fournisseurs"}),e.jsx(u,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(Ge,{options:be,data:ue})})})]})}),e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Stock par catégorie"}),e.jsx(u,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(Qe,{options:he,data:ye})})})]})}),e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Stock par département"}),e.jsx(u,{children:e.jsx("div",{style:{height:"300px"},children:e.jsx(ke,{options:ge,data:fe})})})]})})]}):e.jsxs("div",{className:"text-center py-8 mb-6",children:[e.jsx(H,{}),e.jsx(s,{variant:"body1",className:"mt-2",children:"Chargement des graphiques..."})]}),N?e.jsxs(j,{className:"mb-6",children:[e.jsx(y,{title:"Produits en stock critique",action:e.jsx(A,{label:`${((Q=t==null?void 0:t.produits_critiques)==null?void 0:Q.length)||0} produits`,color:"warning",size:"small"})}),e.jsx(u,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Produit"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantité actuelle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Seuil critique"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[(k=t==null?void 0:t.produits_critiques)==null?void 0:k.map((a,E)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.nom}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.quantite}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.stockCritique||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(A,{label:a.quantite===0?"Épuisé":"Critique",color:a.quantite===0?"error":"warning",size:"small"})})]},E)),(!(t!=null&&t.produits_critiques)||t.produits_critiques.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-6 py-4 text-center text-sm text-gray-500",children:"Aucun produit en stock critique"})})]})]})})})]}):e.jsxs("div",{className:"text-center py-8 mb-6",children:[e.jsx(H,{}),e.jsx(s,{variant:"body1",className:"mt-2",children:"Chargement des produits critiques..."})]}),N?e.jsxs(g,{container:!0,spacing:4,children:[e.jsx(g,{item:!0,xs:12,md:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Inventaires physiques"}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-blue-800",children:"Planifiés"}),e.jsx(s,{variant:"h4",className:"font-bold text-blue-800",children:((J=r==null?void 0:r.inventaires_par_statut)==null?void 0:J.planifie)||0})]}),e.jsxs("div",{className:"bg-amber-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-amber-800",children:"En cours"}),e.jsx(s,{variant:"h4",className:"font-bold text-amber-800",children:((K=r==null?void 0:r.inventaires_par_statut)==null?void 0:K.en_cours)||0})]}),e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-green-800",children:"Terminés"}),e.jsx(s,{variant:"h4",className:"font-bold text-green-800",children:((O=r==null?void 0:r.inventaires_par_statut)==null?void 0:O.termine)||0})]}),e.jsxs("div",{className:"bg-red-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-red-800",children:"Annulés"}),e.jsx(s,{variant:"h4",className:"font-bold text-red-800",children:((X=r==null?void 0:r.inventaires_par_statut)==null?void 0:X.annule)||0})]})]})})]})}),e.jsx(g,{item:!0,xs:12,md:6,children:e.jsxs(j,{children:[e.jsx(y,{title:"Ajustements d'inventaire"}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-blue-800",children:"En attente"}),e.jsx(s,{variant:"h4",className:"font-bold text-blue-800",children:((Z=r==null?void 0:r.ajustements_par_statut)==null?void 0:Z.en_attente)||0})]}),e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-green-800",children:"Validés"}),e.jsx(s,{variant:"h4",className:"font-bold text-green-800",children:((q=r==null?void 0:r.ajustements_par_statut)==null?void 0:q.valide)||0})]}),e.jsxs("div",{className:"bg-red-100 p-4 rounded-lg",children:[e.jsx(s,{variant:"subtitle2",className:"text-red-800",children:"Rejetés"}),e.jsx(s,{variant:"h4",className:"font-bold text-red-800",children:((S=r==null?void 0:r.ajustements_par_statut)==null?void 0:S.rejete)||0})]})]})})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{}),e.jsx(s,{variant:"body1",className:"mt-2",children:"Chargement des inventaires..."})]})]})}export{Ma as default};
