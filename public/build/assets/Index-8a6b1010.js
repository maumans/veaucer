import{j as e,r as a,y as c,W as Xe}from"./app-ef847769.js";import{d as O,P as Ze,L as $e,b as et}from"./PanelLayout-f3b1b528.js";/* empty css            */import{u as tt,M as st}from"./index.esm-f651ad8d.js";import{M as at}from"./index.esm-4bae7fd4.js";import{I as g}from"./InputError-101e4114.js";import{C as j}from"./Chip-7ba2869a.js";import{B as l}from"./Button-5cd339f2.js";import{V as he}from"./Visibility-4a9b5128.js";import{E as lt}from"./Edit-56c024d5.js";import{S as ge}from"./SwapHoriz-93fe5de9.js";import{D as rt}from"./Delete-578fe21d.js";import{c as je}from"./createSvgIcon-1d15f18d.js";import{C as ve}from"./Close-a9dab803.js";import{A as p}from"./Autocomplete-e3bbac74.js";import{T as i}from"./TextField-239b9d80.js";import{D as fe}from"./DatePicker-17c52b79.js";import{F as it}from"./FilterList-33b7e058.js";import{D as b,a as N,b as I}from"./DialogContent-21eccb4c.js";import{D as y}from"./DialogTitle-8810badb.js";import{A as ot}from"./Add-b95b626c.js";import{C as nt}from"./Check-a16d6a02.js";import{A as dt}from"./AddCircle-aaca1f2f.js";import{f as ct}from"./helpers.segment-8c19304b.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./index-63345e99.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./TableRow-e01d0199.js";import"./Popper-fafd03d0.js";import"./MenuItem-7e314da3.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./Switch-00012cca.js";const mt=je(e.jsx("path",{d:"M19 13H5v-2h14v2z"}),"Remove"),ut=je(e.jsx("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"}),"Tune");function pt(o,m){const d=a.useRef(!0);a.useEffect(()=>{if(d.current)d.current=!1;else return o()},m)}function ss({auth:o,errors:m,operations:d,departements:be,fournisseurs:Ne,typeOperations:ye,typeProduits:L,categorieProduits:A,error:Ce,success:Se}){var ee,te,se,ae,le;const[P,xt]=a.useState(!1),[Ee,ht]=a.useState(!1),[we,gt]=a.useState(!1),[ze,vt]=a.useState(0),[C,v]=a.useState([]),[S,ke]=a.useState(""),[E,Fe]=a.useState([]),[x,V]=a.useState({pageIndex:d.current_page-1,pageSize:d.per_page});pt(()=>{const t={};C.forEach(s=>{s.id==="date_range"&&typeof s.value=="object"?t.date_range=s.value:t[s.id]=s.value}),console.log("Filtres envoyés au backend:",t),c.get(route("admin.stock.mouvement.index",[o.user.id]),{start:x.pageIndex*x.pageSize,size:x.pageSize,filters:t,globalFilter:S??"",sorting:E??[]},{preserveScroll:!0,preserveState:!0})},[x.pageIndex,x.pageSize,S,C,E]);const{data:r,setData:h,post:Te,put:De,reset:_}=Xe({id:"",nom:"",typeProduit:null,categorieProduit:null}),[Me,R]=a.useState(!1),[Oe,W]=a.useState(!1),[Ie,Le]=a.useState(!1),[Ae,Pe]=a.useState(!1),f=t=>{c.get(route("admin.stock.mouvement.create",o.user.id),{mouvement:t},{onSuccess:()=>_()})},Y=()=>{R(!1)},q=()=>{W(!1)},Ve=()=>{Le(!1)},H=()=>{Pe(!1)},K=t=>{t.target.type==="checkbox"?h(t.target.name,t.target.checked):h(t.target.name,t.target.value)},_e=t=>{t.preventDefault(),Te(route("admin.stock.mouvement.store"),{...r,preserveScroll:!0})},Re=t=>{c.get(route("admin.stock.mouvement.edit",[o.user.id,t.id]),{preserveScroll:!0,onError:s=>{console.error("Erreur lors de la redirection vers la page d'édition:",s),alert("Erreur lors de la redirection vers la page d'édition. Veuillez réessayer.")}})},We=t=>{c.get(route("admin.stock.mouvement.show",[o.user.id,t]),{preserveState:!0,onSuccess:()=>{},onError:s=>{console.error("Erreur lors de l'affichage des détails:",s),alert("Erreur lors de l'affichage des détails: "+(s.error||"Veuillez réessayer."))}})},Ye=t=>{confirm("Êtes-vous sûr de vouloir supprimer ce mouvement ? Cette action est irréversible.")&&c.delete(route("admin.stock.mouvement.destroy",[o.user.id,t]),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{alert("Mouvement supprimé avec succès"),c.reload({only:["operations"]})},onError:s=>{console.error("Erreur lors de la suppression:",s),alert("Erreur lors de la suppression: "+(s.error||"Veuillez réessayer."))}})},qe=t=>{confirm("Êtes-vous sûr de vouloir annuler ce mouvement ? Cette action créera une opération inverse.")&&c.get(route("admin.stock.mouvement.cancel",[o.user.id,t]),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{alert("Mouvement annulé avec succès. Une opération inverse a été créée."),c.reload({only:["operations"]})},onError:s=>{console.error("Erreur lors de l'annulation:",s),alert("Erreur lors de l'annulation: "+(s.error||"Veuillez réessayer."))}})},He=()=>{De(route("admin.stock.mouvement.update",r.id),{onSuccess:()=>{_(),W(!1)}})},Ke=()=>{R(!1),c.delete(route("admin.stock.mouvement.destroy",{id:r.id}))},Be=a.useMemo(()=>[{accessorKey:"date",header:"Date",Cell:({row:t})=>O(t.original.date).format("DD/MM/YYYY")},{accessorKey:"type_operation",header:"Type",Cell:({row:t})=>{var s,n,re,ie,oe,ne,de,ce,me,ue,pe,xe;return((re=(n=(s=t.original)==null?void 0:s.type_operation)==null?void 0:n.nom)==null?void 0:re.toLowerCase())==="entrée"?e.jsx(j,{label:"Entrée",color:"success"}):((ne=(oe=(ie=t.original)==null?void 0:ie.type_operation)==null?void 0:oe.nom)==null?void 0:ne.toLowerCase())==="sortie"?e.jsx(j,{label:"Sortie",color:"error"}):((me=(ce=(de=t.original)==null?void 0:de.type_operation)==null?void 0:ce.nom)==null?void 0:me.toLowerCase())==="transfert"?e.jsx(j,{label:"Transfert",color:"warning"}):e.jsx(j,{label:(xe=(pe=(ue=t.original)==null?void 0:ue.type_operation)==null?void 0:pe.nom)==null?void 0:xe.toLowerCase(),color:"default"})}},{accessorKey:"departement_destination_id",header:"Departement destination",Cell:({row:t})=>{var s;return(s=t.original.departement_destination)==null?void 0:s.nom}},{accessorKey:"montant",header:"Total",Cell:({row:t})=>t.original.montant?ct(t.original.montant)+" GNF":""},{accessorKey:"fournisseur.nom",header:"Fournisseur",Cell:({row:t})=>{var s;return(s=t.original.fournisseur)==null?void 0:s.nom}},{accessorKey:"etat",header:"Etat",Cell:({row:t})=>t.original.etat==="COMMANDE"?e.jsx("div",{className:"p-2 font-bold bg-green-500 text-white w-fit h-fit rounded",children:t.original.etat}):t.original.etat==="ANNULE"?e.jsx("div",{className:"p-2 font-bold bg-red-500 text-white w-fit h-fit rounded",children:t.original.etat}):e.jsx("div",{className:"p-2 font-bold bg-blue-500 text-white w-fit h-fit rounded",children:t.original.etat})},{accessorKey:"action",header:"Action",Cell:({row:t})=>e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(l,{variant:"contained",color:"primary",size:"small",onClick:()=>We(t.original.id),title:"Voir les détails",children:e.jsx(he,{fontSize:"small"})}),t.original.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"contained",color:"success",size:"small",onClick:()=>Re(t.original),title:"Modifier",children:e.jsx(lt,{fontSize:"small"})}),e.jsx(l,{variant:"contained",color:"warning",size:"small",onClick:()=>qe(t.original.id),title:"Annuler le mouvement",children:e.jsx(ge,{fontSize:"small"})}),e.jsx(l,{variant:"contained",color:"error",size:"small",onClick:()=>Ye(t.original.id),title:"Supprimer",children:e.jsx(rt,{fontSize:"small"})})]}),!t.original.status&&e.jsx("span",{className:"px-2 py-1 bg-gray-200 text-gray-600 rounded text-xs",children:"Mouvement inactif"})]})}],[]),[B,U]=a.useState(!1),[u,w]=a.useState([null,null]),[z,G]=a.useState(null),[k,J]=a.useState(null),[F,Q]=a.useState(null),[T,X]=a.useState(""),[D,Z]=a.useState(""),[M,$]=a.useState(null),Ue=[{id:"VALIDE",nom:"Validé"},{id:"EN_ATTENTE",nom:"En attente"},{id:"ANNULE",nom:"Annulé"}],Ge=()=>{v([]);let t=[];z&&t.push({id:"type_operation",value:z.id}),k&&t.push({id:"departement",value:k.id}),F&&t.push({id:"fournisseur",value:F.id}),u[0]&&u[1]&&t.push({id:"date_range",value:{start:O(u[0]).format("YYYY-MM-DD"),end:O(u[1]).format("YYYY-MM-DD")}}),T&&t.push({id:"min_montant",value:T}),D&&t.push({id:"max_montant",value:D}),M&&t.push({id:"etat",value:M.id}),console.log("Nouveaux filtres appliqués:",t),setTimeout(()=>{v(t)},0)},Je=()=>{w([null,null]),G(null),J(null),Q(null),X(""),Z(""),$(null),console.log("Réinitialisation des filtres"),v([]),V(t=>({...t,pageIndex:0}))},Qe=tt({columns:Be,data:d.data,getRowId:t=>t.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualSorting:!0,muiToolbarAlertBannerProps:P?{color:"error",children:"Error loading data"}:void 0,onColumnFiltersChange:v,onGlobalFilterChange:ke,onPaginationChange:V,onSortingChange:Fe,rowCount:ze,state:{columnFilters:C,globalFilter:S,isLoading:Ee,pagination:x,showAlertBanner:P,showProgressBars:we,sorting:E},localization:at});return e.jsx(Ze,{auth:o,success:Se,error:Ce,errors:m,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",[o.user.id]),active:!1}],children:e.jsxs("div",{className:"grid gap-5 bg-gray-200 p-2 rounded border",children:[e.jsx("div",{className:"flex items-center flex-wrap gap-2 bg-black p-2 rounded w-fit",children:e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Liste des mouvements"})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(l,{color:"primary",onClick:()=>U(!B),variant:"outlined",startIcon:e.jsx(ut,{}),children:"Filtres avancés"})}),B&&e.jsxs("div",{className:"bg-white p-4 mb-4 rounded shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Filtres avancés"}),e.jsx(l,{variant:"outlined",color:"error",size:"small",onClick:()=>U(!1),children:e.jsx(ve,{fontSize:"small"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{children:e.jsx(p,{value:z,onChange:(t,s)=>G(s),options:ye||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{...t,label:"Type d'opération",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:k,onChange:(t,s)=>J(s),options:be||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{...t,label:"Département",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:F,onChange:(t,s)=>Q(s),options:Ne||[],getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{...t,label:"Fournisseur",fullWidth:!0,size:"small"})})}),e.jsx("div",{children:e.jsx(p,{value:M,onChange:(t,s)=>$(s),options:Ue,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{...t,label:"État",fullWidth:!0,size:"small"})})}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:e.jsx($e,{dateAdapter:et,adapterLocale:"fr",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(fe,{label:"Date de début",value:u[0],onChange:t=>w([t,u[1]]),slotProps:{textField:{size:"small",fullWidth:!0}}}),e.jsx(fe,{label:"Date de fin",value:u[1],onChange:t=>w([u[0],t]),slotProps:{textField:{size:"small",fullWidth:!0}}})]})})}),e.jsx("div",{children:e.jsx(i,{label:"Montant minimum",value:T,onChange:t=>X(t.target.value),type:"number",fullWidth:!0,size:"small"})}),e.jsx("div",{children:e.jsx(i,{label:"Montant maximum",value:D,onChange:t=>Z(t.target.value),type:"number",fullWidth:!0,size:"small"})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outlined",color:"error",onClick:Je,children:"Réinitialiser"}),e.jsx(l,{variant:"contained",color:"primary",onClick:Ge,startIcon:e.jsx(it,{}),children:"Appliquer les filtres"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(b,{open:Me,onClose:Y,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Ajout du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(i,{value:r.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:K}),e.jsx(g,{message:m.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{className:"w-full",onChange:(t,s)=>h("typeProduit",s),disablePortal:!0,options:L,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{fullWidth:!0,...t,placeholder:"Type de produit",label:t.nom})}),e.jsx(g,{message:m["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{className:"w-full",onChange:(t,s)=>h("categorieProduit",s),disablePortal:!0,options:A,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{fullWidth:!0,...t,placeholder:"Catégorie de produit",label:t.nom})}),e.jsx(g,{message:m["data.categorieProduit"]})]})]})}),e.jsxs(I,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:Y,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:_e,children:"Enregistrer"})]})]}),e.jsxs(b,{open:Oe,onClose:q,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Modification du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(i,{value:r.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:K}),e.jsx(g,{message:m.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{value:r.typeProduit,className:"w-full",onChange:(t,s)=>h("typeProduit",s),disablePortal:!0,options:L,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{fullWidth:!0,...t,placeholder:"Type de produit",label:t.nom})}),e.jsx(g,{message:m["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(p,{value:r.categorieProduit,className:"w-full",onChange:(t,s)=>h("categorieProduit",s),disablePortal:!0,options:A,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,s)=>t.id===s.id,renderInput:t=>e.jsx(i,{fullWidth:!0,...t,placeholder:"Catégorie de produit",label:t.nom})}),e.jsx(g,{message:m["data.categorieProduit"]})]})]})}),e.jsxs(I,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:q,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:He,children:"Enregistrer"})]})]}),e.jsxs(b,{open:Ie,onClose:Ve,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Details du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold",children:"Liste des mouvements de stock"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"outlined",color:"info",startIcon:e.jsx(he,{}),onClick:()=>c.get(route("admin.stock.mouvement.dashboard",o.user.id)),children:"Tableau de bord"}),e.jsx(l,{variant:"contained",color:"primary",startIcon:e.jsx(ot,{}),onClick:()=>f(),children:"Nouveau mouvement"})]})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:r.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ee=r.typeProduit)==null?void 0:ee.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(te=r.categorieProduit)==null?void 0:te.nom})]})]})})]}),e.jsxs(b,{open:Ae,onClose:H,children:[e.jsx(y,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(N,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[r.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",r.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(I,{children:[e.jsxs(l,{variant:"contained",color:"error",onClick:H,children:[e.jsx(ve,{}),"  Non"]}),e.jsxs(l,{variant:"contained",color:"success",onClick:Ke,children:[e.jsx(nt,{})," Oui"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-blue-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Total des mouvements"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:d.total||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Tous types confondus"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-green-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Entrées de stock"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((se=d.data)==null?void 0:se.filter(t=>{var s,n;return(n=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:n.toLowerCase().includes("entrée")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Approvisionnements et ajustements positifs"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-red-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Sorties de stock"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((ae=d.data)==null?void 0:ae.filter(t=>{var s,n;return(n=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:n.toLowerCase().includes("sortie")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Ventes et ajustements négatifs"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border-l-4 border-orange-500",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Ajustements d'inventaire"}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:((le=d.data)==null?void 0:le.filter(t=>{var s,n;return(n=(s=t.type_operation)==null?void 0:s.nom)==null?void 0:n.toLowerCase().includes("ajustement")}).length)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Suite aux inventaires physiques"})]})]}),e.jsxs("div",{className:"overflow-auto space-y-2 bg-white p-2 rounded",children:[e.jsxs("div",{className:"flex gap-5 flex-wrap justify-end",children:[e.jsxs(l,{size:"small",color:"success",variant:"contained",onClick:()=>f("Entrée"),children:[e.jsx(dt,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Entrée"})]}),e.jsxs(l,{size:"small",color:"warning",variant:"contained",onClick:()=>f("Transfert"),children:[e.jsx(ge,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Transfert"})]}),e.jsxs(l,{size:"small",color:"error",variant:"contained",onClick:()=>f("Sortie"),children:[e.jsx(mt,{className:"mr-1"})," ",e.jsx("span",{className:"hidden sm:flex",children:"Sortie"})]})]}),e.jsx(st,{table:Qe})]})]})})}export{ss as default};
