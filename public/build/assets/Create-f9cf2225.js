import{W as qe,r,j as s,y as J}from"./app-ef847769.js";import{I as c}from"./InputError-101e4114.js";import D from"./NumberFormatCustomUtils-99ba5477.js";import{d as _e,P as Te}from"./PanelLayout-f3b1b528.js";import{u as X,M as Z}from"./index.esm-f651ad8d.js";import{M as ee}from"./index-223c7b24.js";import{T as d,a as Ee}from"./TextField-239b9d80.js";import{B as j}from"./Button-5cd339f2.js";import{C as te}from"./Close-a9dab803.js";import{A as $e}from"./ArrowBack-609c6f32.js";import{m as Pe}from"./motion-af0b5e75.js";import{D as Me}from"./DatePicker-17c52b79.js";import{A as p}from"./Autocomplete-e3bbac74.js";import{f as h}from"./helpers.segment-8c19304b.js";import"./createSvgIcon-1d15f18d.js";import"./index-63345e99.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./TableRow-e01d0199.js";import"./Popper-fafd03d0.js";import"./MenuItem-7e314da3.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Chip-7ba2869a.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./DialogContent-21eccb4c.js";import"./DialogTitle-8810badb.js";import"./Switch-00012cca.js";function Ot({auth:u,produits:v,departements:S,departementPrincipal:y,caisses:ie,caissePrincipale:se,motifsEntrees:ke,motifsSorties:ne,motifsTransferts:oe,motifsDepenses:b,motifEntreeDefaut:ae,motifSortieDefaut:re,motifTransfertDefaut:le,fournisseurs:de,fournisseurPrincipal:me,devises:Ie,uniteMesures:ze,errors:m,success:q,error:_,referentiels:we,typeOperations:ce,typeOperation:pe,mouvement:Fe}){var M,k,I,z,w,F,W,K,L,R,V,G;const{data:i,setData:o,processing:We}=qe({date:_e(),nom:"",prixAchat:"",prixVente:"",quantiteAchat:"",produit:null,motif:null,fournisseur:me,departementSource:null,departementDestination:null,caisse:se,uniteMesure:null,devise:null,operations:[],depenses:[],montantDepense:"",totalOperation:null,totalDepense:null,enregistrer:!1,typeOperation:pe,produits:[],motifsDepenses:[],motifEntree:ae,motifSortie:re,motifTransfert:le});r.useEffect(()=>{var e,t,n;((e=i.typeOperation)==null?void 0:e.nom)==="entrée"&&o("departementDestination",y),((t=i.typeOperation)==null?void 0:t.nom)==="sortie"&&o("departementSource",y),((n=i.typeOperation)==null?void 0:n.nom)==="transfert"&&o(l=>({...l,departementSource:y,departementDestination:null}))},[i.typeOperation]);const[T,Ke]=r.useState(!1),[ue,O]=r.useState(!1),[fe,he]=r.useState(!1),x=e=>{e.target.type==="checkbox"?o(t=>({...t,[e.target.name]:e.target.checked})):o(t=>({...t,[e.target.name]:e.target.value}))},N=e=>{e.target.type==="checkbox"?o(t=>({...t,[e.target.name]:e.target.checked})):o(t=>({...t,[e.target.name]:e.target.value}))};r.useEffect(()=>{let e=0,t=[];i.operations.forEach(n=>{var l,a,f;((l=i.typeOperation)==null?void 0:l.nom)==="entrée"?(i[`quantiteAchat.${n.id}`]&&i[`prixAchat.${n.id}`]&&(e+=i[`quantiteAchat.${n.id}`]*i[`prixAchat.${n.id}`],t.push({id:n.id,prixAchat:parseInt(i[`prixAchat.${n.id}`]),quantiteAchat:parseInt(i[`quantiteAchat.${n.id}`]),produit_id:n.produit_id,produit_nom:n.produit_nom,type_produit_id:parseInt(i[`type_produit_id.${n.id}`]||1)})),i[`prixAchat.${n.id}`]||o(g=>({...g,[`prixAchat.${n.id}`]:n.prixAchat}))):(((a=i.typeOperation)==null?void 0:a.nom)==="sortie"||((f=i.typeOperation)==null?void 0:f.nom)==="transfert")&&i[`quantiteAchat.${n.id}`]&&t.push({id:n.id,quantiteAchat:parseInt(i[`quantiteAchat.${n.id}`]),produit_id:n.produit_id,produit_nom:n.produit_nom})}),o(n=>({...n,totalOperation:e,operationData:t}))},[i.operations,i]),r.useEffect(()=>{let e=[],t=0;i.depenses.forEach(n=>{i[`montantDepense.${n.id}`]&&(t+=parseInt(i[`montantDepense.${n.id}`]),e.push({id:n.id,montant:parseInt(i[`montantDepense.${n.id}`]),motif:n.motif,motif_id:n.motif_id,commentaire:i[`commentaire.${n.id}`]}))}),o(n=>({...n,totalDepense:t,depenseData:e}))},[i.depenses,i]);const[xe,E]=r.useState({prixAchat:((M=i.typeOperation)==null?void 0:M.nom)==="entrée",montant:((k=i.typeOperation)==null?void 0:k.nom)==="entrée",typeProduit:((I=i.typeOperation)==null?void 0:I.nom)==="entrée"});r.useEffect(()=>{var e,t,n;E({prixAchat:((e=i.typeOperation)==null?void 0:e.nom)==="entrée",montant:((t=i.typeOperation)==null?void 0:t.nom)==="entrée",typeProduit:((n=i.typeOperation)==null?void 0:n.nom)==="entrée"})},[i.typeOperation]),r.useEffect(()=>{o(e=>({...e,total:(i.totalOperation||0)+(i.totalDepense||0)}))},[i.totalOperation,i.totalDepense]);const ge=r.useMemo(()=>[{accessorKey:"N°",header:"N°",Cell:({row:e})=>e.index+1},{accessorKey:"nom",header:"Nom",Cell:({row:e})=>{var t;return(t=e.original.produit)==null?void 0:t.nom}},{accessorKey:"typeProduit",header:"Type de produit",Cell:({row:e})=>s.jsxs("select",{name:`type_produit_id.${e.original.id}`,value:i[`type_produit_id.${e.original.id}`]||1,onChange:x,className:"w-full p-2 border rounded",children:[s.jsx("option",{value:1,children:"Unité"}),s.jsx("option",{value:2,children:"Ensemble"})]})},{accessorKey:"prixAchat",header:"Prix d'achat (GNF)",Cell:({row:e})=>s.jsx(d,{name:`prixAchat.${e.original.id}`,value:i[`prixAchat.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:0}},className:"w-full",onChange:x,size:"small"})},{accessorKey:"quantiteAchat",header:"Quantité",Cell:({row:e})=>s.jsx(d,{name:`quantiteAchat.${e.original.id}`,value:i[`quantiteAchat.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:0}},className:"w-full",onChange:x,size:"small"})},{accessorKey:"montant",header:"Montant (GNF)",Cell:({row:e})=>{const t=parseFloat(i[`prixAchat.${e.original.id}`]||0),n=parseFloat(i[`quantiteAchat.${e.original.id}`]||0),l=t*n;return l>0?`${h(l)} GNF`:""}},{accessorKey:"action",header:"Action",Cell:({row:e})=>s.jsx(j,{onClick:()=>$(e.original.id),variant:"contained",size:"small",color:"error",children:s.jsx(te,{})},e.original.id)}],[i,x,$]),je=r.useMemo(()=>[{accessorKey:"motif",header:"Motif",Cell:({row:e})=>{var t;return(t=e.original.motif)==null?void 0:t.nom}},{accessorKey:"montant",header:"Montant (GNF)",Cell:({row:e})=>s.jsx(d,{name:`montantDepense.${e.original.id}`,value:i[`montantDepense.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:0}},className:"w-full",onChange:N,size:"small"})},{accessorKey:"commentaire",header:"Commentaire",Cell:({row:e})=>{var t,n;return s.jsx(Ee,{name:`commentaire.${e.original.id}`,value:i[`commentaire.${e.original.id}`]||"",className:"w-full",onChange:N,size:"small",multiline:!0,minRows:1,required:((n=(t=e==null?void 0:e.original)==null?void 0:t.motif)==null?void 0:n.nom)==="autres"})}},{accessorKey:"action",header:"Action",Cell:({row:e})=>s.jsx(j,{onClick:()=>P(e.original.id),variant:"contained",size:"small",color:"error",type:"button",children:s.jsx(te,{})},e.original.id)}],[i,N,P]);r.useEffect(()=>{O(q)},[q]),r.useEffect(()=>{he(_)},[_]);function ve(e){var t,n,l,a,f,g,B,U,Y,H,Q;e.preventDefault(),J.post(route("admin.stock.mouvement.store",u.user.id),{date:i.date,typeOperation:(t=i.typeOperation)==null?void 0:t.id,typeOperation_nom:(n=i.typeOperation)==null?void 0:n.nom,fournisseur:((l=i.typeOperation)==null?void 0:l.nom)==="entrée"?(a=i.fournisseur)==null?void 0:a.id:null,departementSource:(f=i.departementSource)==null?void 0:f.id,departementDestination:(g=i.departementDestination)==null?void 0:g.id,motifSortie:((B=i.typeOperation)==null?void 0:B.nom)==="sortie"?(U=i.motifSortie)==null?void 0:U.id:null,motifTransfert:((Y=i.typeOperation)==null?void 0:Y.nom)==="transfert"?(H=i.motifTransfert)==null?void 0:H.id:null,caisse:(Q=i.caisse)==null?void 0:Q.id,operations:i.operationData,depenses:i.depenseData,totalOperation:i.totalOperation,totalDepense:i.totalDepense},{preserveScroll:!0})}r.useEffect(()=>{var t,n,l;let e=[];((t=i.typeOperation)==null?void 0:t.nom)==="entrée"?i.produits.map(a=>{e.push({id:a.id,produit:a,produit_id:a==null?void 0:a.id,produit_nom:a==null?void 0:a.nom,type_produit_id:1,prixAchat:a.prixAchat,quantiteAchat:"",montant:""})}):(((n=i.typeOperation)==null?void 0:n.nom)==="sortie"||((l=i.typeOperation)==null?void 0:l.nom)==="transfert")&&i.produits.map(a=>{e.push({id:a.id,produit:a,produit_id:a==null?void 0:a.id,produit_nom:a==null?void 0:a.nom,type_produit_id:1,quantiteAchat:""})}),o(a=>({...a,operations:e}))},[i.produits]);function $(e){o(t=>({...t,produits:t.produits.filter(n=>n.id!==e)})),o(t=>({...t,["prixAchat."+e]:"",["quantiteAchat."+e]:""})),O("Produit retiré avec succès")}r.useEffect(()=>{let e=[];i.motifsDepenses.map(t=>{e.push({id:t.id,motif:t,motif_id:t==null?void 0:t.id,montant:"",commentaire:""})}),o(t=>({...t,depenses:e}))},[i.motifsDepenses]);function P(e){o(t=>({...t,motifsDepenses:t.motifsDepenses.filter(n=>n.id!==e)})),o(t=>({...t,["montantDepense."+e]:""})),O("Dépense retirée avec succès")}const ye=X({columns:ge,data:i.operations,state:{columnVisibility:xe,showProgressBars:T},onColumnVisibilityChange:E,localization:ee}),be=X({columns:je,data:i.depenses,state:{showProgressBars:T},localization:ee}),[Oe,A]=r.useState(!1),Ne=[{id:"select-all",nom:"Tous les produits"},...v],Ae=(e,t)=>{t.some(n=>n.id==="select-all")?Oe?(o("produits",[]),A(!1)):(o("produits",v),A(!0)):(o("produits",t),A(t.length===v.length))},[Ce,C]=r.useState(!1),De=[{id:"select-all",nom:"Tous les motifs"},...b],Se=(e,t)=>{t.some(n=>n.id==="select-all")?Ce?(o("motifsDepenses",[]),C(!1)):(o("motifsDepenses",b),C(!0)):(o("motifsDepenses",t),C(t.length===b.length))};return s.jsx(Te,{auth:u,success:ue,error:fe,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",u.user.id),active:!1},{text:"Nouveau",href:route("admin.stock.mouvement.create",u.user.id),active:!0}],children:s.jsx("div",{children:s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"p-4 bg-white rounded mb-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:s.jsx("h2",{children:"Nouveau mouvement"})}),s.jsx(j,{variant:"outlined",startIcon:s.jsx($e,{}),onClick:()=>J.get(route("admin.stock.mouvement.index",u.user.id)),children:"Retour"})]})}),s.jsx(Pe.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,type:"spring"},style:{width:"100%"},children:s.jsxs("form",{onSubmit:ve,className:"w-full space-y-5 gap-5 rounded bg-white p-5",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Date de l'operation"}),s.jsx(Me,{className:"w-full",openTo:"day",views:["year","month","day"],format:"DD/MM/YYYY",value:i.date,onChange:e=>{o("date",e)},slotProps:{textField:{size:"small"}}})]}),s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Mouvement"}),s.jsx(p,{value:i.typeOperation,className:"w-full",onChange:(e,t)=>o("typeOperation",t),disablePortal:!0,options:ce,getOptionLabel:e=>e.libelle,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"mouvement",label:e.libelle,required:!0}),size:"small"}),s.jsx(c,{message:m.typeOperation})]}),((z=i.typeOperation)==null?void 0:z.nom)==="sortie"&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Motif de sortie"}),s.jsx(p,{value:i.motifSortie,className:"w-full",onChange:(e,t)=>o("motifSortie",t),disablePortal:!0,options:ne,getOptionLabel:e=>{var t,n;return((t=e.nom)==null?void 0:t.charAt(0).toUpperCase())+((n=e.nom)==null?void 0:n.slice(1))},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"motif",label:e.libelle,required:!0}),size:"small"}),s.jsx(c,{message:m.motifSortie})]}),((w=i.typeOperation)==null?void 0:w.nom)==="transfert"&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Motif de transfert"}),s.jsx(p,{value:i.motifTransfert,className:"w-full",onChange:(e,t)=>o("motifTransfert",t),disablePortal:!0,options:oe,getOptionLabel:e=>{var t,n;return((t=e.nom)==null?void 0:t.charAt(0).toUpperCase())+((n=e.nom)==null?void 0:n.slice(1))},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"motif de transfert",label:e.libelle,required:!0}),size:"small"}),s.jsx(c,{message:m.motifTransfert})]}),s.jsxs("div",{className:"md:col-span-2 grid md:grid-cols-2 gap-2",children:[(((F=i.typeOperation)==null?void 0:F.nom)==="sortie"||((W=i.typeOperation)==null?void 0:W.nom)==="transfert")&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Stock source"}),s.jsx(p,{value:i.departementSource,className:"w-full",onChange:(e,t)=>o("departementSource",t),disablePortal:!0,options:S.filter(e=>{var t;return e.id!==((t=i.departementDestination)==null?void 0:t.id)}),getOptionLabel:e=>"Stock "+e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Stock",label:e.nom,required:!0}),size:"small"}),s.jsx(c,{message:m.departementSource})]}),(((K=i.typeOperation)==null?void 0:K.nom)==="entrée"||((L=i.typeOperation)==null?void 0:L.nom)==="transfert")&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Stock de destination"}),s.jsx(p,{value:i.departementDestination,className:"w-full",onChange:(e,t)=>o("departementDestination",t),disablePortal:!0,options:S.filter(e=>{var t;return e.id!==((t=i.departementSource)==null?void 0:t.id)}),getOptionLabel:e=>"Stock "+e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Stock",label:e.nom,required:!0}),size:"small"}),s.jsx(c,{message:m.departementDestination})]})]}),((R=i.typeOperation)==null?void 0:R.nom)==="entrée"&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Caisse de paiement"}),s.jsx(p,{value:i.caisse,className:"w-full",onChange:(e,t)=>o("caisse",t),disablePortal:!0,options:ie,getOptionLabel:e=>{var t;return"Caisse dep. "+((t=e==null?void 0:e.departement)==null?void 0:t.nom)},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Caisse",label:e.nom,required:!0}),size:"small"}),s.jsx(c,{message:m.caisse}),i.caisse&&s.jsxs("div",{className:"text-orange-500 font-bold mt-1",children:["Solde: ",h(i.caisse.solde)+" GNF"]})]}),((V=i.typeOperation)==null?void 0:V.nom)==="entrée"&&s.jsxs("div",{children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Fournisseur"}),s.jsx(p,{value:i.fournisseur,className:"w-full",onChange:(e,t)=>o("fournisseur",t),disablePortal:!0,options:de,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Fournisseur",label:e.nom}),size:"small"}),s.jsx(c,{message:m.fournisseur})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Ajout des produits"}),s.jsxs("div",{children:[s.jsx(p,{value:i.produits,className:"w-full",onChange:Ae,disablePortal:!0,options:Ne,multiple:!0,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Produits",label:e.nom}),disableCloseOnSelect:!0,size:"small"}),s.jsx(c,{message:m.produits})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(Z,{table:ye})}),i.totalOperation?s.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total des produits : "+h(i.totalOperation)+" GNF"}):""]}),((G=i.typeOperation)==null?void 0:G.nom)==="entrée"&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[s.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Dépense supplémentaires"}),s.jsxs("div",{children:[s.jsx(p,{value:i.motifsDepenses,className:"w-full",onChange:Se,disablePortal:!0,options:De,multiple:!0,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>s.jsx(d,{fullWidth:!0,...e,placeholder:"Motifs",label:e.nom}),disableCloseOnSelect:!0,size:"small"}),s.jsx(c,{message:m.motifsDepenses})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx(Z,{table:be})}),i.totalDepense?s.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total des dépenses: "+h(i.totalDepense)+" GNF"}):""]}),i.total?s.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total: "+h(i.total)+" GNF"}):"",s.jsx("div",{className:"w-full md:col-span-2 flex justify-end gap-4 mt-10 py-2 px-1 bg-gray-100 rounded",children:s.jsx(j,{variant:"contained",color:"success",type:"submit",children:"Enregistrer"})})]})})]})})})}export{Ot as default};
