import{j as e,r as d,W as Oe,y as c}from"./app-eb4ac14d.js";import{P as qe,T as n,a as _,B as q}from"./PanelLayout-9db7ade9.js";/* empty css            */import{u as Ve,M as We}from"./index.esm-c4a53501.js";import{M as Ke}from"./index.esm-4bae7fd4.js";import{I as y}from"./InputError-72dd93fb.js";import{B as t}from"./Button-7f8b9a63.js";import{V as Re}from"./Visibility-c9cb56b1.js";import{E as Ge}from"./Edit-9517b33c.js";import{D as Le}from"./Delete-98ed2789.js";import{C as ce}from"./Check-b85e105e.js";import{A as $e}from"./ArrowBack-7bd27efd.js";import{c as W}from"./createSvgIcon-4d9a41bc.js";import{A as Be}from"./AddCircle-9c227046.js";import{D as w,a as I,b as V}from"./DialogContent-a8b90f31.js";import{D as F}from"./DialogTitle-7e680bb7.js";import{T as b,F as z,I as D,S as P}from"./TextField-22f70a44.js";import{A as T}from"./Autocomplete-7942bf2c.js";import{C as ue}from"./Close-7d5020eb.js";import{W as me}from"./Warning-108961c0.js";import{T as Ue}from"./TrendingUp-662ed667.js";import{G as C}from"./Grid-7450d8ec.js";import{M as m}from"./MenuItem-3d0941cb.js";import{C as E}from"./Chip-bb44338a.js";import{f as A}from"./helpers.segment-8c19304b.js";import"./Dropdown-8c28aa27.js";import"./transition-a13fe195.js";import"./index-cf4ee6ec.js";import"./Cancel-8205af54.js";import"./Edit-17e2fc58.js";import"./TableRow-9f6508f6.js";import"./Popper-1f680820.js";import"./DatePicker-25bc8498.js";import"./LastPage-4e97b798.js";import"./SwitchBase-3ba62cb7.js";import"./Checkbox-ae5cc143.js";import"./Stack-ebf23453.js";import"./CircularProgress-c9ab41e4.js";import"./Switch-31212aee.js";const pe=W(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),He=W(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"}),"FileDownload"),Qe=W(e.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"FileUpload");function Ai({auth:a,errors:v,produits:k,typeProduits:S,categories:N,departements:f,error:xe,success:he,filters:l,stats:r}){var ee,ie,re,oe,le,te,ne,ae,se;const[K,ge]=d.useState({pageIndex:k.current_page-1,pageSize:k.per_page}),[p,R]=d.useState((l==null?void 0:l.categorie_id)||""),[x,G]=d.useState((l==null?void 0:l.type_produit_id)||""),[u,L]=d.useState((l==null?void 0:l.stock_filter)||"all"),[h,$]=d.useState((l==null?void 0:l.departement_id)||""),je=i=>{ge(i),c.get(route("admin.stock.produit.index",{userId:a.user.id}),{page:i.pageIndex+1,per_page:i.pageSize},{preserveState:!0,preserveScroll:!0,only:["produits"]})},ve=i=>{c.get(route("admin.stock.produit.index",{userId:a.user.id}),{search:i,page:1,categorie_id:p,type_produit_id:x,stock_filter:u,departement_id:h},{preserveState:!0,preserveScroll:!0,only:["produits"]})},g=(i,o)=>{switch(i){case"categorie":R(o);break;case"typeProduit":G(o);break;case"stock":L(o);break;case"departement":$(o);break}c.get(route("admin.stock.produit.index",{userId:a.user.id}),{search:(l==null?void 0:l.search)||"",page:1,categorie_id:i==="categorie"?o:p,type_produit_id:i==="typeProduit"?o:x,stock_filter:i==="stock"?o:u,departement_id:i==="departement"?o:h},{preserveState:!0,preserveScroll:!0,only:["produits","stats"]})},fe=i=>{i.length>0&&c.get(route("admin.stock.produit.index",{userId:a.user.id}),{sort_field:i[0].id,sort_direction:i[0].desc?"desc":"asc",page:K.pageIndex+1,categorie_id:p,type_produit_id:x,stock_filter:u,departement_id:h},{preserveState:!0,preserveScroll:!0,only:["produits"]})},ye=i=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"GNF",minimumFractionDigits:0}).format(i),{data:s,setData:j,post:be,put:Ce,reset:M}=Oe({id:"",nom:"",typeProduit:null,categorie:null}),[ke,O]=d.useState(!1),[Se,B]=d.useState(!1),[Ne,U]=d.useState(!1),[_e,H]=d.useState(!1),we=()=>{c.get(route("admin.stock.produit.create",{userId:a.user.id}),{onSuccess:()=>M()})},Ie=i=>{const o=i.target.files[0];if(o){const de=new FormData;de.append("file",o),c.post(route("admin.stock.produit.import-csv",{userId:a.user.id}),de,{onSuccess:()=>{i.target.value=null}})}},Q=()=>{O(!1)},Y=()=>{B(!1)},Fe=()=>{U(!1)},J=()=>{H(!1)},X=i=>{i.target.type==="checkbox"?j(i.target.name,i.target.checked):j(i.target.name,i.target.value)},ze=()=>{be(route("admin.produit.store"),{onSuccess:()=>{M(),O(!1)}})},De=i=>{c.get(route("admin.produit.edit",[a.user.id,i.id]),{preserveScroll:!0})},Pe=i=>{j({id:i.id,nom:i.nom||"",typeProduit:i.type_souscripteur||null,categorie:i.categorie_souscripteur||null}),U(!0)},Z=(i,o)=>{j({id:i,message:o}),H(!0)},Te=()=>{Ce(route("admin.produit.update",s.id),{onSuccess:()=>{M(),B(!1)}})},Ee=()=>{O(!1),c.delete(route("admin.produit.destroy",{id:s.id}))},Ae=d.useMemo(()=>[{accessorKey:"nom",header:"Nom"},{accessorKey:"typeProduitAchat",header:"Option d'achat",Cell:({row:i})=>{var o;return(o=i.original.type_produit_achat)==null?void 0:o.libelle}},{accessorKey:"prixAchat",header:"Prix d'achat (GNF)",Cell:({row:i})=>A(i.original.prixAchat??0)},{accessorKey:"quantiteAchat",header:"Quantité à l'achat",Cell:({row:i})=>A(i.original.quantiteAchat??0)},{accessorKey:"typeProduitVente",header:"Option de vente",Cell:({row:i})=>{var o;return(o=i.original.type_produit_vente)==null?void 0:o.libelle}},{accessorKey:"prixVente",header:"Prix d'achat (GNF)",Cell:({row:i})=>A(i.original.prixVente??0)},{accessorKey:"quantiteVente",header:"Quantité à la vente",Cell:({row:i})=>A(i.original.quantiteVente??0)},{accessorKey:"categorie",header:"Categorie",Cell:({row:i})=>{var o;return(o=i.original.categorie)==null?void 0:o.libelle}},{accessorKey:"status",header:"Status",Cell:({row:i})=>i.original.status?e.jsx("div",{className:"p-2 font-bold bg-green-500 text-white w-fit h-fit rounded",children:"Actif"}):e.jsx("div",{className:"p-2 font-bold bg-red-500 text-white w-fit h-fit rounded",children:"Inactif"})},{accessorKey:"action",header:"Action",Cell:({row:i})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:()=>Pe(i.original),variant:"contained",size:"small",color:"info",children:e.jsx(Re,{})}),e.jsx(t,{onClick:()=>De(i.original),variant:"contained",size:"small",color:"secondary",children:e.jsx(Ge,{})}),i.original.status?e.jsx(t,{onClick:()=>Z(i.original.id,"delete"),variant:"contained",size:"small",color:"error",children:e.jsx(Le,{})}):e.jsx(t,{onClick:()=>Z(i.original.id,"check"),variant:"contained",size:"small",color:"success",children:e.jsx(ce,{})})]},i.original.id)}],[]),Me=Ve({columns:Ae,data:k.data,getRowId:i=>i.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,onGlobalFilterChange:ve,onPaginationChange:je,onSortingChange:fe,rowCount:k.total,state:{pagination:K},localization:Ke});return e.jsx(qe,{auth:a,success:he,error:xe,errors:v,active:"stock",sousActive:"produit",breadcrumbs:[{text:"Stock",href:route("admin.dashboard",{id:a.user.id}),active:!1},{text:"Produits",href:route("admin.stock.produit.index",{userId:a.user.id}),active:!0}],children:e.jsxs("div",{className:"p-4 bg-white rounded shadow",children:[e.jsxs("div",{className:"flex justify-between flex-wrap gap-2 items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t,{variant:"outlined",startIcon:e.jsx($e,{}),onClick:()=>c.get(route("admin.dashboard",{id:a.user.id})),children:e.jsx("span",{hidden:!0,"md:block":!0,children:"Retour au tableau de bord"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Liste des produits"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(t,{color:"success",variant:"outlined",onClick:()=>window.location.href=route("admin.stock.produit.export-csv",{userId:a.user.id}),children:[e.jsx(He,{className:"mr-1"})," Exporter CSV"]}),e.jsxs("label",{htmlFor:"upload-csv",children:[e.jsx("input",{style:{display:"none"},id:"upload-csv",name:"upload-csv",type:"file",accept:".csv",onChange:Ie,size:"small"}),e.jsxs(t,{color:"info",variant:"outlined",component:"span",size:"small",children:[e.jsx(Qe,{className:"mr-1"})," Importer CSV"]})]}),e.jsxs(t,{size:"small",color:"warning",variant:"contained",onClick:we,children:[e.jsx(Be,{className:"mr-1"})," Ajout produit"]})]}),e.jsxs(w,{open:ke,onClose:Q,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Ajout du produit"}),e.jsx(I,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(b,{value:s.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(y,{message:v.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{className:"w-full",onChange:(i,o)=>j("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(b,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(y,{message:v["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{className:"w-full",onChange:(i,o)=>j("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(b,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(y,{message:v["data.categorie"]})]})]})}),e.jsxs(V,{children:[e.jsx(t,{variant:"contained",color:"error",onClick:Q,children:"Annuler"}),e.jsx(t,{variant:"contained",color:"success",onClick:ze,children:"Enregistrer"})]})]}),e.jsxs(w,{open:Se,onClose:Y,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Modification du produit"}),e.jsx(I,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(b,{value:s.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(y,{message:v.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{value:s.typeProduit,className:"w-full",onChange:(i,o)=>j("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(b,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(y,{message:v["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{value:s.categorie,className:"w-full",onChange:(i,o)=>j("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(b,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(y,{message:v["data.categorie"]})]})]})}),e.jsxs(V,{children:[e.jsx(t,{variant:"contained",color:"error",onClick:Y,children:"Annuler"}),e.jsx(t,{variant:"contained",color:"success",onClick:Te,children:"Enregistrer"})]})]}),e.jsxs(w,{open:Ne,onClose:Fe,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Details du produit"}),e.jsx(I,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:s.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ee=s.typeProduit)==null?void 0:ee.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(ie=s.categorie)==null?void 0:ie.nom})]})]})})]}),e.jsxs(w,{open:_e,onClose:J,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(I,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[s.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",s.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(V,{children:[e.jsxs(t,{variant:"contained",color:"error",onClick:J,children:[e.jsx(ue,{}),"  Non"]}),e.jsxs(t,{variant:"contained",color:"success",onClick:Ee,children:[e.jsx(ce,{})," Oui"]})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{children:e.jsxs(n,{variant:"h6",sx:{mb:1,fontWeight:"bold"},children:[r!=null&&r.departement?`Statistiques pour le département: ${r.departement.nom_departement}`:"Statistiques globales",(h||p||x||u!=="all")&&e.jsx(n,{variant:"caption",sx:{ml:1,fontWeight:"normal",display:"inline-block"},children:"(filtrées selon les critères sélectionnés)"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(n,{variant:"h6",color:"primary",children:"Total Produits"}),e.jsx(n,{variant:"h4",children:r!=null&&r.departement?r.departement.total_produits:(r==null?void 0:r.total_produits)||0})]})}),e.jsx("div",{children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#fff9c4"},children:[e.jsxs(n,{variant:"h6",color:"warning.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{fontSize:"small",sx:{mr:1}})," Stock Critique"]}),e.jsx(n,{variant:"h4",color:"warning.main",children:r!=null&&r.departement?r.departement.stockCritique:(r==null?void 0:r.stockCritique)||0}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((re=r.departement)==null?void 0:re.stockCritique)||0)/(((oe=r.departement)==null?void 0:oe.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stockCritique)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx("div",{children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#ffebee"},children:[e.jsxs(n,{variant:"h6",color:"error",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",sx:{mr:1}})," Stock Épuisé"]}),e.jsx(n,{variant:"h4",color:"error",children:r!=null&&r.departement?r.departement.stock_epuise:(r==null?void 0:r.stock_epuise)||0}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((le=r.departement)==null?void 0:le.stock_epuise)||0)/(((te=r.departement)==null?void 0:te.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stock_epuise)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx("div",{children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#e8f5e9"},children:[e.jsxs(n,{variant:"h6",color:"success.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ue,{fontSize:"small",sx:{mr:1}})," Valeur Stock"]}),e.jsx(n,{variant:"h4",color:"success.main",children:ye(r!=null&&r.departement?r.departement.valeur_totale_stock:(r==null?void 0:r.valeur_totale_stock)||0)})]})})]}),e.jsxs(C,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(C,{item:!0,xs:12,children:e.jsx(n,{variant:"subtitle1",sx:{mb:1,fontWeight:"bold"},children:"Filtres"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Département"}),e.jsxs(P,{value:h,onChange:i=>g("departement",i.target.value),label:"Département",children:[e.jsx(m,{value:"",children:"Tous les départements"}),f==null?void 0:f.map(i=>e.jsx(m,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Catégorie"}),e.jsxs(P,{value:p,onChange:i=>g("categorie",i.target.value),label:"Catégorie",children:[e.jsx(m,{value:"",children:"Toutes les catégories"}),N.map(i=>e.jsx(m,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Type de produit"}),e.jsxs(P,{value:x,onChange:i=>g("typeProduit",i.target.value),label:"Type de produit",children:[e.jsx(m,{value:"",children:"Tous les types"}),S.map(i=>e.jsx(m,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"État du stock"}),e.jsxs(P,{value:u,onChange:i=>g("stock",i.target.value),label:"État du stock",children:[e.jsx(m,{value:"all",children:"Tous les produits"}),e.jsx(m,{value:"low",children:e.jsxs(q,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{fontSize:"small",color:"warning",sx:{mr:1}}),"Stock critique"]})}),e.jsx(m,{value:"out",children:e.jsxs(q,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",color:"error",sx:{mr:1}}),"Stock épuisé"]})})]})]})})]}),(h||p||x||u!=="all")&&e.jsxs(q,{sx:{mb:2,display:"flex",flexWrap:"wrap",gap:1},children:[e.jsx(n,{variant:"body2",sx:{mr:1,display:"flex",alignItems:"center"},children:"Filtres actifs:"}),h&&e.jsx(E,{label:`Département: ${((ne=f==null?void 0:f.find(i=>i.id===parseInt(h)))==null?void 0:ne.nom)||""}`,onDelete:()=>g("departement",""),color:"primary",variant:"outlined",size:"small"}),p&&e.jsx(E,{label:`Catégorie: ${((ae=N.find(i=>i.id===parseInt(p)))==null?void 0:ae.nom)||""}`,onDelete:()=>g("categorie",""),color:"primary",variant:"outlined",size:"small"}),x&&e.jsx(E,{label:`Type: ${((se=S.find(i=>i.id===parseInt(x)))==null?void 0:se.nom)||""}`,onDelete:()=>g("typeProduit",""),color:"primary",variant:"outlined",size:"small"}),u!=="all"&&e.jsx(E,{label:u==="low"?"Stock critique":"Stock épuisé",onDelete:()=>g("stock","all"),color:u==="low"?"warning":"error",variant:"outlined",size:"small"}),e.jsx(t,{variant:"text",size:"small",startIcon:e.jsx(ue,{fontSize:"small"}),onClick:()=>{$(""),R(""),G(""),L("all"),c.get(route("admin.stock.produit.index",{userId:a.user.id}),{page:1})},children:"Réinitialiser tous les filtres"})]})]}),e.jsx(We,{table:Me})]})})}export{Ai as default};
