import{j as e,r as i,i as qe,W as Ge,y as k}from"./app-80aef6d5.js";import{T as a,B as De,I as j,P as Ve,a as oe}from"./PanelLayout-a81f80b5.js";import{u as He,M as Le}from"./index.esm-6c7ac6f1.js";import{M as Be}from"./index.esm-4bae7fd4.js";import{I as U}from"./InputError-be802d9f.js";import{C as le}from"./Chip-4667134d.js";import{T as z}from"./TableRow-8bf34bd7.js";import{V as Oe}from"./Visibility-c61c2b57.js";import{c as V}from"./createSvgIcon-f9f11e70.js";import{C as ce}from"./CompareArrows-6cfe91c0.js";import{R as de,L as _e}from"./Refresh-15113b37.js";import{G as h}from"./Grid-f4fe8f5e.js";import{F as E,I as M,S as R,T as q}from"./TextField-f4478316.js";import{M as o}from"./MenuItem-9b67b98a.js";import{S as ue}from"./Search-6c7cbc40.js";import{B as d}from"./Button-1a27d212.js";import{C as G,a as D}from"./CardContent-c6d9d8f3.js";import{D as Y,a as J,b as me}from"./DialogContent-4b6d900f.js";import{D as Q}from"./DialogTitle-b41ccae4.js";import{A as he}from"./Autocomplete-6624bd2e.js";import{C as Ke}from"./Close-ccc56ba6.js";import{C as We}from"./Check-539a23f7.js";import{f as N}from"./helpers.segment-8c19304b.js";import"./Dropdown-7e91de2b.js";import"./transition-c702c485.js";import"./index-bfd76f8c.js";import"./Cancel-2b66ccf0.js";import"./Edit-fe6d01fe.js";import"./DatePicker-e4040754.js";import"./Popper-3a932d0a.js";import"./LastPage-91b1bb11.js";import"./SwitchBase-5ee4a60b.js";import"./Checkbox-b8c9b3ff.js";import"./Stack-748aea93.js";import"./CircularProgress-45c1cca5.js";import"./Switch-f95e3c95.js";const $e=V(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"}),"Assessment"),Ue=V(e.jsx("path",{fillRule:"evenodd",d:"M20 3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM10 17H5v-2h5v2zm0-4H5v-2h5v2zm0-4H5V7h5v2zm4.82 6L12 12.16l1.41-1.41 1.41 1.42L17.99 9l1.42 1.42L14.82 15z"}),"FactCheck"),Ye=V(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"}),"History"),Je=V(e.jsx("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"}),"ShoppingCart");function Mt({auth:u,errors:P,produits:g,typeProduits:H,categories:L,error:xe,success:pe,departements:v}){var re,ie,ae,ne;const[x,f]=i.useState([]),[X,I]=i.useState(!1),[je,T]=i.useState(!1),[ge,C]=i.useState(!1),[ve,y]=i.useState(0),[B,O]=i.useState([]),[_,F]=i.useState(""),[K,fe]=i.useState([]),[p,Ce]=i.useState({pageIndex:g.current_page-1,pageSize:g.per_page}),[s,W]=i.useState({categorie:"",typeProduit:"",departement:"",status:"",searchTerm:""});i.useEffect(()=>{y(g.total),f(g.data),C(!1)},[g]),i.useEffect(()=>{C(!0),T(!0);const t={start:p.pageIndex*p.pageSize,size:p.pageSize,filters:B??[],globalFilter:_??"",sorting:K??[]};s.departement&&(t.departement_id=s.departement);try{const r=u.user.id;qe.post(route("admin.stock.inventaire.paginationFiltre",{userId:r}),t).then(n=>{var c;if(n.data&&Array.isArray(n.data.data)){if(f(n.data.data),y(n.data.rowCount||n.data.data.length),n.data.departement_id){const m=((c=v.find(w=>w.id==n.data.departement_id))==null?void 0:c.nom)||"Sélectionné";console.log(`Affichage des stocks pour le département: ${m}`)}I(!1)}else f([]),y(0),console.warn("Réponse inattendue du serveur:",n),I(!1);T(!1),C(!1)}).catch(n=>{console.error("Erreur lors de la récupération des données:",n),f([]),y(0),T(!1),C(!1),I(!0)})}catch(r){console.error("Erreur lors de l'exécution de la requête:",r),f([]),y(0),T(!1),C(!1),I(!0)}},[B,_,p.pageIndex,p.pageSize,K,s.departement]);const{data:l,setData:S,post:Qe,put:ye,reset:Z}=Ge({id:"",nom:"",typeProduit:null,categorie:null});i.useState(!1);const[Se,be]=i.useState(!1),[ke,ee]=i.useState(!1),[ze,Ne]=i.useState(!1),Pe=()=>{k.get(route("admin.inventaire.create",u.user.id),{onSuccess:()=>Z()})},$=()=>{be(!1)},Ie=()=>{ee(!1)},te=()=>{Ne(!1)},Te=t=>{t.target.type==="checkbox"?S(t.target.name,t.target.checked):S(t.target.name,t.target.value)},Fe=t=>{S({id:t.id,nom:t.nom,typeProduit:t.typeProduit,categorie:t.categorie}),ee(!0)},Ae=()=>{ye(route("admin.stock.inventaire.update",[u.user.id,l.id]),{onSuccess:()=>{Z(),$()}})},we=()=>{k.delete(route("admin.stock.inventaire.destroy",[u.user.id,l.id]))},Ee=i.useMemo(()=>[{accessorKey:"nom",header:"Nom"},{accessorKey:"categorie.nom",header:"Catégorie",size:150},{accessorKey:"stockGlobal",header:"Stock",size:100,Cell:({row:t})=>{const r=t.original.stockGlobal||0,n=t.original.stockCritique||0;t.original.seuilMaximal;let c="success.main";return r===0?c="error.main":r<n&&(c="warning.main"),e.jsx(a,{sx:{color:c},children:N(r)})}},{accessorKey:"stockCritique",header:"Seuil Min",size:100,Cell:({row:t})=>e.jsx(a,{children:N(t.original.stockCritique||0)})},{accessorKey:"prixAchat",header:"Prix Achat",size:120,Cell:({row:t})=>e.jsx(a,{children:t.original.prixAchat?N(t.original.prixAchat)+" GNF":"0 GNF"})},{accessorKey:"valeurStock",header:"Valeur Stock",size:120,Cell:({row:t})=>{const r=(t.original.stockGlobal||0)*(t.original.prixAchat||0);return e.jsxs(a,{children:[N(r)," GNF"]})}},{accessorKey:"status",header:"Statut",size:120,Cell:({row:t})=>e.jsx(le,{label:t.original.status===1?"Actif":"Inactif",color:t.original.status===1?"success":"error",size:"small"})},{accessorKey:"actions",header:"Actions",size:200,Cell:({row:t})=>e.jsxs(De,{sx:{display:"flex",gap:"8px"},children:[e.jsx(z,{title:"Voir détails",children:e.jsx(j,{color:"primary",onClick:()=>Fe(t.original),children:e.jsx(Oe,{fontSize:"small"})})}),e.jsx(z,{title:"Historique des mouvements",children:e.jsx(j,{color:"info",children:e.jsx(Ye,{fontSize:"small"})})}),e.jsx(z,{title:"Ajuster le stock",children:e.jsx(j,{color:"secondary",onClick:()=>{k.get(route("admin.inventaire.ajustement.create",u.user.id),{produit_id:t.original.id})},children:e.jsx(ce,{fontSize:"small"})})}),e.jsx(z,{title:"Commander",children:e.jsx(j,{color:"warning",onClick:Pe,children:e.jsx(Je,{fontSize:"small"})})})]})}],[]),Me=He({columns:Ee,data:x,getRowId:t=>t.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualSorting:!0,muiToolbarAlertBannerProps:X?{color:"error",children:"Erreur lors du chargement des données. Veuillez réessayer ou contacter l'administrateur."}:void 0,onColumnFiltersChange:O,onGlobalFilterChange:F,onPaginationChange:Ce,onSortingChange:fe,rowCount:ve,state:{columnFilters:B,globalFilter:_,isLoading:je,pagination:p,showAlertBanner:X,showProgressBars:ge,sorting:K},localization:Be}),A=i.useMemo(()=>{const t=x.length,r=x.filter(m=>m.stockGlobal<m.stockCritique).length,n=x.filter(m=>m.stockGlobal===0).length,c=x.reduce((m,w)=>m+(w.stockGlobal||0)*(w.prixAchat||0),0);return{totalProduits:t,sousstockCritique:r,enRupture:n,valeurTotale:c}},[x]),b=t=>{const{name:r,value:n}=t.target;W(c=>({...c,[r]:n}))},se=()=>{const t=[];s.categorie&&t.push({id:"categorie",value:s.categorie}),s.typeProduit&&t.push({id:"typeProduit",value:s.typeProduit}),s.status&&(s.status==="rupture"?t.push({id:"stockGlobal",value:"0"}):s.status==="seuil"?t.push({id:"seuil_minimal",value:"true"}):t.push({id:"status",value:s.status})),O(t),s.searchTerm?F(s.searchTerm):F("")},Re=()=>{W({categorie:"",typeProduit:"",departement:"",status:"",searchTerm:""}),O([]),F("")};return e.jsx(Ve,{auth:u,success:pe,error:xe,errors:P,active:"stock",sousActive:"inventaire",breadcrumbs:[{text:"Inventaire",href:route("admin.stock.inventaire.index",[u.user.id]),active:!0}],children:e.jsxs("div",{className:"grid gap-5 bg-gray-200 p-2 rounded border w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:e.jsx("h2",{children:"Gestion des inventaires"})})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(z,{title:"Rafraîchir les données",children:e.jsx(j,{onClick:()=>window.location.reload(),children:e.jsx(de,{})})})})]}),e.jsxs(oe,{elevation:2,className:"p-4",children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Filtres Avancés"}),e.jsxs(h,{container:!0,spacing:2,className:"mb-3",children:[e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{fullWidth:!0,size:"small",children:[e.jsx(M,{children:"Catégorie"}),e.jsxs(R,{name:"categorie",value:s.categorie,onChange:b,label:"Catégorie",children:[e.jsx(o,{value:"",children:"Toutes"}),L&&L.map(t=>e.jsx(o,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{fullWidth:!0,size:"small",children:[e.jsx(M,{children:"Type de Produit"}),e.jsxs(R,{name:"typeProduit",value:s.typeProduit,onChange:b,label:"Type de Produit",children:[e.jsx(o,{value:"",children:"Tous"}),H&&H.map(t=>e.jsx(o,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{fullWidth:!0,size:"small",children:[e.jsx(M,{children:"Département"}),e.jsxs(R,{name:"departement",value:s.departement,onChange:b,label:"Département",children:[e.jsx(o,{value:"",children:"Tous"}),v&&v.map(t=>e.jsx(o,{value:t.id,children:t.nom},t.id))]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{fullWidth:!0,size:"small",children:[e.jsx(M,{children:"Statut"}),e.jsxs(R,{name:"status",value:s.status,onChange:b,label:"Statut",children:[e.jsx(o,{value:"",children:"Tous"}),e.jsx(o,{value:"1",children:"Actif"}),e.jsx(o,{value:"0",children:"Inactif"}),e.jsx(o,{value:"rupture",children:"En rupture"}),e.jsx(o,{value:"seuil",children:"Sous seuil minimal"})]})]})})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,md:6,children:e.jsx(q,{fullWidth:!0,size:"small",label:"Recherche par nom, référence...",name:"searchTerm",value:s.searchTerm,onChange:b,InputProps:{endAdornment:e.jsx(j,{size:"small",children:e.jsx(ue,{})})}})}),e.jsxs(h,{item:!0,xs:12,md:6,className:"flex justify-end",children:[e.jsx(d,{variant:"outlined",color:"secondary",onClick:Re,className:"mr-2",startIcon:e.jsx(de,{}),children:"Réinitialiser"}),e.jsx(d,{variant:"contained",color:"primary",onClick:se,startIcon:e.jsx(ue,{}),children:"Appliquer les filtres"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsx(G,{elevation:2,children:e.jsxs(D,{children:[e.jsx(a,{color:"textSecondary",gutterBottom:!0,children:"Total Produits"}),e.jsx(a,{variant:"h4",component:"div",children:A.totalProduits}),e.jsx(a,{variant:"body2",color:"textSecondary",children:s.departement?`Produits dans ${((re=v.find(t=>t.id==s.departement))==null?void 0:re.nom)||"le département"}`:"Produits en inventaire"})]})})}),e.jsx("div",{children:e.jsx(G,{elevation:2,children:e.jsxs(D,{children:[e.jsx(a,{color:"textSecondary",gutterBottom:!0,children:"Stock Critique"}),e.jsx(a,{variant:"h4",component:"div",color:"warning.main",children:A.sousstockCritique}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Produits à réapprovisionner"})]})})}),e.jsx("div",{children:e.jsx(G,{elevation:2,children:e.jsxs(D,{children:[e.jsx(a,{color:"textSecondary",gutterBottom:!0,children:"En Rupture"}),e.jsx(a,{variant:"h4",component:"div",color:"error.main",children:A.enRupture}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Produits en rupture de stock"})]})})}),e.jsx("div",{children:e.jsx(G,{elevation:2,children:e.jsxs(D,{children:[e.jsx(a,{color:"textSecondary",gutterBottom:!0,children:"Valeur Totale"}),e.jsxs(a,{variant:"h4",component:"div",color:"primary.main",children:[N(A.valeurTotale)," GNF"]}),e.jsx(a,{variant:"body2",color:"textSecondary",children:"Valeur de l'inventaire"})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(Ue,{}),onClick:()=>k.get(route("admin.inventaire.physique.index",u.user.id)),children:"Inventaire Physique"}),e.jsx(d,{variant:"contained",color:"secondary",startIcon:e.jsx(ce,{}),onClick:()=>k.get(route("admin.inventaire.ajustement.index",u.user.id)),children:"Ajustements d'Inventaire"}),e.jsx(d,{variant:"contained",color:"warning",startIcon:e.jsx($e,{}),children:"Rapports d'Inventaire"}),e.jsx(d,{variant:"contained",color:"info",startIcon:e.jsx(_e,{}),children:"Commandes Fournisseurs"})]}),e.jsxs("div",{children:[e.jsxs(Y,{open:Se,onClose:$,children:[e.jsx(Q,{className:"bg-blue-600 text-white",children:"Modification du produit"}),e.jsxs(J,{className:"space-y-5",children:[e.jsxs("div",{className:"mt-5",children:[e.jsx(q,{autoFocus:!0,margin:"dense",id:"nom",name:"nom",label:"Nom",type:"text",fullWidth:!0,variant:"standard",value:l.nom,onChange:Te}),e.jsx(U,{message:P.nom,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(he,{disablePortal:!0,id:"typeProduit",options:H,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,r)=>t.id===r.id,value:l.typeProduit,onChange:(t,r)=>{S("typeProduit",r)},renderInput:t=>e.jsx(q,{...t,label:"Type de produit"})}),e.jsx(U,{message:P.typeProduit,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(he,{disablePortal:!0,id:"categorie",options:L,getOptionLabel:t=>t.nom,isOptionEqualToValue:(t,r)=>t.id===r.id,value:l.categorie,onChange:(t,r)=>{S("categorie",r)},renderInput:t=>e.jsx(q,{...t,label:"Catégorie"})}),e.jsx(U,{message:P.categorie,className:"mt-2"})]})]}),e.jsxs(me,{children:[e.jsx(d,{variant:"contained",color:"error",onClick:$,children:"Annuler"}),e.jsx(d,{variant:"contained",color:"success",onClick:Ae,children:"Enregistrer"})]})]}),e.jsxs(Y,{open:ke,onClose:Ie,children:[e.jsx(Q,{className:"bg-blue-600 text-white",children:"Détails du produit"}),e.jsx(J,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:l.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ie=l.typeProduit)==null?void 0:ie.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(ae=l.categorie)==null?void 0:ae.nom})]})]})})]}),e.jsxs(Y,{open:ze,onClose:te,children:[e.jsx(Q,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(J,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[l.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",l.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(me,{children:[e.jsxs(d,{variant:"contained",color:"error",onClick:te,children:[e.jsx(Ke,{}),"  Non"]}),e.jsxs(d,{variant:"contained",color:"success",onClick:we,children:[e.jsx(We,{})," Oui"]})]})]})]}),e.jsxs(oe,{elevation:2,className:"p-4 overflow-scroll",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(a,{variant:"h6",children:"Liste des Produits en Stock"}),s.departement&&e.jsx(le,{color:"primary",label:`Stock du département: ${((ne=v.find(t=>t.id==s.departement))==null?void 0:ne.nom)||"Sélectionné"}`,onDelete:()=>{W(t=>({...t,departement:""})),setTimeout(()=>se(),100)}})]}),e.jsx("div",{children:e.jsx(Le,{table:Me})})]})]})})}export{Mt as default};
