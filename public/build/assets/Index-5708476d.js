import{j as e,r as c,W as Oe,y as u}from"./app-4edf48e5.js";import{P as qe,T as n,a as _,B as q}from"./PanelLayout-f2722d4d.js";/* empty css            */import{u as Ve,M as We}from"./index.esm-9dae7fe5.js";import{M as Re}from"./index.esm-4bae7fd4.js";import{I as b}from"./InputError-6da1aa5e.js";import{B as l}from"./Button-287e2751.js";import{V as Ke}from"./Visibility-1d75f6de.js";import{E as Le}from"./Edit-d3d63b61.js";import{D as $e}from"./Delete-1f926d7e.js";import{C as ce}from"./Check-c32f5732.js";import{A as Be}from"./ArrowBack-568090f4.js";import{c as W}from"./createSvgIcon-5bc31cb8.js";import{A as Ge}from"./AddCircle-b634ae43.js";import{D as I,a as w,b as V}from"./DialogContent-8a1e29b1.js";import{D as F}from"./DialogTitle-9058224f.js";import{T as C,F as z,I as D,S as P}from"./TextField-552e66ea.js";import{A as T}from"./Autocomplete-296c4901.js";import{C as ue}from"./Close-18195805.js";import{G as s}from"./Grid-7a3a83b6.js";import{W as me}from"./Warning-4e203777.js";import{T as Ue}from"./TrendingUp-7f02a804.js";import{M as p}from"./MenuItem-b79354fa.js";import{C as E}from"./Chip-0001e9bb.js";import{f as A}from"./helpers.segment-8c19304b.js";import"./Dropdown-4c3aabf3.js";import"./transition-92123e1c.js";import"./index-17fa150b.js";import"./Cancel-a6a6eef9.js";import"./Edit-fc260d54.js";import"./TableRow-96be2280.js";import"./Popper-aabbbbc2.js";import"./DatePicker-b73dcf77.js";import"./LastPage-76c05c1b.js";import"./SwitchBase-2ee5bbf3.js";import"./Checkbox-521167ff.js";import"./Stack-01e86631.js";import"./CircularProgress-210c747e.js";import"./Switch-3b9ccd2c.js";const pe=W(e.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline"),He=W(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"}),"FileDownload"),Qe=W(e.jsx("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"FileUpload");function Ai({auth:a,errors:f,produits:k,typeProduits:S,categories:N,departements:y,error:xe,success:he,filters:t,stats:r}){var ee,ie,re,oe,te,le,ne,ae,se;const[R,ge]=c.useState({pageIndex:k.current_page-1,pageSize:k.per_page}),[x,K]=c.useState((t==null?void 0:t.categorie_id)||""),[h,L]=c.useState((t==null?void 0:t.type_produit_id)||""),[m,$]=c.useState((t==null?void 0:t.stock_filter)||"all"),[g,B]=c.useState((t==null?void 0:t.departement_id)||""),je=i=>{ge(i),u.get(route("admin.stock.produit.index",{userId:a.user.id}),{page:i.pageIndex+1,per_page:i.pageSize},{preserveState:!0,preserveScroll:!0,only:["produits"]})},ve=i=>{u.get(route("admin.stock.produit.index",{userId:a.user.id}),{search:i,page:1,categorie_id:x,type_produit_id:h,stock_filter:m,departement_id:g},{preserveState:!0,preserveScroll:!0,only:["produits"]})},j=(i,o)=>{switch(i){case"categorie":K(o);break;case"typeProduit":L(o);break;case"stock":$(o);break;case"departement":B(o);break}u.get(route("admin.stock.produit.index",{userId:a.user.id}),{search:(t==null?void 0:t.search)||"",page:1,categorie_id:i==="categorie"?o:x,type_produit_id:i==="typeProduit"?o:h,stock_filter:i==="stock"?o:m,departement_id:i==="departement"?o:g},{preserveState:!0,preserveScroll:!0,only:["produits","stats"]})},fe=i=>{i.length>0&&u.get(route("admin.stock.produit.index",{userId:a.user.id}),{sort_field:i[0].id,sort_direction:i[0].desc?"desc":"asc",page:R.pageIndex+1,categorie_id:x,type_produit_id:h,stock_filter:m,departement_id:g},{preserveState:!0,preserveScroll:!0,only:["produits"]})},ye=i=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(i),{data:d,setData:v,post:be,put:Ce,reset:M}=Oe({id:"",nom:"",typeProduit:null,categorie:null}),[ke,O]=c.useState(!1),[Se,G]=c.useState(!1),[Ne,U]=c.useState(!1),[_e,H]=c.useState(!1),Ie=()=>{u.get(route("admin.stock.produit.create",{userId:a.user.id}),{onSuccess:()=>M()})},we=i=>{const o=i.target.files[0];if(o){const de=new FormData;de.append("file",o),u.post(route("admin.stock.produit.import-csv",{userId:a.user.id}),de,{onSuccess:()=>{i.target.value=null}})}},Q=()=>{O(!1)},Y=()=>{G(!1)},Fe=()=>{U(!1)},J=()=>{H(!1)},X=i=>{i.target.type==="checkbox"?v(i.target.name,i.target.checked):v(i.target.name,i.target.value)},ze=()=>{be(route("admin.produit.store"),{onSuccess:()=>{M(),O(!1)}})},De=i=>{u.get(route("admin.produit.edit",[a.user.id,i.id]),{preserveScroll:!0})},Pe=i=>{v({id:i.id,nom:i.nom||"",typeProduit:i.type_souscripteur||null,categorie:i.categorie_souscripteur||null}),U(!0)},Z=(i,o)=>{v({id:i,message:o}),H(!0)},Te=()=>{Ce(route("admin.produit.update",d.id),{onSuccess:()=>{M(),G(!1)}})},Ee=()=>{O(!1),u.delete(route("admin.produit.destroy",{id:d.id}))},Ae=c.useMemo(()=>[{accessorKey:"nom",header:"Nom"},{accessorKey:"typeProduitAchat",header:"Option d'achat",Cell:({row:i})=>{var o;return(o=i.original.type_produit_achat)==null?void 0:o.libelle}},{accessorKey:"prixAchat",header:"Prix d'achat (GNF)",Cell:({row:i})=>A(i.original.prixAchat??0)},{accessorKey:"quantiteAchat",header:"Quantité à l'achat",Cell:({row:i})=>A(i.original.quantiteAchat??0)},{accessorKey:"typeProduitVente",header:"Option de vente",Cell:({row:i})=>{var o;return(o=i.original.type_produit_vente)==null?void 0:o.libelle}},{accessorKey:"prixVente",header:"Prix d'achat (GNF)",Cell:({row:i})=>A(i.original.prixVente??0)},{accessorKey:"quantiteVente",header:"Quantité à la vente",Cell:({row:i})=>A(i.original.quantiteVente??0)},{accessorKey:"categorie",header:"Categorie",Cell:({row:i})=>{var o;return(o=i.original.categorie)==null?void 0:o.libelle}},{accessorKey:"status",header:"Status",Cell:({row:i})=>i.original.status?e.jsx("div",{className:"p-2 font-bold bg-green-500 text-white w-fit h-fit rounded",children:"Actif"}):e.jsx("div",{className:"p-2 font-bold bg-red-500 text-white w-fit h-fit rounded",children:"Inactif"})},{accessorKey:"action",header:"Action",Cell:({row:i})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:()=>Pe(i.original),variant:"contained",size:"small",color:"info",children:e.jsx(Ke,{})}),e.jsx(l,{onClick:()=>De(i.original),variant:"contained",size:"small",color:"secondary",children:e.jsx(Le,{})}),i.original.status?e.jsx(l,{onClick:()=>Z(i.original.id,"delete"),variant:"contained",size:"small",color:"error",children:e.jsx($e,{})}):e.jsx(l,{onClick:()=>Z(i.original.id,"check"),variant:"contained",size:"small",color:"success",children:e.jsx(ce,{})})]},i.original.id)}],[]),Me=Ve({columns:Ae,data:k.data,getRowId:i=>i.id,initialState:{showColumnFilters:!1},manualFiltering:!0,manualPagination:!0,manualSorting:!0,onGlobalFilterChange:ve,onPaginationChange:je,onSortingChange:fe,rowCount:k.total,state:{pagination:R},localization:Re});return e.jsx(qe,{auth:a,success:he,error:xe,errors:f,active:"stock",sousActive:"produit",breadcrumbs:[{text:"Stock",href:route("admin.dashboard",{id:a.user.id}),active:!1},{text:"Produits",href:route("admin.stock.produit.index",{userId:a.user.id}),active:!0}],children:e.jsxs("div",{className:"p-4 bg-white rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Liste des produits"}),e.jsx(l,{variant:"outlined",startIcon:e.jsx(Be,{}),onClick:()=>u.get(route("admin.dashboard",{id:a.user.id})),children:"Retour au tableau de bord"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{color:"success",variant:"outlined",onClick:()=>window.location.href=route("admin.stock.produit.export-csv",{userId:a.user.id}),children:[e.jsx(He,{className:"mr-1"})," Exporter CSV"]}),e.jsxs("label",{htmlFor:"upload-csv",children:[e.jsx("input",{style:{display:"none"},id:"upload-csv",name:"upload-csv",type:"file",accept:".csv",onChange:we}),e.jsxs(l,{color:"info",variant:"outlined",component:"span",children:[e.jsx(Qe,{className:"mr-1"})," Importer CSV"]})]}),e.jsxs(l,{color:"warning",variant:"contained",onClick:Ie,children:[e.jsx(Ge,{className:"mr-1"})," Ajout produit"]})]}),e.jsxs(I,{open:ke,onClose:Q,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Ajout du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(C,{value:d.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(b,{message:f.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{className:"w-full",onChange:(i,o)=>v("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(b,{message:f["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{className:"w-full",onChange:(i,o)=>v("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(b,{message:f["data.categorie"]})]})]})}),e.jsxs(V,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:Q,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:ze,children:"Enregistrer"})]})]}),e.jsxs(I,{open:Se,onClose:Y,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Modification du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid sm:grid-cols-2 grid-cols-1 bg-gray-50 gap-5 p-2 m-2 rounded",children:[e.jsxs("div",{children:[e.jsx(C,{value:d.nom,autoFocus:!0,id:"nom",name:"nom",label:"Nom",className:"bg-white",fullWidth:!0,onChange:X}),e.jsx(b,{message:f.nom,className:"mt-2"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{value:d.typeProduit,className:"w-full",onChange:(i,o)=>v("typeProduit",o),disablePortal:!0,options:S,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Type de produit",label:i.nom})}),e.jsx(b,{message:f["data.typeProduit"]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx(T,{value:d.categorie,className:"w-full",onChange:(i,o)=>v("categorie",o),disablePortal:!0,options:N,groupBy:i=>i.categorie.libelle,getOptionLabel:i=>i.nom,isOptionEqualToValue:(i,o)=>i.id===o.id,renderInput:i=>e.jsx(C,{fullWidth:!0,...i,placeholder:"Catégorie de produit",label:i.nom})}),e.jsx(b,{message:f["data.categorie"]})]})]})}),e.jsxs(V,{children:[e.jsx(l,{variant:"contained",color:"error",onClick:Y,children:"Annuler"}),e.jsx(l,{variant:"contained",color:"success",onClick:Te,children:"Enregistrer"})]})]}),e.jsxs(I,{open:Ne,onClose:Fe,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Details du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"grid grid-cols-2 mt-5 divide-y divide-x border w-96 min-w-fit",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"NOM"}),e.jsx("div",{className:"py-2 px-2",children:d.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"TYPE"}),e.jsx("div",{className:"py-2 px-2",children:(ee=d.typeProduit)==null?void 0:ee.nom})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold py-2 px-2",children:"CATEGORIE"}),e.jsx("div",{className:"py-2 px-2",children:(ie=d.categorie)==null?void 0:ie.nom})]})]})})]}),e.jsxs(I,{open:_e,onClose:J,children:[e.jsx(F,{className:"bg-orange-600 text-white",children:"Suppression du produit"}),e.jsx(w,{className:"space-y-5",children:e.jsxs("div",{className:"mt-5",children:[d.message==="delete"&&"Voulez-vous vraiment suspendre ce produit",d.message==="check"&&"Voulez-vous vraiment débloquer ce produit"]})}),e.jsxs(V,{children:[e.jsxs(l,{variant:"contained",color:"error",onClick:J,children:[e.jsx(ue,{}),"  Non"]}),e.jsxs(l,{variant:"contained",color:"success",onClick:Ee,children:[e.jsx(ce,{})," Oui"]})]})]})]}),e.jsxs("div",{children:[e.jsxs(s,{container:!0,spacing:2,sx:{mt:2,mb:3},children:[e.jsx(s,{item:!0,xs:12,children:e.jsxs(n,{variant:"h6",sx:{mb:1,fontWeight:"bold"},children:[r!=null&&r.departement?`Statistiques pour le département: ${r.departement.nom_departement}`:"Statistiques globales",(g||x||h||m!=="all")&&e.jsx(n,{variant:"caption",sx:{ml:1,fontWeight:"normal",display:"inline-block"},children:"(filtrées selon les critères sélectionnés)"})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(n,{variant:"h6",color:"primary",children:"Total Produits"}),e.jsx(n,{variant:"h4",children:r!=null&&r.departement?r.departement.total_produits:(r==null?void 0:r.total_produits)||0})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#fff9c4"},children:[e.jsxs(n,{variant:"h6",color:"warning.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{fontSize:"small",sx:{mr:1}})," Stock Critique"]}),e.jsx(n,{variant:"h4",color:"warning.main",children:r!=null&&r.departement?r.departement.stockCritique:(r==null?void 0:r.stockCritique)||0}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((re=r.departement)==null?void 0:re.stockCritique)||0)/(((oe=r.departement)==null?void 0:oe.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stockCritique)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#ffebee"},children:[e.jsxs(n,{variant:"h6",color:"error",sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",sx:{mr:1}})," Stock Épuisé"]}),e.jsx(n,{variant:"h4",color:"error",children:r!=null&&r.departement?r.departement.stock_epuise:(r==null?void 0:r.stock_epuise)||0}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r&&(r.departement?`${Math.round((((te=r.departement)==null?void 0:te.stock_epuise)||0)/(((le=r.departement)==null?void 0:le.total_produits)||1)*100)}%`:`${Math.round(((r==null?void 0:r.stock_epuise)||0)/((r==null?void 0:r.total_produits)||1)*100)}%`)})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(_,{elevation:2,sx:{p:2,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#e8f5e9"},children:[e.jsxs(n,{variant:"h6",color:"success.main",sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ue,{fontSize:"small",sx:{mr:1}})," Valeur Stock"]}),e.jsx(n,{variant:"h4",color:"success.main",children:ye(r!=null&&r.departement?r.departement.valeur_totale_stock:(r==null?void 0:r.valeur_totale_stock)||0)})]})})]}),e.jsxs(s,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(n,{variant:"subtitle1",sx:{mb:1,fontWeight:"bold"},children:"Filtres"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Département"}),e.jsxs(P,{value:g,onChange:i=>j("departement",i.target.value),label:"Département",children:[e.jsx(p,{value:"",children:"Tous les départements"}),y==null?void 0:y.map(i=>e.jsx(p,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Catégorie"}),e.jsxs(P,{value:x,onChange:i=>j("categorie",i.target.value),label:"Catégorie",children:[e.jsx(p,{value:"",children:"Toutes les catégories"}),N.map(i=>e.jsx(p,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"Type de produit"}),e.jsxs(P,{value:h,onChange:i=>j("typeProduit",i.target.value),label:"Type de produit",children:[e.jsx(p,{value:"",children:"Tous les types"}),S.map(i=>e.jsx(p,{value:i.id,children:i.nom},i.id))]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{fullWidth:!0,variant:"outlined",size:"small",children:[e.jsx(D,{children:"État du stock"}),e.jsxs(P,{value:m,onChange:i=>j("stock",i.target.value),label:"État du stock",children:[e.jsx(p,{value:"all",children:"Tous les produits"}),e.jsx(p,{value:"low",children:e.jsxs(q,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{fontSize:"small",color:"warning",sx:{mr:1}}),"Stock critique"]})}),e.jsx(p,{value:"out",children:e.jsxs(q,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{fontSize:"small",color:"error",sx:{mr:1}}),"Stock épuisé"]})})]})]})})]}),(g||x||h||m!=="all")&&e.jsxs(q,{sx:{mb:2,display:"flex",flexWrap:"wrap",gap:1},children:[e.jsx(n,{variant:"body2",sx:{mr:1,display:"flex",alignItems:"center"},children:"Filtres actifs:"}),g&&e.jsx(E,{label:`Département: ${((ne=y==null?void 0:y.find(i=>i.id===parseInt(g)))==null?void 0:ne.nom)||""}`,onDelete:()=>j("departement",""),color:"primary",variant:"outlined",size:"small"}),x&&e.jsx(E,{label:`Catégorie: ${((ae=N.find(i=>i.id===parseInt(x)))==null?void 0:ae.nom)||""}`,onDelete:()=>j("categorie",""),color:"primary",variant:"outlined",size:"small"}),h&&e.jsx(E,{label:`Type: ${((se=S.find(i=>i.id===parseInt(h)))==null?void 0:se.nom)||""}`,onDelete:()=>j("typeProduit",""),color:"primary",variant:"outlined",size:"small"}),m!=="all"&&e.jsx(E,{label:m==="low"?"Stock critique":"Stock épuisé",onDelete:()=>j("stock","all"),color:m==="low"?"warning":"error",variant:"outlined",size:"small"}),e.jsx(l,{variant:"text",size:"small",startIcon:e.jsx(ue,{fontSize:"small"}),onClick:()=>{B(""),K(""),L(""),$("all"),u.get(route("admin.stock.produit.index",{userId:a.user.id}),{page:1})},children:"Réinitialiser tous les filtres"})]})]}),e.jsx(We,{table:Me})]})})}export{Ai as default};
