import{W as _e,r as l,j as a,y as Q}from"./app-80aef6d5.js";import{I as m}from"./InputError-be802d9f.js";import D from"./NumberFormatCustomUtils-cfcd62a8.js";import{d as qe,P as Te}from"./PanelLayout-a81f80b5.js";import{u as J,M as X}from"./index.esm-6c7ac6f1.js";import{M as Z}from"./index-223c7b24.js";import{T as d,a as Ee}from"./TextField-f4478316.js";import{B as g}from"./Button-1a27d212.js";import{C as ee}from"./Close-ccc56ba6.js";import{A as Me}from"./ArrowBack-3e4617e1.js";import{m as Pe}from"./motion-d7b847b4.js";import{D as $e}from"./DatePicker-e4040754.js";import{A as u}from"./Autocomplete-6624bd2e.js";import{f as x}from"./helpers.segment-8c19304b.js";import"./createSvgIcon-f9f11e70.js";import"./index-bfd76f8c.js";import"./Dropdown-7e91de2b.js";import"./transition-c702c485.js";import"./Cancel-2b66ccf0.js";import"./Edit-fe6d01fe.js";import"./TableRow-8bf34bd7.js";import"./Popper-3a932d0a.js";import"./MenuItem-9b67b98a.js";import"./LastPage-91b1bb11.js";import"./SwitchBase-5ee4a60b.js";import"./Checkbox-b8c9b3ff.js";import"./Chip-4667134d.js";import"./Stack-748aea93.js";import"./CircularProgress-45c1cca5.js";import"./DialogContent-4b6d900f.js";import"./DialogTitle-b41ccae4.js";import"./Switch-f95e3c95.js";function Ot({auth:h,produits:j,departements:S,departementPrincipal:v,caisses:te,caissePrincipale:ie,motifsEntrees:ke,motifsSorties:ae,motifsTransferts:se,motifsDepenses:b,motifEntreeDefaut:oe,motifSortieDefaut:ne,motifTransfertDefaut:le,fournisseurs:re,fournisseurPrincipal:de,devises:Ie,uniteMesures:we,errors:c,success:_,error:q,referentiels:ze,typeOperations:ce,typeOperation:me,mouvement:Fe}){var P,$,k,I,w,z,F,L,W,K,R,V;const{data:i,setData:n,processing:Le}=_e({date:qe(),nom:"",prixAchat:"",prixVente:"",quantiteAchat:"",produit:null,motif:null,fournisseur:de,departementSource:null,departementDestination:null,caisse:ie,uniteMesure:null,devise:null,operations:[],depenses:[],montantDepense:"",totalOperation:null,totalDepense:null,enregistrer:!1,typeOperation:me,produits:[],motifsDepenses:[],motifEntree:oe,motifSortie:ne,motifTransfert:le});l.useEffect(()=>{var e,t,s;((e=i.typeOperation)==null?void 0:e.nom)==="entrée"&&n("departementDestination",v),((t=i.typeOperation)==null?void 0:t.nom)==="sortie"&&n("departementSource",v),((s=i.typeOperation)==null?void 0:s.nom)==="transfert"&&n(r=>({...r,departementSource:v,departementDestination:null}))},[i.typeOperation]);const[T,We]=l.useState(!1),[ue,y]=l.useState(!1),[pe,fe]=l.useState(!1),O=e=>{e.target.type==="checkbox"?n(t=>({...t,[e.target.name]:e.target.checked})):n(t=>({...t,[e.target.name]:e.target.value}))},A=e=>{e.target.type==="checkbox"?n(t=>({...t,[e.target.name]:e.target.checked})):n(t=>({...t,[e.target.name]:e.target.value}))};l.useEffect(()=>{let e=0,t=[];i.operations.forEach(s=>{var r,o,p;((r=i.typeOperation)==null?void 0:r.nom)==="entrée"?(i[`quantiteAchat.${s.id}`]&&i[`prixAchat.${s.id}`]&&(e+=i[`quantiteAchat.${s.id}`]*i[`prixAchat.${s.id}`],t.push({id:s.id,prixAchat:parseInt(i[`prixAchat.${s.id}`]),quantiteAchat:parseInt(i[`quantiteAchat.${s.id}`]),produit_id:s.produit_id,produit_nom:s.produit_nom,type_produit_achat_id:s.type_produit_achat_id})),i[`prixAchat.${s.id}`]||n(f=>({...f,[`prixAchat.${s.id}`]:s.prixAchat}))):(((o=i.typeOperation)==null?void 0:o.nom)==="sortie"||((p=i.typeOperation)==null?void 0:p.nom)==="transfert")&&i[`quantiteAchat.${s.id}`]&&t.push({id:s.id,quantiteAchat:parseInt(i[`quantiteAchat.${s.id}`]),produit_id:s.produit_id,produit_nom:s.produit_nom})}),n(s=>({...s,totalOperation:e,operationData:t}))},[i.operations,i]),l.useEffect(()=>{let e=[],t=0;i.depenses.forEach(s=>{i[`montantDepense.${s.id}`]&&(t+=parseInt(i[`montantDepense.${s.id}`]),e.push({id:s.id,montant:parseInt(i[`montantDepense.${s.id}`]),motif:s.motif,motif_id:s.motif_id,commentaire:i[`commentaire.${s.id}`]}))}),n(s=>({...s,totalDepense:t,depenseData:e}))},[i.depenses,i]);const[he,xe]=l.useState({prixAchat:((P=i.typeOperation)==null?void 0:P.nom)==="entrée",montant:(($=i.typeOperation)==null?void 0:$.nom)==="entrée",typeProduitAchat:((k=i.typeOperation)==null?void 0:k.nom)==="entrée"});l.useEffect(()=>{n(e=>({...e,total:(i.totalOperation||0)+(i.totalDepense||0)}))},[i.totalOperation,i.totalDepense]);const ge=l.useMemo(()=>[{accessorKey:"N°",header:"N°",Cell:({row:e})=>e.index+1},{accessorKey:"nom",header:"Nom",Cell:({row:e})=>{var t;return(t=e.original.produit)==null?void 0:t.nom}},{accessorKey:"typeProduitAchat",header:"Type d'achat",Cell:({row:e})=>{var t;return((t=e.original.type_produit_achat)==null?void 0:t.toLowerCase())=="ensemble"?"Engros":"Unité"}},{accessorKey:"prixAchat",header:"Prix d'achat (GNF)",Cell:({row:e})=>a.jsx(d,{name:`prixAchat.${e.original.id}`,value:i[`prixAchat.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:-1e12}},className:"w-full",onChange:O,size:"small"})},{accessorKey:"quantiteAchat",header:"Quantité",Cell:({row:e})=>a.jsx(d,{name:`quantiteAchat.${e.original.id}`,value:i[`quantiteAchat.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:-1e12}},className:"w-full",onChange:O,size:"small"})},{accessorKey:"montant",header:"Montant (GNF)",Cell:({row:e})=>{const t=parseFloat(i[`prixAchat.${e.original.id}`]||0),s=parseFloat(i[`quantiteAchat.${e.original.id}`]||0),r=t*s;return r>0?`${x(r)} GNF`:""}},{accessorKey:"action",header:"Action",Cell:({row:e})=>a.jsx(g,{onClick:()=>E(e.original.id),variant:"contained",size:"small",color:"error",children:a.jsx(ee,{})},e.original.id)}],[i,O,E]),je=l.useMemo(()=>[{accessorKey:"motif",header:"Motif",Cell:({row:e})=>{var t;return(t=e.original.motif)==null?void 0:t.nom}},{accessorKey:"montant",header:"Montant (GNF)",Cell:({row:e})=>a.jsx(d,{name:`montantDepense.${e.original.id}`,value:i[`montantDepense.${e.original.id}`]||"",InputProps:{inputComponent:D,inputProps:{max:1e11,min:-1e12}},className:"w-full",onChange:A,size:"small"})},{accessorKey:"commentaire",header:"Commentaire",Cell:({row:e})=>{var t,s;return a.jsx(Ee,{name:`commentaire.${e.original.id}`,value:i[`commentaire.${e.original.id}`]||"",className:"w-full",onChange:A,size:"small",multiline:!0,minRows:1,required:((s=(t=e==null?void 0:e.original)==null?void 0:t.motif)==null?void 0:s.nom)==="autres"})}},{accessorKey:"action",header:"Action",Cell:({row:e})=>a.jsx(g,{onClick:()=>M(e.original.id),variant:"contained",size:"small",color:"error",type:"button",children:a.jsx(ee,{})},e.original.id)}],[i,A,M]);l.useEffect(()=>{y(_)},[_]),l.useEffect(()=>{fe(q)},[q]);function ve(e){var t,s,r,o,p,f,G,B,U,Y,H;e.preventDefault(),Q.post(route("admin.stock.mouvement.store",h.user.id),{date:i.date,typeOperation:(t=i.typeOperation)==null?void 0:t.id,typeOperation_nom:(s=i.typeOperation)==null?void 0:s.nom,fournisseur:((r=i.typeOperation)==null?void 0:r.nom)==="entrée"?(o=i.fournisseur)==null?void 0:o.id:null,departementSource:(p=i.departementSource)==null?void 0:p.id,departementDestination:(f=i.departementDestination)==null?void 0:f.id,motifSortie:((G=i.typeOperation)==null?void 0:G.nom)==="sortie"?(B=i.motifSortie)==null?void 0:B.id:null,motifTransfert:((U=i.typeOperation)==null?void 0:U.nom)==="transfert"?(Y=i.motifTransfert)==null?void 0:Y.id:null,caisse:(H=i.caisse)==null?void 0:H.id,operations:i.operationData,depenses:i.depenseData,totalOperation:i.totalOperation,totalDepense:i.totalDepense},{preserveScroll:!0})}l.useEffect(()=>{var t,s,r;let e=[];((t=i.typeOperation)==null?void 0:t.nom)==="entrée"?i.produits.map(o=>{var p,f;e.push({id:o.id,produit:o,produit_id:o==null?void 0:o.id,produit_nom:o==null?void 0:o.nom,type_produit_achat:(p=o==null?void 0:o.type_produit_achat)==null?void 0:p.nom,type_produit_achat_id:(f=o==null?void 0:o.type_produit_achat)==null?void 0:f.id,prixAchat:o.prixAchat,quantiteAchat:"",montant:""})}):(((s=i.typeOperation)==null?void 0:s.nom)==="sortie"||((r=i.typeOperation)==null?void 0:r.nom)==="transfert")&&i.produits.map(o=>{e.push({id:o.id,produit:o,produit_id:o==null?void 0:o.id,produit_nom:o==null?void 0:o.nom,quantiteAchat:""})}),n(o=>({...o,operations:e}))},[i.produits]);function E(e){n(t=>({...t,produits:t.produits.filter(s=>s.id!==e)})),n(t=>({...t,["prixAchat."+e]:"",["quantiteAchat."+e]:""})),y("Produit retiré avec succès")}l.useEffect(()=>{let e=[];i.motifsDepenses.map(t=>{e.push({id:t.id,motif:t,motif_id:t==null?void 0:t.id,montant:"",commentaire:""})}),n(t=>({...t,depenses:e}))},[i.motifsDepenses]);function M(e){n(t=>({...t,motifsDepenses:t.motifsDepenses.filter(s=>s.id!==e)})),n(t=>({...t,["montantDepense."+e]:""})),y("Dépense retirée avec succès")}const be=J({columns:ge,data:i.operations,state:{columnVisibility:he,showProgressBars:T},onColumnVisibilityChange:xe,localization:Z}),ye=J({columns:je,data:i.depenses,state:{showProgressBars:T},localization:Z}),[Oe,N]=l.useState(!1),Ae=[{id:"select-all",nom:"Tous les produits"},...j],Ne=(e,t)=>{t.some(s=>s.id==="select-all")?Oe?(n("produits",[]),N(!1)):(n("produits",j),N(!0)):(n("produits",t),N(t.length===j.length))},[Ce,C]=l.useState(!1),De=[{id:"select-all",nom:"Tous les motifs"},...b],Se=(e,t)=>{t.some(s=>s.id==="select-all")?Ce?(n("motifsDepenses",[]),C(!1)):(n("motifsDepenses",b),C(!0)):(n("motifsDepenses",t),C(t.length===b.length))};return a.jsx(Te,{auth:h,success:ue,error:pe,active:"stock",sousActive:"mouvement",breadcrumbs:[{text:"Mouvement",href:route("admin.stock.mouvement.index",h.user.id),active:!1},{text:"Nouveau",href:route("admin.stock.mouvement.create",h.user.id),active:!0}],children:a.jsx("div",{children:a.jsxs("div",{className:"w-full",children:[a.jsx("div",{className:"p-4 bg-white rounded mb-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("div",{className:"bg-black w-fit p-2 rounded text-xl font-bold text-white",children:a.jsx("h2",{children:"Nouveau mouvement"})}),a.jsx(g,{variant:"outlined",startIcon:a.jsx(Me,{}),onClick:()=>Q.get(route("admin.stock.mouvement.index",h.user.id)),children:"Retour"})]})}),a.jsx(Pe.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,type:"spring"},style:{width:"100%"},children:a.jsxs("form",{onSubmit:ve,className:"w-full space-y-5 gap-5 rounded bg-white p-5",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[a.jsxs("div",{className:"w-full",children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Date de l'operation"}),a.jsx($e,{className:"w-full",openTo:"day",views:["year","month","day"],format:"DD/MM/YYYY",value:i.date,onChange:e=>{n("date",e)},slotProps:{textField:{size:"small"}}})]}),a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Mouvement"}),a.jsx(u,{value:i.typeOperation,className:"w-full",onChange:(e,t)=>n("typeOperation",t),disablePortal:!0,options:ce,getOptionLabel:e=>e.libelle,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"mouvement",label:e.libelle,required:!0}),size:"small"}),a.jsx(m,{message:c.typeOperation})]}),((I=i.typeOperation)==null?void 0:I.nom)==="sortie"&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Motif de sortie"}),a.jsx(u,{value:i.motifSortie,className:"w-full",onChange:(e,t)=>n("motifSortie",t),disablePortal:!0,options:ae,getOptionLabel:e=>{var t,s;return((t=e.nom)==null?void 0:t.charAt(0).toUpperCase())+((s=e.nom)==null?void 0:s.slice(1))},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"motif",label:e.libelle,required:!0}),size:"small"}),a.jsx(m,{message:c.motifSortie})]}),((w=i.typeOperation)==null?void 0:w.nom)==="transfert"&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Motif de transfert"}),a.jsx(u,{value:i.motifTransfert,className:"w-full",onChange:(e,t)=>n("motifTransfert",t),disablePortal:!0,options:se,getOptionLabel:e=>{var t,s;return((t=e.nom)==null?void 0:t.charAt(0).toUpperCase())+((s=e.nom)==null?void 0:s.slice(1))},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"motif de transfert",label:e.libelle,required:!0}),size:"small"}),a.jsx(m,{message:c.motifTransfert})]}),a.jsxs("div",{className:"md:col-span-2 grid md:grid-cols-2 gap-2",children:[(((z=i.typeOperation)==null?void 0:z.nom)==="sortie"||((F=i.typeOperation)==null?void 0:F.nom)==="transfert")&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Stock source"}),a.jsx(u,{value:i.departementSource,className:"w-full",onChange:(e,t)=>n("departementSource",t),disablePortal:!0,options:S.filter(e=>{var t;return e.id!==((t=i.departementDestination)==null?void 0:t.id)}),getOptionLabel:e=>"Stock "+e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Stock",label:e.nom,required:!0}),size:"small"}),a.jsx(m,{message:c.departementSource})]}),(((L=i.typeOperation)==null?void 0:L.nom)==="entrée"||((W=i.typeOperation)==null?void 0:W.nom)==="transfert")&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Stock de destination"}),a.jsx(u,{value:i.departementDestination,className:"w-full",onChange:(e,t)=>n("departementDestination",t),disablePortal:!0,options:S.filter(e=>{var t;return e.id!==((t=i.departementSource)==null?void 0:t.id)}),getOptionLabel:e=>"Stock "+e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Stock",label:e.nom,required:!0}),size:"small"}),a.jsx(m,{message:c.departementDestination})]})]}),((K=i.typeOperation)==null?void 0:K.nom)==="entrée"&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Caisse de paiement"}),a.jsx(u,{value:i.caisse,className:"w-full",onChange:(e,t)=>n("caisse",t),disablePortal:!0,options:te,getOptionLabel:e=>{var t;return"Caisse dep. "+((t=e==null?void 0:e.departement)==null?void 0:t.nom)},isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Caisse",label:e.nom,required:!0}),size:"small"}),a.jsx(m,{message:c.caisse}),i.caisse&&a.jsxs("div",{className:"text-orange-500 font-bold mt-1",children:["Solde: ",x(i.caisse.solde)+" GNF"]})]}),((R=i.typeOperation)==null?void 0:R.nom)==="entrée"&&a.jsxs("div",{children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500",children:"Fournisseur"}),a.jsx(u,{value:i.fournisseur,className:"w-full",onChange:(e,t)=>n("fournisseur",t),disablePortal:!0,options:re,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Fournisseur",label:e.nom}),size:"small"}),a.jsx(m,{message:c.fournisseur})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Ajout des produits"}),a.jsxs("div",{children:[a.jsx(u,{value:i.produits,className:"w-full",onChange:Ne,disablePortal:!0,options:Ae,multiple:!0,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Produits",label:e.nom}),disableCloseOnSelect:!0,size:"small"}),a.jsx(m,{message:c.produits})]}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(X,{table:be})}),i.totalOperation?a.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total des produits : "+x(i.totalOperation)+" GNF"}):""]}),((V=i.typeOperation)==null?void 0:V.nom)==="entrée"&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 border p-3 rounded",children:[a.jsx("div",{className:"md:col-span-2 font-bold text-orange-500 text-xl",children:"Dépense supplémentaires"}),a.jsxs("div",{children:[a.jsx(u,{value:i.motifsDepenses,className:"w-full",onChange:Se,disablePortal:!0,options:De,multiple:!0,getOptionLabel:e=>e.nom,isOptionEqualToValue:(e,t)=>e.id===t.id,renderInput:e=>a.jsx(d,{fullWidth:!0,...e,placeholder:"Motifs",label:e.nom}),disableCloseOnSelect:!0,size:"small"}),a.jsx(m,{message:c.motifsDepenses})]}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(X,{table:ye})}),i.totalDepense?a.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total des dépenses: "+x(i.totalDepense)+" GNF"}):""]}),i.total?a.jsx("div",{className:"md:col-span-2 w-fit p-2 rounded bg-black text-white",children:"Total: "+x(i.total)+" GNF"}):"",a.jsx("div",{className:"w-full md:col-span-2 flex justify-end gap-4 mt-10 py-2 px-1 bg-gray-100 rounded",children:a.jsx(g,{variant:"contained",color:"success",type:"submit",children:"Enregistrer"})})]})})]})})})}export{Ot as default};
