import{r as a,y as o,j as e}from"./app-ef847769.js";import{P as V,d as q,B as E,I as x}from"./PanelLayout-f3b1b528.js";import{u as Y,M as O}from"./index.esm-f651ad8d.js";import{M as $}from"./index.esm-4bae7fd4.js";import{B as s}from"./Button-5cd339f2.js";import{A as w}from"./Add-b95b626c.js";import{A as H}from"./ArrowBack-609c6f32.js";import{D as C,a as b,b as y}from"./DialogContent-21eccb4c.js";import{D as S}from"./DialogTitle-8810badb.js";import{T as Q}from"./TextField-239b9d80.js";import{T as g}from"./TableRow-e01d0199.js";import{V as G}from"./Visibility-4a9b5128.js";import{C as A,a as R}from"./CheckCircle-edf3dcba.js";import{C as k}from"./Chip-7ba2869a.js";import"./createSvgIcon-1d15f18d.js";import"./index-63345e99.js";import"./Dropdown-acf677e6.js";import"./transition-07c41afc.js";import"./Cancel-055cb859.js";import"./Edit-ed1cfcc7.js";import"./MenuItem-7e314da3.js";import"./DatePicker-17c52b79.js";import"./Popper-fafd03d0.js";import"./LastPage-9a697fd0.js";import"./SwitchBase-300b33a4.js";import"./Checkbox-29e5b734.js";import"./Stack-d9f7e61f.js";import"./CircularProgress-9e4a82bd.js";import"./Switch-00012cca.js";import"./Autocomplete-e3bbac74.js";const ke=({auth:i,ajustements:d,success:D,error:_})=>{const[I,m]=a.useState(!1),[l,z]=a.useState(null),[p,f]=a.useState(""),[h,j]=a.useState(""),[M,u]=a.useState(!1),[v,T]=a.useState({action:"",id:null,message:""}),K=t=>{if(!t)return e.jsx(k,{label:"Inconnu",color:"default",size:"small"});let r="default",n=null,c="";switch(t){case"en_attente":r="warning",c="En attente";break;case"validé":r="success",n=e.jsx(A,{fontSize:"small"}),c="Validé";break;case"rejeté":r="error",n=e.jsx(R,{fontSize:"small"}),c="Rejeté";break;default:r="default",c=typeof t=="string"?t.charAt(0).toUpperCase()+t.slice(1).replace("_"," "):"Inconnu"}return e.jsx(k,{label:c,color:r,size:"small",icon:n})},F=t=>{z(t),f(""),j(""),m(!0)},L=()=>{if(!p.trim()){j("Le motif de rejet est requis");return}o.post(route("admin.inventaire.ajustement.rejeter",[i.user.id,l.id]),{motif_rejet:p},{onSuccess:()=>{m(!1),f("")}})},N=(t,r,n)=>{T({action:t,id:r,message:n}),u(!0)},B=()=>{const{action:t,id:r}=v;switch(t){case"valider":o.get(route("admin.inventaire.ajustement.valider",[i.user.id,r]));break}u(!1)},P=Y({columns:[{accessorKey:"id",header:"ID",size:80},{accessorKey:"produit.nom",header:"Produit",Cell:({row:t})=>e.jsxs("div",{children:[e.jsx("div",{children:t.original.produit.nom}),e.jsx("div",{className:"text-xs text-gray-500",children:t.original.produit.code})]})},{accessorKey:"quantite_avant",header:"Qté Avant",Cell:({row:t})=>t.original.quantite_avant.toLocaleString("fr-FR")},{accessorKey:"quantite_apres",header:"Qté Après",Cell:({row:t})=>t.original.quantite_apres.toLocaleString("fr-FR")},{accessorKey:"difference",header:"Différence",Cell:({row:t})=>{const r=t.original.difference,n=r===0?"text-green-600":r>0?"text-blue-600":"text-red-600";return e.jsx("span",{className:n,children:r.toLocaleString("fr-FR")})}},{accessorKey:"motif",header:"Motif"},{accessorKey:"date_ajustement",header:"Date",Cell:({row:t})=>q(t.original.date_ajustement).format("DD/MM/YYYY HH:mm")},{accessorKey:"departement.nom",header:"Département",Cell:({row:t})=>t.original.departement?t.original.departement.nom:"-"},{accessorKey:"status",header:"Status",Cell:({row:t})=>K(t.original.status)},{accessorKey:"actions",header:"Actions",Cell:({row:t})=>e.jsxs(E,{sx:{display:"flex",gap:"8px"},children:[e.jsx(g,{title:"Voir les détails",children:e.jsx(x,{color:"primary",onClick:()=>o.get(route("admin.inventaire.ajustement.show",[i.user.id,t.original.id])),children:e.jsx(G,{fontSize:"small"})})}),t.original.status==="en_attente"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{title:"Valider",children:e.jsx(x,{color:"success",onClick:()=>N("valider",t.original.id,`Êtes-vous sûr de vouloir valider cet ajustement ? Le stock du produit "${t.original.produit.nom}" sera ajusté de ${t.original.difference>0?"+":""}${t.original.difference}.`),children:e.jsx(A,{fontSize:"small"})})}),e.jsx(g,{title:"Rejeter",children:e.jsx(x,{color:"error",onClick:()=>F(t.original),children:e.jsx(R,{fontSize:"small"})})})]})]})}],data:d.data,enableColumnFilters:!0,enableGlobalFilter:!0,enablePagination:!0,manualPagination:!0,rowCount:d.total,onPaginationChange:t=>{o.get(route("admin.inventaire.ajustement.index",i.user.id),{page:t.pageIndex+1},{preserveState:!0,preserveScroll:!0,only:["ajustements"]})},state:{pagination:{pageIndex:d.current_page-1,pageSize:d.per_page}},localization:$,renderTopToolbarCustomActions:()=>e.jsx(s,{variant:"contained",color:"primary",startIcon:e.jsx(w,{}),onClick:()=>o.get(route("admin.inventaire.ajustement.create",i.user.id)),children:"Nouvel ajustement"})});return e.jsx(V,{auth:i,success:D,error:_,active:"stock",sousActive:"inventaire",breadcrumbs:[{text:"Inventaire",href:route("admin.stock.inventaire.index",[i.user.id]),active:!1},{text:"Ajustements d'inventaire",href:route("admin.inventaire.ajustement.index",[i.user.id]),active:!0}],children:e.jsxs("div",{className:"p-4 bg-white rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Ajustements d'inventaire"}),e.jsx(s,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>o.get(route("admin.stock.inventaire.index",i.user.id)),children:"Retour à la liste des inventaires"})]}),e.jsx(O,{table:P}),e.jsxs(C,{open:I,onClose:()=>m(!1),children:[e.jsx(S,{children:"Rejeter l'ajustement"}),e.jsx(b,{children:l&&e.jsxs("div",{children:[e.jsxs("p",{className:"mb-4",children:["Vous êtes sur le point de rejeter l'ajustement pour le produit",e.jsxs("strong",{children:[" ",l.produit.nom]})," avec une différence de",e.jsxs("strong",{children:[" ",l.difference>0?"+":"",l.difference]}),"."]}),e.jsx(Q,{autoFocus:!0,margin:"dense",label:"Motif du rejet",fullWidth:!0,multiline:!0,rows:3,value:p,onChange:t=>{f(t.target.value),t.target.value.trim()&&j("")},error:!!h,helperText:h})]})}),e.jsxs(y,{children:[e.jsx(s,{onClick:()=>m(!1),color:"primary",children:"Annuler"}),e.jsx(s,{onClick:L,color:"error",variant:"contained",children:"Rejeter"})]})]}),e.jsxs(C,{open:M,onClose:()=>u(!1),children:[e.jsx(S,{children:"Confirmation"}),e.jsx(b,{children:v.message}),e.jsxs(y,{children:[e.jsx(s,{onClick:()=>u(!1),color:"error",children:"Annuler"}),e.jsx(s,{onClick:B,color:"primary",variant:"contained",children:"Confirmer"})]})]})]})})};export{ke as default};
